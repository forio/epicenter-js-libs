this.org=this.org||{},org.cometd={},org.cometd.JSON={},org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(e){throw"Abstract"},org.cometd.Utils={},org.cometd.Utils.isString=function(e){return null!=e&&("string"==typeof e||e instanceof String)},org.cometd.Utils.isArray=function(e){return null!=e&&e instanceof Array},org.cometd.Utils.inArray=function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1},org.cometd.Utils.setTimeout=function(t,n,e){return window.setTimeout(function(){try{t._debug("Invoking timed function",n),n()}catch(e){t._debug("Exception invoking timed function",n,e)}},e)},org.cometd.Utils.clearTimeout=function(e){window.clearTimeout(e)},org.cometd.TransportRegistry=function(){var c=[],u={};this.getTransportTypes=function(){return c.slice(0)},this.findTransportTypes=function(e,t,n){for(var o=[],r=0;r<c.length;++r){var i=c[r];!0===u[i].accept(e,t,n)&&o.push(i)}return o},this.negotiateTransport=function(e,t,n,o){for(var r=0;r<c.length;++r)for(var i=c[r],s=0;s<e.length;++s)if(i===e[s]){var a=u[i];if(!0===a.accept(t,n,o))return a}return null},this.add=function(e,t,n){for(var o=!1,r=0;r<c.length;++r)if(c[r]===e){o=!0;break}return o||("number"!=typeof n?c.push(e):c.splice(n,0,e),u[e]=t),!o},this.find=function(e){for(var t=0;t<c.length;++t)if(c[t]===e)return u[e];return null},this.remove=function(e){for(var t=0;t<c.length;++t)if(c[t]===e){c.splice(t,1);var n=u[e];return delete u[e],n}return null},this.clear=function(){c=[],u={}},this.reset=function(){for(var e=0;e<c.length;++e)u[c[e]].reset()}},org.cometd.Transport=function(){var n,o;this.registered=function(e,t){n=e,o=t},this.unregistered=function(){o=n=null},this._debug=function(){o._debug.apply(o,arguments)},this._mixin=function(){return o._mixin.apply(o,arguments)},this.getConfiguration=function(){return o.getConfiguration()},this.getAdvice=function(){return o.getAdvice()},this.setTimeout=function(e,t){return org.cometd.Utils.setTimeout(o,e,t)},this.clearTimeout=function(e){org.cometd.Utils.clearTimeout(e)},this.convertToMessages=function(t){if(org.cometd.Utils.isString(t))try{return org.cometd.JSON.fromJSON(t)}catch(e){throw this._debug("Could not convert to JSON the following string",'"'+t+'"'),e}if(org.cometd.Utils.isArray(t))return t;if(null==t)return[];if(t instanceof Object)return[t];throw"Conversion Error "+t+", typeof "+typeof t},this.accept=function(e,t,n){throw"Abstract"},this.getType=function(){return n},this.send=function(e,t){throw"Abstract"},this.reset=function(){this._debug("Transport",n,"reset")},this.abort=function(){this._debug("Transport",n,"aborted")},this.toString=function(){return this.getType()}},org.cometd.Transport.derive=function(e){function t(){}return t.prototype=e,new t},org.cometd.RequestTransport=function(){var n=new org.cometd.Transport,e=org.cometd.Transport.derive(n),o=0,r=null,a=[],c=[];function i(o,r){if(this.transportSend(o,r),r.expired=!1,!o.sync){var e=this.getConfiguration().maxNetworkDelay,i=e;!0===r.metaConnect&&(i+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",i,"ms for the response, maxNetworkDelay",e);var s=this;r.timeout=this.setTimeout(function(){r.expired=!0;var e="Request "+r.id+" of transport "+s.getType()+" exceeded "+i+" ms max network delay",t={reason:e},n=r.xhr;t.httpCode=s.xhrStatus(n),s.abortXHR(n),s._debug(e),s.complete(r,!1,r.metaConnect),o.onFailure(n,o.messages,t)},i)}}function u(e){var t=++o,n={id:t,metaConnect:!1};a.length<this.getConfiguration().maxConnections-1?(a.push(n),i.call(this,e,n)):(this._debug("Transport",this.getType(),"queueing request",t,"envelope",e),c.push([e,n]))}function s(e,t){var n=org.cometd.Utils.inArray(e,a);if(0<=n&&a.splice(n,1),0<c.length){var o=c.shift(),r=o[0],i=o[1];if(this._debug("Transport dequeued request",i.id),t)this.getConfiguration().autoBatch&&function(e){for(;0<c.length;){var t=c[0],n=t[0],o=t[1];if(n.url!==e.url||n.sync!==e.sync)break;c.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",o.id)}}.call(this,r),u.call(this,r),this._debug("Transport completed request",e.id,r);else{var s=this;this.setTimeout(function(){s.complete(i,!1,i.metaConnect);var e={reason:"Previous request failed"},t=i.xhr;e.httpCode=s.xhrStatus(t),r.onFailure(t,r.messages,e)},0)}}}return e.complete=function(e,t,n){n?function(e){var t=e.id;if(this._debug("Transport",this.getType(),"metaConnect complete, request",t),null!==r&&r.id!==t)throw"Longpoll request mismatch, completing request "+t;r=null}.call(this,e):s.call(this,e,t)},e.transportSend=function(e,t){throw"Abstract"},e.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&0<n.length?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},e.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},e.send=function(e,t){t?function(e){if(null!==r)throw"Concurrent metaConnect requests not allowed, request id="+r.id+" not yet completed";var t=++o;this._debug("Transport",this.getType(),"metaConnect send, request",t,"envelope",e);var n={id:t,metaConnect:!0};i.call(this,e,n),r=n}.call(this,e):u.call(this,e)},e.abort=function(){n.abort();for(var e=0;e<a.length;++e){var t=a[e];this._debug("Aborting request",t),this.abortXHR(t.xhr)}r&&(this._debug("Aborting metaConnect request",r),this.abortXHR(r.xhr)),this.reset()},e.reset=function(){n.reset(),r=null,a=[],c=[]},e.abortXHR=function(e){if(e)try{e.abort()}catch(e){this._debug(e)}},e.xhrStatus=function(e){if(e)try{return e.status}catch(e){this._debug(e)}return-1},e},org.cometd.LongPollingTransport=function(){var e=new org.cometd.RequestTransport,t=org.cometd.Transport.derive(e),a=!0;return t.accept=function(e,t,n){return a||!t},t.xhrSend=function(e){throw"Abstract"},t.transportSend=function(r,i){this._debug("Transport",this.getType(),"sending request",i.id,"envelope",r);var s=this;try{var o=!0;i.xhr=this.xhrSend({transport:this,url:r.url,sync:r.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(r.messages),onSuccess:function(e){s._debug("Transport",s.getType(),"received response",e);var t=!1;try{var n=s.convertToMessages(e);0===n.length?(a=!1,s.transportFailure(r,i,{httpCode:204})):(t=!0,s.transportSuccess(r,i,n))}catch(e){if(s._debug(e),!t){a=!1;var o={exception:e};o.httpCode=s.xhrStatus(i.xhr),s.transportFailure(r,i,o)}}},onError:function(e,t){a=!1;var n={reason:e,exception:t};n.httpCode=s.xhrStatus(i.xhr),o?s.setTimeout(function(){s.transportFailure(r,i,n)},0):s.transportFailure(r,i,n)}}),o=!1}catch(e){a=!1,this.setTimeout(function(){s.transportFailure(r,i,{exception:e})},0)}},t.reset=function(){e.reset(),a=!0},t},org.cometd.CallbackPollingTransport=function(){var e=new org.cometd.RequestTransport,t=org.cometd.Transport.derive(e);function p(e,t,n){var o=this;return function(){o.transportFailure(e,t,"error",n)}}return t.accept=function(e,t,n){return!0},t.jsonpSend=function(e){throw"Abstract"},t.transportSend=function(e,o){for(var r=this,t=0,n=e.messages.length,i=[];0<n;){var s=org.cometd.JSON.toJSON(e.messages.slice(t,t+n)),a=e.url.length+encodeURI(s).length;if(2e3<a){if(1===n){var c="Bayeux message too big ("+a+" bytes, max is 2000) for transport "+this.getType();return void this.setTimeout(p.call(this,e,o,c),0)}--n}else i.push(n),t+=n,n=e.messages.length-t}var u=e;if(1<i.length){var l=0,d=i[0];this._debug("Transport",this.getType(),"split",e.messages.length,"messages into",i.join(" + ")),(u=this._mixin(!1,{},e)).messages=e.messages.slice(l,d),u.onSuccess=e.onSuccess,u.onFailure=e.onFailure;for(var g=1;g<i.length;++g){var f=this._mixin(!1,{},e);l=d,d+=i[g],f.messages=e.messages.slice(l,d),f.onSuccess=e.onSuccess,f.onFailure=e.onFailure,this.send(f,o.metaConnect)}}this._debug("Transport",this.getType(),"sending request",o.id,"envelope",u);try{var h=!0;this.jsonpSend({transport:this,url:u.url,sync:u.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(u.messages),onSuccess:function(e){var t=!1;try{var n=r.convertToMessages(e);0===n.length?r.transportFailure(u,o,{httpCode:204}):(t=!0,r.transportSuccess(u,o,n))}catch(e){r._debug(e),t||r.transportFailure(u,o,{exception:e})}},onError:function(e,t){var n={reason:e,exception:t};h?r.setTimeout(function(){r.transportFailure(u,o,n)},0):r.transportFailure(u,o,n)}}),h=!1}catch(e){this.setTimeout(function(){r.transportFailure(u,o,{exception:e})},0)}},t},org.cometd.WebSocketTransport=function(){var a,n=new org.cometd.Transport,e=org.cometd.Transport.derive(n),c=!0,u=!1,l=!0,m={},v={},d=!1,g=null,b=!1,y=null;function i(n,e,t){var o=org.cometd.JSON.toJSON(e.messages);n.send(o),this._debug("Transport",this.getType(),"sent",e,"metaConnect =",t);var r=this.getConfiguration().maxNetworkDelay,i=r;t&&(i+=this.getAdvice().timeout,b=!0);for(var s=this,a=[],c=0;c<e.messages.length;++c)!function(){var t=e.messages[c];t.id&&(a.push(t.id),v[t.id]=this.setTimeout(function(){s._debug("Transport",s.getType(),"timing out message",t.id,"after",i,"on",n);var e={code:1e3,reason:"Message Timeout"};s.webSocketClose(n,e.code,e.reason),s.onClose(n,e)},i))}();this._debug("Transport",this.getType(),"waiting at most",i,"ms for messages",a,"maxNetworkDelay",r,", timeouts:",v)}function s(t,n,e){try{null===t?function(){if(!d){d=!0;var t=a.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",t);try{var e=a.getConfiguration().protocol,n=e?new org.cometd.WebSocket(t,e):new org.cometd.WebSocket(t)}catch(e){throw c=!1,this._debug("Exception while creating WebSocket object",e),e}l=!1!==a.getConfiguration().stickyReconnect;var o=this,r=null,i=a.getConfiguration().connectTimeout;0<i&&(r=this.setTimeout(function(){r=null,o._debug("Transport",o.getType(),"timed out while connecting to URL",t,":",i,"ms");var e={code:1e3,reason:"Connect Timeout"};o.webSocketClose(n,e.code,e.reason),o.onClose(n,e)},i));var s=function(e){e=e||{code:1e3},o._debug("WebSocket closing",n,e),d=!1,r&&(o.clearTimeout(r),r=null),null!==g&&n!==g?o._debug("Closed Extra WebSocket Connection",n):o.onClose(n,e)};n.onopen=function(){o._debug("WebSocket opened",n),d=!1,r&&(o.clearTimeout(r),r=null),g?(a._warn("Closing Extra WebSocket Connections",n,g),o.webSocketClose(n,1e3,"Extra Connection")):o.onOpen(n)},n.onclose=s,n.onerror=function(){s({code:1002,reason:"Error"})},n.onmessage=function(e){o._debug("WebSocket message",e,n),n!==g&&a._warn("Extra WebSocket Connections",n,g),o.onMessage(n,e)},this._debug("Transport",this.getType(),"configured callbacks on",n)}}.call(this):i.call(this,t,n,e)}catch(e){this.setTimeout(function(){n.onFailure(t,n.messages,{exception:e})},0)}}return e.reset=function(){n.reset(),l=!(u=!(c=!0)),m={},b=d=!(v={}),y=g=null},e.onOpen=function(e){for(var t in this._debug("Transport",this.getType(),"opened",e),g=e,u=!0,this._debug("Sending pending messages",m),m){var n=m[t],o=n[0],r=n[1];y=o.onSuccess,i.call(this,e,o,r)}},e.onMessage=function(e,t){this._debug("Transport",this.getType(),"received websocket message",t,e);for(var n=!1,o=this.convertToMessages(t.data),r=[],i=0;i<o.length;++i){var s=o[i];if((/^\/meta\//.test(s.channel)||void 0!==s.successful)&&s.id){r.push(s.id);var a=v[s.id];a&&(this.clearTimeout(a),delete v[s.id],this._debug("Transport",this.getType(),"removed timeout for message",s.id,", timeouts",v))}"/meta/connect"===s.channel&&(b=!1),"/meta/disconnect"!==s.channel||b||(n=!0)}for(var c=!1,u=0;u<r.length;++u){var l=r[u];for(var d in m){var g=d.split(","),f=org.cometd.Utils.inArray(l,g);if(0<=f){c=!0,g.splice(f,1);var h=m[d][0],p=m[d][1];delete m[d],0<g.length&&(m[g.join(",")]=[h,p]);break}}}c&&this._debug("Transport",this.getType(),"removed envelope, envelopes",m),y.call(this,o),n&&this.webSocketClose(e,1e3,"Disconnect")},e.onClose=function(e,t){this._debug("Transport",this.getType(),"closed",e,t),c=l&&u;var n=v;for(var o in v={},n)this.clearTimeout(n[o]);var r=m;for(var i in m={},r){var s=r[i][0];r[i][1]&&(b=!1),s.onFailure(e,s.messages,{websocketCode:t.code,reason:t.reason})}g=null},e.registered=function(e,t){n.registered(e,t),a=t},e.accept=function(e,t,n){return c&&!!org.cometd.WebSocket&&!1!==a.websocketEnabled},e.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"metaConnect =",t);for(var n=[],o=0;o<e.messages.length;++o){var r=e.messages[o];r.id&&n.push(r.id)}m[n.join(",")]=[e,t],this._debug("Transport",this.getType(),"stored envelope, envelopes",m),s.call(this,g,e,t)},e.webSocketClose=function(e,t,n){try{e.close(t,n)}catch(e){this._debug(e)}},e.abort=function(){if(n.abort(),g){var e={code:1001,reason:"Abort"};this.webSocketClose(g,e.code,e.reason),this.onClose(g,e)}this.reset()},e},org.cometd.CometD=function(e){var d,c,u,l,g,f=this,t=e||"default",h=!1,p=new org.cometd.TransportRegistry,n="disconnected",m=0,v=null,b=0,o=[],y=!1,a={},r=0,i=null,s=[],T={},x={},k=!1,w=!1,_={protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:!0,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,advice:{timeout:6e4,interval:0,reconnect:"retry"}};function S(e,t){try{return e[t]}catch(e){return}}function C(e){return org.cometd.Utils.isString(e)}function E(e){return null!=e&&"function"==typeof e}function R(e,t){if(window.console){var n=window.console[e];E(n)&&n.apply(window.console,t)}}function O(e){if(e){var t=a[e.channel];t&&t[e.id]&&(delete t[e.id],f._debug("Removed",e.listener?"listener":"subscription",e))}}function I(e){e&&!e.listener&&O(e)}function U(){for(var e in a){var t=a[e];if(t)for(var n=0;n<t.length;++n)I(t[n])}}function q(e){n!==e&&(f._debug("Status",n,"->",e),n=e)}function A(){return"disconnecting"===n||"disconnected"===n}function N(e,t,n,o,r){try{return t.call(e,o)}catch(e){f._debug("Exception during execution of extension",n,e);var i=f.onExtensionException;if(E(i)){f._debug("Invoking extension exception callback",n,e);try{i.call(f,e,n,r,o)}catch(e){f._info("Exception during execution of exception callback in extension",n,e)}}return o}}function L(e){for(var t=0;t<s.length&&null!=e;++t){var n=s[t],o=n.extension.outgoing;if(E(o)){var r=N(n.extension,o,n.name,e,!0);e=void 0===r?e:r}}return e}function j(e,t){var n=a[e];if(n&&0<n.length)for(var o=0;o<n.length;++o){var r=n[o];if(r)try{r.callback.call(r.scope,t)}catch(e){f._debug("Exception during notification",r,t,e);var i=f.onListenerException;if(E(i)){f._debug("Invoking listener exception callback",r,e);try{i.call(f,e,r,r.listener,t)}catch(e){f._info("Exception during execution of listener callback",r,e)}}}}}function F(e,t){j(e,t);for(var n=e.split("/"),o=n.length-1,r=o;0<r;--r){var i=n.slice(0,r).join("/")+"/*";r===o&&j(i,t),j(i+="*",t)}}function J(){null!==i&&org.cometd.Utils.clearTimeout(i),i=null}function D(e){J();var t=T.interval+r;f._debug("Function scheduled in",t,"ms, interval =",T.interval,"backoff =",r,e),i=org.cometd.Utils.setTimeout(f,e,t)}function B(e,t,n,o){for(var r=0;r<t.length;++r){var i=t[r],s=""+ ++m;i.id=s,v&&(i.clientId=v);var a=void 0;E(i._callback)&&(a=i._callback,delete i._callback),null!=(i=L(i))?(i.id=s,t[r]=i,a&&(x[s]=a)):t.splice(r--,1)}if(0!==t.length){var c=f.getURL();_.appendMessageTypeToURL&&(c.match(/\/$/)||(c+="/"),o&&(c+=o));var u={url:c,sync:e,messages:t,onSuccess:function(e){try{l.call(f,e)}catch(e){f._debug("Exception during handling of messages",e)}},onFailure:function(e,t,n){try{var o=f.getTransport();n.connectionType=o?o.getType():"unknown",g.call(f,e,t,n)}catch(e){f._debug("Exception during handling of failure",e)}}};f._debug("Send",u),d.send(u,n)}}function M(e){0<b||!0===y?o.push(e):B(!1,[e],!1)}function W(){r=0}function P(){r<_.maxBackoff&&(r+=_.backoffIncrement)}function H(){var e=o;o=[],0<e.length&&B(!1,e,!1)}function K(){q("connecting"),D(function(){!function(){if(!A()){var e={channel:"/meta/connect",connectionType:d.getType()};w||(e.advice={timeout:0}),q("connecting"),f._debug("Connect sent",e),B(!1,[e],!0,"connect"),q("connected")}}()})}function Q(e){e&&(T=f._mixin(!1,{},_.advice,e),f._debug("New advice",T))}function X(e){if(J(),e&&d&&d.abort(),v=null,q("disconnected"),b=0,W(),d=null,0<o.length){var t=o;o=[],g.call(f,void 0,t,{reason:"Disconnected"})}}function z(e,t,n){var o=f.onTransportFailure;if(E(o)){f._debug("Invoking transport failure callback",e,t,n);try{o.call(f,e,t,n)}catch(e){f._info("Exception during execution of transport failure callback",e)}}}function $(e,t){E(e)&&(t=e,e=void 0),v=null,U(),A()?(p.reset(),Q(_.advice)):Q(f._mixin(!1,T,{reconnect:"retry"})),y=!(b=0),c=e,u=t;var n="1.0",o=f.getURL(),r=p.findTransportTypes(n,h,o),i={version:n,minimumVersion:n,channel:"/meta/handshake",supportedConnectionTypes:r,_callback:t,advice:{timeout:T.timeout,interval:T.interval}},s=f._mixin(!1,{},c,i);if(!d&&!(d=p.negotiateTransport(r,n,h,o))){var a="Could not find initial transport among: "+p.getTransportTypes();throw f._warn(a),a}f._debug("Initial transport is",d.getType()),q("handshaking"),f._debug("Handshake sent",s),B(!1,[s],!1,"handshake")}function G(){q("handshaking"),y=!0,D(function(){$(c,u)})}function V(e){var t=x[e.id];E(t)&&(delete x[e.id],t.call(f,e))}function Y(e){V(e),F("/meta/handshake",e),F("/meta/unsuccessful",e),!A()&&"none"!==T.reconnect?(P(),G()):X(!1)}function Z(e){F("/meta/connect",e),F("/meta/unsuccessful",e);var t=A()?"none":T.reconnect;switch(t){case"retry":K(),P();break;case"handshake":p.reset(),W(),G();break;case"none":X(!1);break;default:throw"Unrecognized advice action"+t}}function ee(e){X(!0),V(e),F("/meta/disconnect",e),F("/meta/unsuccessful",e)}function te(e){var t=a[e.subscription];if(t)for(var n=t.length-1;0<=n;--n){var o=t[n];if(o&&!o.listener){delete t[n],f._debug("Removed failed subscription",o);break}}V(e),F("/meta/subscribe",e),F("/meta/unsuccessful",e)}function ne(e){V(e),F("/meta/unsubscribe",e),F("/meta/unsuccessful",e)}function oe(e){V(e),F("/meta/publish",e),F("/meta/unsuccessful",e)}function re(e){var t,n,o,r;if(null!=(e=function(e){for(var t=0;t<s.length&&null!=e;++t){var n=_.reverseIncomingExtensions?s.length-1-t:t,o=s[n],r=o.extension.incoming;if(E(r)){var i=N(o.extension,r,o.name,e,!1);e=void 0===i?e:i}}return e}(e)))switch(Q(e.advice),e.channel){case"/meta/handshake":!function(e){if(e.successful){v=e.clientId;var t=f.getURL(),n=p.negotiateTransport(e.supportedConnectionTypes,e.version,h,t);if(null===n){var o="Could not negotiate transport with server; client=["+p.findTransportTypes(e.version,h,t)+"], server=["+e.supportedConnectionTypes+"]",r=f.getTransport();return z(r.getType(),null,{reason:o,connectionType:r.getType(),transport:r}),f._warn(o),X(!0)}d!==n&&(f._debug("Transport",d.getType(),"->",n.getType()),d=n),y=!1,H(),e.reestablish=k,k=!0,V(e),F("/meta/handshake",e);var i=A()?"none":T.reconnect;switch(i){case"retry":W(),K();break;case"none":X(!1);break;default:throw"Unrecognized advice action "+i}}else Y(e)}(e);break;case"/meta/connect":!function(e){if(w=e.successful){F("/meta/connect",e);var t=A()?"none":T.reconnect;switch(t){case"retry":W(),K();break;case"none":X(!1);break;default:throw"Unrecognized advice action "+t}}else Z(e)}(e);break;case"/meta/disconnect":(r=e).successful?(X(!1),V(r),F("/meta/disconnect",r)):ee(r);break;case"/meta/subscribe":(o=e).successful?(V(o),F("/meta/subscribe",o)):te(o);break;case"/meta/unsubscribe":(n=e).successful?(V(n),F("/meta/unsubscribe",n)):ne(n);break;default:void 0===(t=e).successful?void 0!==t.data?F(t.channel,t):f._warn("Unknown Bayeux Message",t):t.successful?(V(t),F("/meta/publish",t)):oe(t)}}function ie(e){var t=a[e];if(t)for(var n=0;n<t.length;++n)if(t[n])return!0;return!1}function se(e,t){var n={scope:e,method:t};if(E(e))n.scope=void 0,n.method=e;else if(C(t)){if(!e)throw"Invalid scope "+e;if(n.method=e[t],!E(n.method))throw"Invalid callback "+t+" for scope "+e}else if(!E(t))throw"Invalid callback "+t;return n}function ae(e,t,n,o){var r=se(t,n);f._debug("Adding",o?"listener":"subscription","on",e,"with scope",r.scope,"and callback",r.method);var i={channel:e,scope:r.scope,callback:r.method,listener:o},s=a[e];return s||(s=[],a[e]=s),i.id=s.push(i)-1,f._debug("Added",o?"listener":"subscription",i),i[0]=e,i[1]=i.id,i}this._mixin=function(e,t,n){for(var o=t||{},r=2;r<arguments.length;++r){var i=arguments[r];if(null!=i)for(var s in i){var a=S(i,s),c=S(o,s);if(a!==t&&void 0!==a)if(e&&"object"==typeof a&&null!==a)if(a instanceof Array)o[s]=this._mixin(e,c instanceof Array?c:[],a);else{var u="object"!=typeof c||c instanceof Array?{}:c;o[s]=this._mixin(e,u,a)}else o[s]=a}}return o},this._warn=function(){R("warn",arguments)},this._info=function(){"warn"!==_.logLevel&&R("info",arguments)},this._debug=function(){"debug"===_.logLevel&&R("debug",arguments)},this._isCrossDomain=function(e){return e&&e!==window.location.host},this.send=M,this.receive=re,l=function(e){f._debug("Received",e);for(var t=0;t<e.length;++t){re(e[t])}},g=function(e,t,n){f._debug("handleFailure",e,t,n),n.transport=e;for(var o=0;o<t.length;++o){var r=t[o],i={id:r.id,successful:!1,channel:r.channel,failure:n};switch((n.message=r).channel){case"/meta/handshake":s=i,l=c=void 0,a=f.getURL(),c=f.getTransport(),u=p.findTransportTypes("1.0",h,a),(l=p.negotiateTransport(u,"1.0",h,a))?(f._debug("Transport",c.getType(),"->",l.getType()),z(c.getType(),l.getType(),s.failure),Y(s),d=l):(z(c.getType(),null,s.failure),f._warn("Could not negotiate transport; client=["+u+"]"),X(!0),Y(s));break;case"/meta/connect":w=!1,Z(i);break;case"/meta/disconnect":ee(i);break;case"/meta/subscribe":i.subscription=r.subscription,te(i);break;case"/meta/unsubscribe":i.subscription=r.subscription,ne(i);break;default:oe(i)}}var s,a,c,u,l},this.registerTransport=function(e,t,n){var o=p.add(e,t,n);return o&&(this._debug("Registered transport",e),E(t.registered)&&t.registered(e,this)),o},this.getTransportTypes=function(){return p.getTransportTypes()},this.unregisterTransport=function(e){var t=p.remove(e);return null!==t&&(this._debug("Unregistered transport",e),E(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){p.clear()},this.findTransport=function(e){return p.find(e)},this.configure=function(e){(function(e){f._debug("Configuring cometd object with",e),C(e)&&(e={url:e}),e||(e={}),_=f._mixin(!1,_,e);var t=f.getURL();if(!t)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var n=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(t),o=n[2],r=n[8],i=n[9];if(h=f._isCrossDomain(o),_.appendMessageTypeToURL)if(void 0!==i&&0<i.length)f._info("Appending message type to URI "+r+i+" is not supported, disabling 'appendMessageTypeToURL' configuration"),_.appendMessageTypeToURL=!1;else{var s=r.split("/"),a=s.length-1;r.match(/\/$/)&&(a-=1),0<=s[a].indexOf(".")&&(f._info("Appending message type to URI "+r+" is not supported, disabling 'appendMessageTypeToURL' configuration"),_.appendMessageTypeToURL=!1)}}).call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e,t){q("disconnected"),k=!1,$(e,t)},this.disconnect=function(e,t,n){if(!A()){"boolean"!=typeof e&&(n=t,t=e,e=!1),E(t)&&(n=t,t=void 0);var o={channel:"/meta/disconnect",_callback:n},r=this._mixin(!1,{},t,o);q("disconnecting"),B(!0===e,[r],!1,"disconnect")}},this.startBatch=function(){++b},this.endBatch=function(){!function(){if(--b<0)throw"Calls to startBatch() and endBatch() are not paired";0!==b||A()||y||H()}()},this.batch=function(e,t){var n=se(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(e){throw this._info("Exception during execution of batch",e),this.endBatch(),e}},this.addListener=function(e,t,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!C(e))throw"Illegal argument type: channel must be a string";return ae(e,t,n,!0)},this.removeListener=function(e){if(!(e&&e.channel&&"id"in e))throw"Invalid argument: expected subscription, not "+e;O(e)},this.clearListeners=function(){a={}},this.subscribe=function(e,t,n,o,r){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!C(e))throw"Illegal argument type: channel must be a string";if(A())throw"Illegal state: already disconnected";E(t)&&(r=o,o=n,n=t,t=void 0),E(o)&&(r=o,o=void 0);var i=!ie(e),s=ae(e,t,n,!1);if(i){var a={channel:"/meta/subscribe",subscription:e,_callback:r};M(this._mixin(!1,{},o,a))}return s},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(A())throw"Illegal state: already disconnected";E(t)&&(n=t,t=void 0),this.removeListener(e);var o=e.channel;if(!ie(o)){var r={channel:"/meta/unsubscribe",subscription:o,_callback:n};M(this._mixin(!1,{},t,r))}},this.resubscribe=function(e,t){if(I(e),e)return this.subscribe(e.channel,e.scope,e.callback,t)},this.clearSubscriptions=function(){U()},this.publish=function(e,t,n,o){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!C(e))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(A())throw"Illegal state: already disconnected";E(t)?(o=t,t=n={}):E(n)&&(o=n,n={});var r={channel:e,data:t,_callback:o};M(this._mixin(!1,{},n,r))},this.getStatus=function(){return n},this.isDisconnected=A,this.setBackoffIncrement=function(e){_.backoffIncrement=e},this.getBackoffIncrement=function(){return _.backoffIncrement},this.getBackoffPeriod=function(){return r},this.setLogLevel=function(e){_.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!C(e))throw"Illegal argument type: extension name must be a string";for(var n=!1,o=0;o<s.length;++o){if(s[o].name===e){n=!0;break}}return n?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(s.push({name:e,extension:t}),this._debug("Registered extension",e),E(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!C(e))throw"Illegal argument type: extension name must be a string";for(var t=!1,n=0;n<s.length;++n){var o=s[n];if(o.name===e){s.splice(n,1),t=!0,this._debug("Unregistered extension",e);var r=o.extension;E(r.unregistered)&&r.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<s.length;++t){var n=s[t];if(n.name===e)return n.extension}return null},this.getName=function(){return t},this.getClientId=function(){return v},this.getURL=function(){if(d&&"object"==typeof _.urls){var e=_.urls[d.getType()];if(e)return e}return _.url},this.getTransport=function(){return d},this.getConfiguration=function(){return this._mixin(!0,{},_)},this.getAdvice=function(){return this._mixin(!0,{},T)},org.cometd.WebSocket=window.WebSocket},"function"==typeof define&&define.amd&&define(function(){return org.cometd}),"undefined"!=typeof module&&(module.exports=org.cometd),function(){function e(e){return e.AckExtension=function(){var n,o=!1,r=-1;function i(e,t){n._debug(e,t)}this.registered=function(e,t){n=t,i("AckExtension: executing registration callback")},this.unregistered=function(){i("AckExtension: executing unregistration callback"),n=null},this.incoming=function(e){var t=e.channel;if("/meta/handshake"==t)i("AckExtension: server supports acks",o=e.ext&&e.ext.ack);else if("/meta/connect"==t&&e.successful&&o){var n=e.ext;n&&"number"==typeof n.ack&&i("AckExtension: server sent ack id",r=n.ack)}return e},this.outgoing=function(e){var t=e.channel;return"/meta/handshake"==t?(e.ext||(e.ext={}),e.ext.ack=n&&!1!==n.ackEnabled,r=-1):"/meta/connect"==t&&o&&(e.ext||(e.ext={}),i("AckExtension: client sending ack id",e.ext.ack=r)),e}}}"function"==typeof define&&define.amd?define(["org/cometd"],e):e(org.cometd)}(),function(){function e(d){return d.COOKIE||(d.COOKIE={},d.COOKIE.set=function(e,t,n){throw"Abstract"},d.COOKIE.get=function(e){throw"Abstract"}),d.ReloadExtension=function(e){var r,i,s=null,a="org.cometd.reload",n="/",o=5,c=!1;function u(e){if(s&&null!==s.handshakeResponse){l(e),s.cookiePath=n;var t=d.JSON.toJSON(s);i("Reload extension saving cookie value",t),d.COOKIE.set(a,t,{"max-age":o,path:n,expires:new Date((new Date).getTime()+1e3*o)})}}function l(e){e&&("number"==typeof e.cookieMaxAge&&(o=e.cookieMaxAge),"string"==typeof e.cookieName&&(a=e.cookieName),"string"==typeof e.cookiePath&&(n=e.cookiePath))}this.configure=l,this.registered=function(e,t){(r=t).reload=u,i=r._debug},this.unregistered=function(){delete r.reload,r=null},this.outgoing=function(e){switch(e.channel){case"/meta/handshake":(s={}).url=r.getURL();var t=d.COOKIE.get(a);if(i("Reload extension found cookie value",t),t)try{var n=d.JSON.fromJSON(t);if(d.COOKIE.set(a,"",{"max-age":-1,path:n.cookiePath,expires:-1}),n.handshakeResponse&&(o=n,s.url==o.url))return i("Reload extension restoring state",n),setTimeout(function(){i("Reload extension replaying handshake response",n.handshakeResponse),s.handshakeResponse=n.handshakeResponse,s.transportType=n.transportType,s.reloading=!0;var e=r._mixin(!0,{},s.handshakeResponse,{ext:{reload:!0}});e.supportedConnectionTypes=[s.transportType],r.receive(e),i("Reload extension replayed handshake response",e)},0),c||(c=!0,r.startBatch()),null;i("Reload extension could not restore state",n)}catch(e){i("Reload extension error while trying to restore cookie",e)}break;case"/meta/connect":s.transportType||(s.transportType=e.connectionType,i("Reload extension tracked transport type",s.transportType));break;case"/meta/disconnect":s=null}var o;return e},this.incoming=function(e){if(e.successful)switch(e.channel){case"/meta/handshake":s.handshakeResponse||(s.handshakeResponse=e,i("Reload extension tracked handshake response",e));break;case"/meta/disconnect":s=null;break;case"/meta/connect":c&&(r.endBatch(),c=!1)}return e},l(e)}}"function"==typeof define&&define.amd?define(["org/cometd"],e):e(org.cometd)}(),function(){function e(r){return r.TimeSyncExtension=function(e){var o,u=e&&e.maxSamples||10,l=[],d=[],g=0,f=0;function h(e,t){o._debug(e,t)}this.registered=function(e,t){o=t,h("TimeSyncExtension: executing registration callback")},this.unregistered=function(){h("TimeSyncExtension: executing unregistration callback"),o=null,l=[],d=[]},this.incoming=function(e){var t=e.channel;if(t&&0===t.indexOf("/meta/")&&e.ext&&e.ext.timesync){var n=e.ext.timesync;h("TimeSyncExtension: server sent timesync",n);var o=((new Date).getTime()-n.tc-n.p)/2,r=n.ts-n.tc-o;l.push(o),d.push(r),d.length>u&&(d.shift(),l.shift());for(var i=d.length,s=0,a=0,c=0;c<i;++c)s+=l[c],a+=d[c];g=parseInt((s/i).toFixed()),f=parseInt((a/i).toFixed()),h("TimeSyncExtension: network lag",g)}return e},this.outgoing=function(e){var t=e.channel;return t&&0===t.indexOf("/meta/")&&(e.ext||(e.ext={}),e.ext.timesync={tc:(new Date).getTime(),l:g,o:f},h("TimeSyncExtension: client sending timesync",r.JSON.toJSON(e.ext.timesync))),e},this.getTimeOffset=function(){return f},this.getTimeOffsetSamples=function(){return d},this.getNetworkLag=function(){return g},this.getServerTime=function(){return(new Date).getTime()+f},this.getServerDate=function(){return new Date(this.getServerTime())},this.setTimeout=function(e,t){var n=(t instanceof Date?t.getTime():0+t)-f-(new Date).getTime();return n<=0&&(n=1),r.Utils.setTimeout(o,e,n)}}}"function"==typeof define&&define.amd?define(["org/cometd"],e):e(org.cometd)}(),function(){function e(n,o){function r(e,t){if(t)for(var n in t)"content-type"!==n.toLowerCase()&&e.setRequestHeader(n,t[n])}function i(){var e=new o.LongPollingTransport,t=o.Transport.derive(e);return t.xhrSend=function(o){return n.ajax({url:o.url,async:!0!==o.sync,type:"POST",contentType:"application/json;charset=UTF-8",data:o.body,xhrFields:{withCredentials:!0},beforeSend:function(e){return e.withCredentials=!0,r(e,o.headers),!0},success:o.onSuccess,error:function(e,t,n){o.onError(t,n)}})},t}function s(){var e=new o.CallbackPollingTransport,t=o.Transport.derive(e);return t.jsonpSend=function(o){n.ajax({url:o.url,async:!0!==o.sync,type:"GET",dataType:"jsonp",jsonp:"jsonp",xhrFields:{withCredentials:!0},data:{message:o.body},beforeSend:function(e){return r(e,o.headers),!0},success:o.onSuccess,error:function(e,t,n){o.onError(t,n)}})},t}return o.JSON.toJSON=JSON.stringify,o.JSON.fromJSON=JSON.parse,n.CometD=function(e){var t=new o.CometD(e);return o.WebSocket&&t.registerTransport("websocket",new o.WebSocketTransport),t.registerTransport("long-polling",new i),t.registerTransport("callback-polling",new s),t},n.cometd=new n.CometD,n.cometd}"function"==typeof define&&define.amd&&define(["jquery","org/cometd"],e),"undefined"!=typeof module?module.exports=e(require("jquery"),require("../org/cometd.js")):e(jQuery,org.cometd)}(),function(){function e(e,t){var n=new e;return t.registerExtension("ack",n),n}"function"==typeof define&&define.amd?define(["org/cometd/AckExtension","jquery.cometd"],e):e(org.cometd.AckExtension,jQuery.cometd)}(),function(){function e(e,t,n,o){t&&(e.COOKIE.set=t,e.COOKIE.get=t);var r=new n;return o.registerExtension("reload",r),r}"function"==typeof define&&define.amd?define(["org/cometd","jquery.cookie","org/cometd/ReloadExtension","jquery.cometd"],e):e(org.cometd,jQuery.cookie,org.cometd.ReloadExtension,jQuery.cometd)}(),function(){function e(e,t){var n=new e;return t.registerExtension("timesync",n),n}"function"==typeof define&&define.amd?define(["org/cometd/TimeSyncExtension","jquery.cometd"],e):e(org.cometd.TimeSyncExtension,jQuery.cometd)}();
//# sourceMappingURL=epicenter-multiplayer-dependencies.min.js.map