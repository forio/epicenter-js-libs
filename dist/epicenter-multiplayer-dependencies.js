this.org=this.org||{};org.cometd={};org.cometd.JSON={};org.cometd.JSON.toJSON=org.cometd.JSON.fromJSON=function(a){throw"Abstract"};org.cometd.Utils={};org.cometd.Utils.isString=function(a){if(a===undefined||a===null){return false}return typeof a==="string"||a instanceof String};org.cometd.Utils.isArray=function(a){if(a===undefined||a===null){return false}return a instanceof Array};org.cometd.Utils.inArray=function(a,b){for(var c=0;c<b.length;++c){if(a===b[c]){return c}}return-1};org.cometd.Utils.setTimeout=function(a,b,c){return window.setTimeout(function(){try{b()}catch(c){a._debug("Exception invoking timed function",b,c)}},c)};org.cometd.Utils.clearTimeout=function(a){window.clearTimeout(a)};org.cometd.TransportRegistry=function(){var a=[];var b={};this.getTransportTypes=function(){return a.slice(0)};this.findTransportTypes=function(c,d,e){var f=[];for(var g=0;g<a.length;++g){var h=a[g];if(b[h].accept(c,d,e)===true){f.push(h)}}return f};this.negotiateTransport=function(c,d,e,f){for(var g=0;g<a.length;++g){var h=a[g];for(var i=0;i<c.length;++i){if(h===c[i]){var j=b[h];if(j.accept(d,e,f)===true){return j}}}}return null};this.add=function(c,d,e){var f=false;for(var g=0;g<a.length;++g){if(a[g]===c){f=true;break}}if(!f){if(typeof e!=="number"){a.push(c)}else{a.splice(e,0,c)}b[c]=d}return!f};this.find=function(c){for(var d=0;d<a.length;++d){if(a[d]===c){return b[c]}}return null};this.remove=function(c){for(var d=0;d<a.length;++d){if(a[d]===c){a.splice(d,1);var e=b[c];delete b[c];return e}}return null};this.clear=function(){a=[];b={}};this.reset=function(){for(var c=0;c<a.length;++c){b[a[c]].reset()}}};org.cometd.Transport=function(){var a;var b;this.registered=function(c,d){a=c;b=d};this.unregistered=function(){a=null;b=null};this._debug=function(){b._debug.apply(b,arguments)};this._mixin=function(){return b._mixin.apply(b,arguments)};this.getConfiguration=function(){return b.getConfiguration()};this.getAdvice=function(){return b.getAdvice()};this.setTimeout=function(a,c){return org.cometd.Utils.setTimeout(b,a,c)};this.clearTimeout=function(a){org.cometd.Utils.clearTimeout(a)};this.convertToMessages=function(a){if(org.cometd.Utils.isString(a)){try{return org.cometd.JSON.fromJSON(a)}catch(b){this._debug("Could not convert to JSON the following string",'"'+a+'"');throw b}}if(org.cometd.Utils.isArray(a)){return a}if(a===undefined||a===null){return[]}if(a instanceof Object){return[a]}throw"Conversion Error "+a+", typeof "+typeof a};this.accept=function(a,b,c){throw"Abstract"};this.getType=function(){return a};this.send=function(a,b){throw"Abstract"};this.reset=function(){this._debug("Transport",a,"reset")};this.abort=function(){this._debug("Transport",a,"aborted")};this.toString=function(){return this.getType()}};org.cometd.Transport.derive=function(a){function b(){}b.prototype=a;return new b};org.cometd.RequestTransport=function(){var a=new org.cometd.Transport;var b=org.cometd.Transport.derive(a);var c=0;var d=null;var e=[];var f=[];function g(a){while(f.length>0){var b=f[0];var c=b[0];var d=b[1];if(c.url===a.url&&c.sync===a.sync){f.shift();a.messages=a.messages.concat(c.messages);this._debug("Coalesced",c.messages.length,"messages from request",d.id);continue}break}}function h(a,b){this.transportSend(a,b);b.expired=false;if(!a.sync){var c=this.getConfiguration().maxNetworkDelay;var d=c;if(b.metaConnect===true){d+=this.getAdvice().timeout}this._debug("Transport",this.getType(),"waiting at most",d,"ms for the response, maxNetworkDelay",c);var e=this;b.timeout=this.setTimeout(function(){b.expired=true;var c="Request "+b.id+" of transport "+e.getType()+" exceeded "+d+" ms max network delay";var f={reason:c};var g=b.xhr;f.httpCode=e.xhrStatus(g);e.abortXHR(g);e._debug(c);e.complete(b,false,b.metaConnect);a.onFailure(g,a.messages,f)},d)}}function i(a){var b=++c;var d={id:b,metaConnect:false};if(e.length<this.getConfiguration().maxConnections-1){e.push(d);h.call(this,a,d)}else{this._debug("Transport",this.getType(),"queueing request",b,"envelope",a);f.push([a,d])}}function j(a){var b=a.id;this._debug("Transport",this.getType(),"metaConnect complete, request",b);if(d!==null&&d.id!==b){throw"Longpoll request mismatch, completing request "+b}d=null}function k(a,b){var c=org.cometd.Utils.inArray(a,e);if(c>=0){e.splice(c,1)}if(f.length>0){var d=f.shift();var h=d[0];var j=d[1];this._debug("Transport dequeued request",j.id);if(b){if(this.getConfiguration().autoBatch){g.call(this,h)}i.call(this,h);this._debug("Transport completed request",a.id,h)}else{var k=this;this.setTimeout(function(){k.complete(j,false,j.metaConnect);var a={reason:"Previous request failed"};var b=j.xhr;a.httpCode=k.xhrStatus(b);h.onFailure(b,h.messages,a)},0)}}}b.complete=function(a,b,c){if(c){j.call(this,a)}else{k.call(this,a,b)}};b.transportSend=function(a,b){throw"Abstract"};b.transportSuccess=function(a,b,c){if(!b.expired){this.clearTimeout(b.timeout);this.complete(b,true,b.metaConnect);if(c&&c.length>0){a.onSuccess(c)}else{a.onFailure(b.xhr,a.messages,{httpCode:204})}}};b.transportFailure=function(a,b,c){if(!b.expired){this.clearTimeout(b.timeout);this.complete(b,false,b.metaConnect);a.onFailure(b.xhr,a.messages,c)}};function l(a){if(d!==null){throw"Concurrent metaConnect requests not allowed, request id="+d.id+" not yet completed"}var b=++c;this._debug("Transport",this.getType(),"metaConnect send, request",b,"envelope",a);var e={id:b,metaConnect:true};h.call(this,a,e);d=e}b.send=function(a,b){if(b){l.call(this,a)}else{i.call(this,a)}};b.abort=function(){a.abort();for(var b=0;b<e.length;++b){var c=e[b];this._debug("Aborting request",c);this.abortXHR(c.xhr)}if(d){this._debug("Aborting metaConnect request",d);this.abortXHR(d.xhr)}this.reset()};b.reset=function(){a.reset();d=null;e=[];f=[]};b.abortXHR=function(a){if(a){try{a.abort()}catch(b){this._debug(b)}}};b.xhrStatus=function(a){if(a){try{return a.status}catch(b){this._debug(b)}}return-1};return b};org.cometd.LongPollingTransport=function(){var a=new org.cometd.RequestTransport;var b=org.cometd.Transport.derive(a);var c=true;b.accept=function(a,b,d){return c||!b};b.xhrSend=function(a){throw"Abstract"};b.transportSend=function(a,b){this._debug("Transport",this.getType(),"sending request",b.id,"envelope",a);var d=this;try{var e=true;b.xhr=this.xhrSend({transport:this,url:a.url,sync:a.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(a.messages),onSuccess:function(e){d._debug("Transport",d.getType(),"received response",e);var f=false;try{var g=d.convertToMessages(e);if(g.length===0){c=false;d.transportFailure(a,b,{httpCode:204})}else{f=true;d.transportSuccess(a,b,g)}}catch(h){d._debug(h);if(!f){c=false;var i={exception:h};i.httpCode=d.xhrStatus(b.xhr);d.transportFailure(a,b,i)}}},onError:function(f,g){c=false;var h={reason:f,exception:g};h.httpCode=d.xhrStatus(b.xhr);if(e){d.setTimeout(function(){d.transportFailure(a,b,h)},0)}else{d.transportFailure(a,b,h)}}});e=false}catch(f){c=false;this.setTimeout(function(){d.transportFailure(a,b,{exception:f})},0)}};b.reset=function(){a.reset();c=true};return b};org.cometd.CallbackPollingTransport=function(){var a=new org.cometd.RequestTransport;var b=org.cometd.Transport.derive(a);var c=2e3;b.accept=function(a,b,c){return true};b.jsonpSend=function(a){throw"Abstract"};b.transportSend=function(a,b){var d=this;var e=0;var f=a.messages.length;var g=[];while(f>0){var h=org.cometd.JSON.toJSON(a.messages.slice(e,e+f));var i=a.url.length+encodeURI(h).length;if(i>c){if(f===1){this.setTimeout(function(){d.transportFailure(a,b,{reason:"Bayeux message too big, max is "+c})},0);return}--f;continue}g.push(f);e+=f;f=a.messages.length-e}var j=a;if(g.length>1){var k=0;var l=g[0];this._debug("Transport",this.getType(),"split",a.messages.length,"messages into",g.join(" + "));j=this._mixin(false,{},a);j.messages=a.messages.slice(k,l);j.onSuccess=a.onSuccess;j.onFailure=a.onFailure;for(var m=1;m<g.length;++m){var n=this._mixin(false,{},a);k=l;l+=g[m];n.messages=a.messages.slice(k,l);n.onSuccess=a.onSuccess;n.onFailure=a.onFailure;this.send(n,b.metaConnect)}}this._debug("Transport",this.getType(),"sending request",b.id,"envelope",j);try{var o=true;this.jsonpSend({transport:this,url:j.url,sync:j.sync,headers:this.getConfiguration().requestHeaders,body:org.cometd.JSON.toJSON(j.messages),onSuccess:function(a){var c=false;try{var e=d.convertToMessages(a);if(e.length===0){d.transportFailure(j,b,{httpCode:204})}else{c=true;d.transportSuccess(j,b,e)}}catch(f){d._debug(f);if(!c){d.transportFailure(j,b,{exception:f})}}},onError:function(a,c){var e={reason:a,exception:c};if(o){d.setTimeout(function(){d.transportFailure(j,b,e)},0)}else{d.transportFailure(j,b,e)}}});o=false}catch(p){this.setTimeout(function(){d.transportFailure(j,b,{exception:p})},0)}};return b};org.cometd.WebSocketTransport=function(){var a=new org.cometd.Transport;var b=org.cometd.Transport.derive(a);var c;var d=true;var e=false;var f=true;var g={};var h={};var i=false;var j=null;var k=false;var l=null;b.reset=function(){a.reset();d=true;e=false;f=true;g={};h={};i=false;j=null;k=false;l=null};function m(){if(i){return}i=true;var a=c.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",a);try{var b=c.getConfiguration().protocol;var e=b?new org.cometd.WebSocket(a,b):new org.cometd.WebSocket(a)}catch(g){d=false;this._debug("Exception while creating WebSocket object",g);throw g}f=c.getConfiguration().stickyReconnect!==false;var h=this;var k=null;var l=c.getConfiguration().connectTimeout;if(l>0){k=this.setTimeout(function(){k=null;h._debug("Transport",h.getType(),"timed out while connecting to URL",a,":",l,"ms");var b={code:1e3,reason:"Connect Timeout"};h.webSocketClose(e,b.code,b.reason);h.onClose(e,b)},l)}var m=function(){h._debug("WebSocket opened",e);i=false;if(k){h.clearTimeout(k);k=null}if(j){c._warn("Closing Extra WebSocket Connections",e,j);h.webSocketClose(e,1e3,"Extra Connection")}else{h.onOpen(e)}};var n=function(a){a=a||{code:1e3};h._debug("WebSocket closing",e,a);i=false;if(k){h.clearTimeout(k);k=null}if(j!==null&&e!==j){h._debug("Closed Extra WebSocket Connection",e)}else{h.onClose(e,a)}};var o=function(a){h._debug("WebSocket message",a,e);if(e!==j){c._warn("Extra WebSocket Connections",e,j)}h.onMessage(e,a)};e.onopen=m;e.onclose=n;e.onerror=function(){n({code:1002,reason:"Error"})};e.onmessage=o;this._debug("Transport",this.getType(),"configured callbacks on",e)}function n(a,b,c){var d=org.cometd.JSON.toJSON(b.messages);a.send(d);this._debug("Transport",this.getType(),"sent",b,"metaConnect =",c);var e=this.getConfiguration().maxNetworkDelay;var f=e;if(c){f+=this.getAdvice().timeout;k=true}var g=this;var i=[];for(var j=0;j<b.messages.length;++j){(function(){var c=b.messages[j];if(c.id){i.push(c.id);h[c.id]=this.setTimeout(function(){g._debug("Transport",g.getType(),"timing out message",c.id,"after",f,"on",a);var b={code:1e3,reason:"Message Timeout"};g.webSocketClose(a,b.code,b.reason);g.onClose(a,b)},f)}})()}this._debug("Transport",this.getType(),"waiting at most",f,"ms for messages",i,"maxNetworkDelay",e,", timeouts:",h)}function o(a,b,c){try{if(a===null){m.call(this)}else{n.call(this,a,b,c)}}catch(d){this.setTimeout(function(){b.onFailure(a,b.messages,{exception:d})},0)}}b.onOpen=function(a){this._debug("Transport",this.getType(),"opened",a);j=a;e=true;this._debug("Sending pending messages",g);for(var b in g){var c=g[b];var d=c[0];var f=c[1];l=d.onSuccess;n.call(this,a,d,f)}};b.onMessage=function(a,b){this._debug("Transport",this.getType(),"received websocket message",b,a);var c=false;var d=this.convertToMessages(b.data);var e=[];for(var f=0;f<d.length;++f){var i=d[f];if(/^\/meta\//.test(i.channel)||i.successful!==undefined){if(i.id){e.push(i.id);var j=h[i.id];if(j){this.clearTimeout(j);delete h[i.id];this._debug("Transport",this.getType(),"removed timeout for message",i.id,", timeouts",h)}}}if("/meta/connect"===i.channel){k=false}if("/meta/disconnect"===i.channel&&!k){c=true}}var m=false;for(var n=0;n<e.length;++n){var o=e[n];for(var p in g){var q=p.split(",");var r=org.cometd.Utils.inArray(o,q);if(r>=0){m=true;q.splice(r,1);var s=g[p][0];var t=g[p][1];delete g[p];if(q.length>0){g[q.join(",")]=[s,t]}break}}}if(m){this._debug("Transport",this.getType(),"removed envelope, envelopes",g)}l.call(this,d);if(c){this.webSocketClose(a,1e3,"Disconnect")}};b.onClose=function(a,b){this._debug("Transport",this.getType(),"closed",a,b);d=f&&e;for(var c in h){this.clearTimeout(h[c])}h={};for(var i in g){var l=g[i][0];var m=g[i][1];if(m){k=false}l.onFailure(a,l.messages,{websocketCode:b.code,reason:b.reason})}g={};j=null};b.registered=function(b,d){a.registered(b,d);c=d};b.accept=function(a,b,e){return d&&!!org.cometd.WebSocket&&c.websocketEnabled!==false};b.send=function(a,b){this._debug("Transport",this.getType(),"sending",a,"metaConnect =",b);var c=[];for(var d=0;d<a.messages.length;++d){var e=a.messages[d];if(e.id){c.push(e.id)}}g[c.join(",")]=[a,b];this._debug("Transport",this.getType(),"stored envelope, envelopes",g);o.call(this,j,a,b)};b.webSocketClose=function(a,b,c){try{a.close(b,c)}catch(d){this._debug(d)}};b.abort=function(){a.abort();if(j){var b={code:1001,reason:"Abort"};this.webSocketClose(j,b.code,b.reason);this.onClose(j,b)}this.reset()};return b};org.cometd.Cometd=function(a){var b=this;var c=a||"default";var d=false;var e=new org.cometd.TransportRegistry;var f;var g="disconnected";var h=0;var i=null;var j=0;var k=[];var l=false;var m={};var n=0;var o=null;var p=[];var q={};var r;var s;var t={};var u=false;var v=false;var w={protocol:null,stickyReconnect:true,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",reverseIncomingExtensions:true,maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:true,autoBatch:false,advice:{timeout:6e4,interval:0,reconnect:"retry"}};function x(a,b){try{return a[b]}catch(c){return undefined}}this._mixin=function(a,b,c){var d=b||{};for(var e=2;e<arguments.length;++e){var f=arguments[e];if(f===undefined||f===null){continue}for(var g in f){var h=x(f,g);var i=x(d,g);if(h===b){continue}if(h===undefined){continue}if(a&&typeof h==="object"&&h!==null){if(h instanceof Array){d[g]=this._mixin(a,i instanceof Array?i:[],h)}else{var j=typeof i==="object"&&!(i instanceof Array)?i:{};d[g]=this._mixin(a,j,h)}}else{d[g]=h}}}return d};function y(a){return org.cometd.Utils.isString(a)}function z(a){if(a===undefined||a===null){return false}return typeof a==="function"}function A(a,b){if(window.console){var c=window.console[a];if(z(c)){c.apply(window.console,b)}}}this._warn=function(){A("warn",arguments)};this._info=function(){if(w.logLevel!=="warn"){A("info",arguments)}};this._debug=function(){if(w.logLevel==="debug"){A("debug",arguments)}};this._isCrossDomain=function(a){return a&&a!==window.location.host};function B(a){b._debug("Configuring cometd object with",a);if(y(a)){a={url:a}}if(!a){a={}}w=b._mixin(false,w,a);var c=b.getURL();if(!c){throw"Missing required configuration parameter 'url' specifying the Bayeux server URL"}var e=/(^https?:\/\/)?(((\[[^\]]+\])|([^:\/\?#]+))(:(\d+))?)?([^\?#]*)(.*)?/.exec(c);var f=e[2];var g=e[8];var h=e[9];d=b._isCrossDomain(f);if(w.appendMessageTypeToURL){if(h!==undefined&&h.length>0){b._info("Appending message type to URI "+g+h+" is not supported, disabling 'appendMessageTypeToURL' configuration");w.appendMessageTypeToURL=false}else{var i=g.split("/");var j=i.length-1;if(g.match(/\/$/)){j-=1}if(i[j].indexOf(".")>=0){b._info("Appending message type to URI "+g+" is not supported, disabling 'appendMessageTypeToURL' configuration");w.appendMessageTypeToURL=false}}}}function C(a){if(a){var c=m[a.channel];if(c&&c[a.id]){delete c[a.id];b._debug("Removed",a.listener?"listener":"subscription",a)}}}function D(a){if(a&&!a.listener){C(a)}}function E(){for(var a in m){var b=m[a];if(b){for(var c=0;c<b.length;++c){D(b[c])}}}}function F(a){if(g!==a){b._debug("Status",g,"->",a);g=a}}function G(){return g==="disconnecting"||g==="disconnected"}function H(){return++h}function I(a,c,d,e,f){try{return c.call(a,e)}catch(g){b._debug("Exception during execution of extension",d,g);var h=b.onExtensionException;if(z(h)){b._debug("Invoking extension exception callback",d,g);try{h.call(b,g,d,f,e)}catch(i){b._info("Exception during execution of exception callback in extension",d,i)}}return e}}function J(a){for(var b=0;b<p.length;++b){if(a===undefined||a===null){break}var c=w.reverseIncomingExtensions?p.length-1-b:b;var d=p[c];var e=d.extension.incoming;if(z(e)){var f=I(d.extension,e,d.name,a,false);a=f===undefined?a:f}}return a}function K(a){for(var b=0;b<p.length;++b){if(a===undefined||a===null){break}var c=p[b];var d=c.extension.outgoing;if(z(d)){var e=I(c.extension,d,c.name,a,true);a=e===undefined?a:e}}return a}function L(a,c){var d=m[a];if(d&&d.length>0){for(var e=0;e<d.length;++e){var f=d[e];if(f){try{f.callback.call(f.scope,c)}catch(g){b._debug("Exception during notification",f,c,g);var h=b.onListenerException;if(z(h)){b._debug("Invoking listener exception callback",f,g);try{h.call(b,g,f,f.listener,c)}catch(i){b._info("Exception during execution of listener callback",f,i)}}}}}}}function M(a,b){L(a,b);var c=a.split("/");var d=c.length-1;for(var e=d;e>0;--e){var f=c.slice(0,e).join("/")+"/*";if(e===d){L(f,b)}f+="*";L(f,b)}}function N(){if(o!==null){org.cometd.Utils.clearTimeout(o)}o=null}function O(a){N();var c=q.interval+n;b._debug("Function scheduled in",c,"ms, interval =",q.interval,"backoff =",n,a);o=org.cometd.Utils.setTimeout(b,a,c)}var P;var Q;function R(a,c,d,e){for(var g=0;g<c.length;++g){var h=c[g];var j=""+H();h.id=j;if(i){h.clientId=i}var k=undefined;if(z(h._callback)){k=h._callback;delete h._callback}h=K(h);if(h!==undefined&&h!==null){h.id=j;c[g]=h;if(k){t[j]=k}}else{c.splice(g--,1)}}if(c.length===0){return}var l=b.getURL();if(w.appendMessageTypeToURL){if(!l.match(/\/$/)){l=l+"/"}if(e){l=l+e}}var m={url:l,sync:a,messages:c,onSuccess:function(a){try{P.call(b,a)}catch(c){b._debug("Exception during handling of messages",c)}},onFailure:function(a,c,d){try{var e=b.getTransport();d.connectionType=e?e.getType():"unknown";Q.call(b,a,c,d)}catch(f){b._debug("Exception during handling of failure",f)}}};b._debug("Send",m);f.send(m,d)}function S(a){if(j>0||l===true){k.push(a)}else{R(false,[a],false)}}this.send=S;function T(){n=0}function U(){if(n<w.maxBackoff){n+=w.backoffIncrement}}function V(){++j}function W(){var a=k;k=[];if(a.length>0){R(false,a,false)}}function X(){--j;if(j<0){throw"Calls to startBatch() and endBatch() are not paired"}if(j===0&&!G()&&!l){W()}}function Y(){if(!G()){var a={channel:"/meta/connect",connectionType:f.getType()};if(!v){a.advice={timeout:0}}F("connecting");b._debug("Connect sent",a);R(false,[a],true,"connect");F("connected")}}function Z(){F("connecting");O(function(){Y()})}function $(a){if(a){q=b._mixin(false,{},w.advice,a);b._debug("New advice",q)}}function _(a){N();if(a&&f){f.abort()}i=null;F("disconnected");j=0;T();f=null;if(k.length>0){var c=k;k=[];Q.call(b,undefined,c,{reason:"Disconnected"})}}function ab(a,c,d){var e=b.onTransportFailure;if(z(e)){b._debug("Invoking transport failure callback",a,c,d);try{e.call(b,a,c,d)}catch(f){b._info("Exception during execution of transport failure callback",f)}}}function bb(a,c){if(z(a)){c=a;a=undefined}i=null;E();if(G()){e.reset();$(w.advice)}else{$(b._mixin(false,q,{reconnect:"retry"}))}j=0;l=true;r=a;s=c;var g="1.0";var h=b.getURL();var k=e.findTransportTypes(g,d,h);var m={version:g,minimumVersion:g,channel:"/meta/handshake",supportedConnectionTypes:k,_callback:c,advice:{timeout:q.timeout,interval:q.interval}};var n=b._mixin(false,{},r,m);if(!f){f=e.negotiateTransport(k,g,d,h);if(!f){var o="Could not find initial transport among: "+e.getTransportTypes();b._warn(o);throw o}}b._debug("Initial transport is",f.getType());F("handshaking");b._debug("Handshake sent",n);R(false,[n],false,"handshake")}function cb(){F("handshaking");l=true;O(function(){bb(r,s)})}function db(a){var c=t[a.id];if(z(c)){delete t[a.id];c.call(b,a)}}function eb(a){db(a);M("/meta/handshake",a);M("/meta/unsuccessful",a);var b=!G()&&q.reconnect!=="none";if(b){U();cb()}else{_(false)}}function fb(a){if(a.successful){i=a.clientId;var c=b.getURL();var g=e.negotiateTransport(a.supportedConnectionTypes,a.version,d,c);if(g===null){var h="Could not negotiate transport with server; client=["+e.findTransportTypes(a.version,d,c)+"], server=["+a.supportedConnectionTypes+"]";var j=b.getTransport();ab(j.getType(),null,{reason:h,connectionType:j.getType(),transport:j});b._warn(h);_(true);return}else if(f!==g){b._debug("Transport",f.getType(),"->",g.getType());f=g}l=false;W();a.reestablish=u;u=true;db(a);M("/meta/handshake",a);var k=G()?"none":q.reconnect;switch(k){case"retry":T();Z();break;case"none":_(false);break;default:throw"Unrecognized advice action "+k}}else{eb(a)}}function gb(a){var c="1.0";var g=b.getURL();var h=b.getTransport();var i=e.findTransportTypes(c,d,g);var j=e.negotiateTransport(i,c,d,g);if(!j){ab(h.getType(),null,a.failure);b._warn("Could not negotiate transport; client=["+i+"]");_(true);eb(a)}else{b._debug("Transport",h.getType(),"->",j.getType());ab(h.getType(),j.getType(),a.failure);eb(a);f=j}}function hb(a){M("/meta/connect",a);M("/meta/unsuccessful",a);var b=G()?"none":q.reconnect;switch(b){case"retry":Z();U();break;case"handshake":e.reset();T();cb();break;case"none":_(false);break;default:throw"Unrecognized advice action"+b}}function ib(a){v=a.successful;if(v){M("/meta/connect",a);var b=G()?"none":q.reconnect;switch(b){case"retry":T();Z();break;case"none":_(false);break;default:throw"Unrecognized advice action "+b}}else{hb(a)}}function jb(a){v=false;hb(a)}function kb(a){_(true);db(a);M("/meta/disconnect",a);M("/meta/unsuccessful",a)}function lb(a){if(a.successful){_(false);db(a);M("/meta/disconnect",a)}else{kb(a)}}function mb(a){kb(a)}function nb(a){var c=m[a.subscription];if(c){for(var d=c.length-1;d>=0;--d){var e=c[d];if(e&&!e.listener){delete c[d];b._debug("Removed failed subscription",e);break}}}db(a);M("/meta/subscribe",a);M("/meta/unsuccessful",a)}function ob(a){if(a.successful){db(a);M("/meta/subscribe",a)}else{nb(a)}}function pb(a){nb(a)}function qb(a){db(a);M("/meta/unsubscribe",a);M("/meta/unsuccessful",a)}function rb(a){if(a.successful){db(a);M("/meta/unsubscribe",a)}else{qb(a)}}function sb(a){qb(a)}function tb(a){db(a);M("/meta/publish",a);M("/meta/unsuccessful",a)}function ub(a){if(a.successful===undefined){if(a.data!==undefined){M(a.channel,a)}else{b._warn("Unknown Bayeux Message",a)}}else{if(a.successful){db(a);M("/meta/publish",a)}else{tb(a)}}}function vb(a){tb(a)}function wb(a){a=J(a);if(a===undefined||a===null){return}$(a.advice);var b=a.channel;switch(b){case"/meta/handshake":fb(a);break;case"/meta/connect":ib(a);break;case"/meta/disconnect":lb(a);break;case"/meta/subscribe":ob(a);break;case"/meta/unsubscribe":rb(a);break;default:ub(a);break}}this.receive=wb;P=function(a){b._debug("Received",a);for(var c=0;c<a.length;++c){var d=a[c];wb(d)}};Q=function(a,c,d){b._debug("handleFailure",a,c,d);d.transport=a;for(var e=0;e<c.length;++e){var f=c[e];var g={id:f.id,successful:false,channel:f.channel,failure:d};d.message=f;switch(f.channel){case"/meta/handshake":gb(g);break;case"/meta/connect":jb(g);break;case"/meta/disconnect":mb(g);break;case"/meta/subscribe":g.subscription=f.subscription;pb(g);break;case"/meta/unsubscribe":g.subscription=f.subscription;sb(g);break;default:vb(g);break}}};function xb(a){var b=m[a];if(b){for(var c=0;c<b.length;++c){if(b[c]){return true}}}return false}function yb(a,b){var c={scope:a,method:b};if(z(a)){c.scope=undefined;c.method=a}else{if(y(b)){if(!a){throw"Invalid scope "+a}c.method=a[b];if(!z(c.method)){throw"Invalid callback "+b+" for scope "+a}}else if(!z(b)){throw"Invalid callback "+b}}return c}function zb(a,c,d,e){var f=yb(c,d);b._debug("Adding",e?"listener":"subscription","on",a,"with scope",f.scope,"and callback",f.method);var g={channel:a,scope:f.scope,callback:f.method,listener:e};var h=m[a];if(!h){h=[];m[a]=h}g.id=h.push(g)-1;b._debug("Added",e?"listener":"subscription",g);g[0]=a;g[1]=g.id;return g}this.registerTransport=function(a,b,c){var d=e.add(a,b,c);if(d){this._debug("Registered transport",a);if(z(b.registered)){b.registered(a,this)}}return d};this.getTransportTypes=function(){return e.getTransportTypes()};this.unregisterTransport=function(a){var b=e.remove(a);if(b!==null){this._debug("Unregistered transport",a);if(z(b.unregistered)){b.unregistered()}}return b};this.unregisterTransports=function(){e.clear()};this.findTransport=function(a){return e.find(a)};this.configure=function(a){B.call(this,a)};this.init=function(a,b){this.configure(a);this.handshake(b)};this.handshake=function(a,b){F("disconnected");u=false;bb(a,b)};this.disconnect=function(a,b,c){if(G()){return}if(typeof a!=="boolean"){c=b;b=a;a=false}if(z(b)){c=b;b=undefined}var d={channel:"/meta/disconnect",_callback:c};var e=this._mixin(false,{},b,d);F("disconnecting");R(a===true,[e],false,"disconnect")};this.startBatch=function(){V()};this.endBatch=function(){X()};this.batch=function(a,b){var c=yb(a,b);this.startBatch();try{c.method.call(c.scope);this.endBatch()}catch(d){this._info("Exception during execution of batch",d);this.endBatch();throw d}};this.addListener=function(a,b,c){if(arguments.length<2){throw"Illegal arguments number: required 2, got "+arguments.length}if(!y(a)){throw"Illegal argument type: channel must be a string"}return zb(a,b,c,true)};this.removeListener=function(a){if(!a||!a.channel||!("id"in a)){throw"Invalid argument: expected subscription, not "+a}C(a)};this.clearListeners=function(){m={}};this.subscribe=function(a,b,c,d,e){if(arguments.length<2){throw"Illegal arguments number: required 2, got "+arguments.length}if(!y(a)){throw"Illegal argument type: channel must be a string"}if(G()){throw"Illegal state: already disconnected"}if(z(b)){e=d;d=c;c=b;b=undefined}if(z(d)){e=d;d=undefined}var f=!xb(a);var g=zb(a,b,c,false);if(f){var h={channel:"/meta/subscribe",subscription:a,_callback:e};var i=this._mixin(false,{},d,h);S(i)}return g};this.unsubscribe=function(a,b,c){if(arguments.length<1){throw"Illegal arguments number: required 1, got "+arguments.length}if(G()){throw"Illegal state: already disconnected"}if(z(b)){c=b;b=undefined}this.removeListener(a);var d=a.channel;if(!xb(d)){var e={channel:"/meta/unsubscribe",subscription:d,_callback:c};var f=this._mixin(false,{},b,e);S(f)}};this.resubscribe=function(a,b){D(a);if(a){return this.subscribe(a.channel,a.scope,a.callback,b)}return undefined};this.clearSubscriptions=function(){E()};this.publish=function(a,b,c,d){if(arguments.length<1){throw"Illegal arguments number: required 1, got "+arguments.length}if(!y(a)){throw"Illegal argument type: channel must be a string"}if(/^\/meta\//.test(a)){throw"Illegal argument: cannot publish to meta channels"}if(G()){throw"Illegal state: already disconnected"}if(z(b)){d=b;b=c={}}else if(z(c)){d=c;c={}}var e={channel:a,data:b,_callback:d};var f=this._mixin(false,{},c,e);S(f)};this.getStatus=function(){return g};this.isDisconnected=G;this.setBackoffIncrement=function(a){w.backoffIncrement=a};this.getBackoffIncrement=function(){return w.backoffIncrement};this.getBackoffPeriod=function(){return n};this.setLogLevel=function(a){w.logLevel=a};this.registerExtension=function(a,b){if(arguments.length<2){throw"Illegal arguments number: required 2, got "+arguments.length}if(!y(a)){throw"Illegal argument type: extension name must be a string"}var c=false;for(var d=0;d<p.length;++d){var e=p[d];if(e.name===a){c=true;break}}if(!c){p.push({name:a,extension:b});this._debug("Registered extension",a);if(z(b.registered)){b.registered(a,this)}return true}else{this._info("Could not register extension with name",a,"since another extension with the same name already exists");return false}};this.unregisterExtension=function(a){if(!y(a)){throw"Illegal argument type: extension name must be a string"}var b=false;for(var c=0;c<p.length;++c){var d=p[c];if(d.name===a){p.splice(c,1);b=true;this._debug("Unregistered extension",a);var e=d.extension;if(z(e.unregistered)){e.unregistered()}break}}return b};this.getExtension=function(a){for(var b=0;b<p.length;++b){var c=p[b];if(c.name===a){return c.extension}}return null};this.getName=function(){return c};this.getClientId=function(){return i};this.getURL=function(){if(f&&typeof w.urls==="object"){var a=w.urls[f.getType()];if(a){return a}}return w.url};this.getTransport=function(){return f};this.getConfiguration=function(){return this._mixin(true,{},w)};this.getAdvice=function(){return this._mixin(true,{},q)};org.cometd.WebSocket=window.WebSocket;if(!org.cometd.WebSocket){org.cometd.WebSocket=window.MozWebSocket}};(function(){function a(a,b){b.JSON.toJSON=JSON.stringify;b.JSON.fromJSON=JSON.parse;function c(a,b){if(b){for(var c in b){if(c.toLowerCase()==="content-type"){continue}a.setRequestHeader(c,b[c])}}}function d(){var d=new b.LongPollingTransport;var e=b.Transport.derive(d);e.xhrSend=function(b){return a.ajax({url:b.url,async:b.sync!==true,type:"POST",contentType:"application/json;charset=UTF-8",data:b.body,beforeSend:function(a){a.withCredentials=true;c(a,b.headers);return true},success:b.onSuccess,error:function(a,c,d){b.onError(c,d)}})};return e}function e(){var d=new b.CallbackPollingTransport;var e=b.Transport.derive(d);e.jsonpSend=function(b){a.ajax({url:b.url,async:b.sync!==true,type:"GET",dataType:"jsonp",jsonp:"jsonp",data:{message:b.body},beforeSend:function(a){c(a,b.headers);return true},success:b.onSuccess,error:function(a,c,d){b.onError(c,d)}})};return e}a.Cometd=function(a){var c=new b.Cometd(a);if(b.WebSocket){c.registerTransport("websocket",new b.WebSocketTransport)}c.registerTransport("long-polling",new d);c.registerTransport("callback-polling",new e);return c};a.cometd=new a.Cometd;return a.cometd}if(typeof define==="function"&&define.amd){define(["jquery","org/cometd"],a)}else{a(jQuery,org.cometd)}})();
//# sourceMappingURL=epicenter-multiplayer-dependencies.js.map