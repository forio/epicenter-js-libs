/*!
 * 
 *         Epicenter Javascript libraries
 *         v2.9.2
 *         https://github.com/forio/epicenter-js-libs
 *     
 */
var F=function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=47)}([function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__ajax_http_transport__=__webpack_require__(25);var __WEBPACK_IMPORTED_MODULE_0__ajax_http_transport___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__ajax_http_transport__);__webpack_exports__.default=__WEBPACK_IMPORTED_MODULE_0__ajax_http_transport___default.a},function(module,__webpack_exports__,__webpack_require__){"use strict";function getApiUrl(apiEndpoint,serviceOptions){var urlConfig=new __WEBPACK_IMPORTED_MODULE_0__configuration_service__.default(serviceOptions).get("server");return serviceOptions.account&&(urlConfig.accountPath=serviceOptions.account),serviceOptions.project&&(urlConfig.projectPath=serviceOptions.project),urlConfig.getAPIPath(apiEndpoint)}function getDefaultOptions(defaults){var rest=Array.prototype.slice.call(arguments,1);var sessionManager=new __WEBPACK_IMPORTED_MODULE_1__store_session_manager___default.a;var serviceOptions=sessionManager.getMergedOptions.apply(sessionManager,[defaults].concat(rest));return serviceOptions.transport=$.extend(!0,{},serviceOptions.transport,{url:getApiUrl(serviceOptions.apiEndpoint,serviceOptions)}),serviceOptions.token&&$.extend(!0,serviceOptions.transport,{headers:{Authorization:"Bearer "+serviceOptions.token}}),serviceOptions}function getURLConfig(options){var urlConfig=new __WEBPACK_IMPORTED_MODULE_0__configuration_service__.default(options).get("server");return options.account&&(urlConfig.accountPath=options.account),options.project&&(urlConfig.projectPath=options.project),urlConfig}function getHTTPTransport(transportOptions,overrides){var mergedOptions=$.extend(!0,{},transportOptions,overrides);return new __WEBPACK_IMPORTED_MODULE_2_transport_http_transport_factory__.default(mergedOptions)}__webpack_exports__.a=getApiUrl,__webpack_exports__.b=getDefaultOptions,__webpack_exports__.d=getURLConfig,__webpack_exports__.c=getHTTPTransport;var __WEBPACK_IMPORTED_MODULE_0__configuration_service__=__webpack_require__(4);var __WEBPACK_IMPORTED_MODULE_1__store_session_manager__=__webpack_require__(3);var __WEBPACK_IMPORTED_MODULE_1__store_session_manager___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__store_session_manager__);var __WEBPACK_IMPORTED_MODULE_2_transport_http_transport_factory__=__webpack_require__(0)},function(module,__webpack_exports__,__webpack_require__){"use strict";function pick(obj,keys){var res={};for(var p in obj)-1!==keys.indexOf(p)&&(res[p]=obj[p]);return res}function omit(obj,keys){var copy=$.extend(!0,{},obj);return keys.forEach(function(key){delete copy[key]}),copy}function isEmpty(value){return!value||$.isPlainObject(value)&&0===Object.keys(value).length}function ensureKeysPresent(obj,keysList,context){return keysList.forEach(function(key){if(null===obj[key]||void 0===obj[key])throw new Error((context||"")+" Missing required parameter '"+key+"'' in "+JSON.stringify(obj)+" ")}),!0}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.pick=pick,__webpack_exports__.omit=omit,__webpack_exports__.isEmpty=isEmpty,__webpack_exports__.ensureKeysPresent=ensureKeysPresent},function(module,exports,__webpack_require__){"use strict";var keyNames=__webpack_require__(16);var StorageFactory=__webpack_require__(28);var optionUtils=__webpack_require__(49);var EPI_SESSION_KEY=keyNames.EPI_SESSION_KEY;var defaults={store:{synchronous:!0}};var SessionManager=function(managerOptions){function getBaseOptions(overrides){overrides=overrides||{};var libOptions=optionUtils.getOptions();return $.extend(!0,{},defaults,libOptions,managerOptions,overrides)}function getStore(overrides){var baseOptions=getBaseOptions(overrides);var storeOpts=baseOptions.store||{};var isEpicenterDomain=!baseOptions.isLocal&&!baseOptions.isCustomDomain;return void 0===storeOpts.root&&baseOptions.account&&baseOptions.project&&isEpicenterDomain&&(storeOpts.root="/app/"+baseOptions.account+"/"+baseOptions.project),new StorageFactory(storeOpts)}managerOptions=managerOptions||{};var publicAPI={saveSession:function(userInfo,options){var serialized=JSON.stringify(userInfo);getStore(options).set(EPI_SESSION_KEY,serialized)},getSession:function(options){var store=getStore(options);var finalOpts=store.serviceOptions;var serialized=store.get(EPI_SESSION_KEY)||"{}";var session=JSON.parse(serialized);var account=finalOpts.account;var project=finalOpts.project;if(account&&session.account!==account)return{};if(session.groups&&account&&project){var group=session.groups[project]||{groupId:"",groupName:"",isFac:!1};$.extend(session,{project:project},group)}return session},removeSession:function(options){var store=getStore(options);return Object.keys(keyNames).forEach(function(cookieKey){var cookieName=keyNames[cookieKey];store.remove(cookieName)}),!0},getStore:function(options){return getStore(options)},getMergedOptions:function(){var args=Array.prototype.slice.call(arguments);var overrides=$.extend.apply($,[!0,{}].concat(args));var baseOptions=getBaseOptions(overrides);var session=this.getSession(overrides);var token=session.auth_token;if(!token){token=(new StorageFactory).get("epicenter.token")}var sessionDefaults={token:token,account:session.account,project:session.project,group:session.groupName,groupName:session.groupName,groupId:session.groupId,userId:session.userId,userName:session.userName};return $.extend(!0,sessionDefaults,baseOptions)}};$.extend(this,publicAPI)};module.exports=SessionManager},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_service_url_config_service__=__webpack_require__(15);var __WEBPACK_IMPORTED_MODULE_0_service_url_config_service___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_service_url_config_service__);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var ConfigService=function(){function ConfigService(config){_classCallCheck(this,ConfigService);var defaults={logLevel:"NONE"};var serviceOptions=$.extend({},defaults,config);serviceOptions.server=__WEBPACK_IMPORTED_MODULE_0_service_url_config_service___default()(serviceOptions.server),this.serviceOptions=this.data=serviceOptions}return _createClass(ConfigService,[{key:"setEnv",value:function(env){}},{key:"get",value:function(property){return this.serviceOptions[property]}},{key:"set",value:function(key,value){this.serviceOptions[key]=value}}]),ConfigService}();__webpack_exports__.default=ConfigService},function(module,__webpack_exports__,__webpack_require__){"use strict";function extractValidRunParams(params){var validParams=["model","sensitivityMode","scope","files","ephemeral","cinFiles"];return Object(__WEBPACK_IMPORTED_MODULE_1_util_object_util__.pick)(params,validParams)}function parseContentRange(range){if(!range)return null;range=range.replace("records ","");var splitType=range.split("/");var splitRange=splitType[0].split("-");return{start:parseInt(splitRange[0],10),end:parseInt(splitRange[1],10),total:parseInt(splitType[1],10)}}function normalizeOperations(operations,args){args||(args=[]);var returnList={ops:[],args:[]};var _concat=function(arr){return null!==arr&&void 0!==arr?[].concat(arr):[]};var _normalizePlainObjects=function(operations,returnList){return returnList||(returnList={ops:[],args:[]}),$.each(operations,function(opn,arg){returnList.ops.push(opn),returnList.args.push(_concat(arg))}),returnList};var _normalizeStructuredObjects=function(operation,returnList){return returnList||(returnList={ops:[],args:[]}),returnList.ops.push(operation.name),returnList.args.push(_concat(operation.params)),returnList};var _normalizeObject=function(operation,returnList){return(operation.name?_normalizeStructuredObjects:_normalizePlainObjects)(operation,returnList)};var _normalizeLiterals=function(operation,args,returnList){return returnList||(returnList={ops:[],args:[]}),returnList.ops.push(operation),returnList.args.push(_concat(args)),returnList};return $.isPlainObject(operations)?_normalizeObject(operations,returnList):Array.isArray(operations)?function(operations,arg,returnList){returnList||(returnList={ops:[],args:[]}),$.each(operations,function(index,opn){$.isPlainObject(opn)?_normalizeObject(opn,returnList):_normalizeLiterals(opn,args[index],returnList)})}(operations,0,returnList):_normalizeLiterals(operations,args,returnList),returnList}function splitGetFactory(httpOptions){return function(params,options){var http=this;var getValue=function(name,options){var value=options[name]||httpOptions[name];return"function"==typeof value&&(value=value()),value};var getFinalUrl=function(params){var url=getValue("url",options);var data=params;url=url.replace(/#.*$/,"");var queryParams=Object(__WEBPACK_IMPORTED_MODULE_0__query_util__.toQueryFormat)(data);var questionIdx=url.indexOf("?");return queryParams&&questionIdx>-1?url+"&"+queryParams:queryParams?url+"?"+queryParams:url};var url=getFinalUrl(params);if(params&&params.include&&encodeURI(url).length>MAX_URL_LENGTH){var dtd=$.Deferred();var paramsCopy=$.extend(!0,{},params);delete paramsCopy.include;var urlNoIncludes=getFinalUrl(paramsCopy);var diff=MAX_URL_LENGTH-urlNoIncludes.length;var oldSuccess=options.success||httpOptions.success||$.noop;var oldError=options.error||httpOptions.error||$.noop;options.success=$.noop,options.error=$.noop;var include=[].concat(params.include);var currIncludes=[];var includeOpts=[currIncludes];var currLength=encodeURIComponent("?include=").length;var variable=include.pop();for(;variable;){var varLenght=encodeURIComponent(variable).length;currLength+varLenght+1<diff?(currIncludes.push(variable),currLength+=varLenght+1):(currIncludes=[variable],includeOpts.push(currIncludes),currLength="?include=".length+varLenght),variable=include.pop()}var reqs=$.map(includeOpts,function(include){var reqParams=$.extend({},params,{include:include});return http.get(reqParams,options)});return $.when.apply($,reqs).then(function(){if(!arguments[0]||!arguments[0][0])return oldError(),dtd.reject();var firstResponse=arguments[0][0];var isObject=$.isPlainObject(firstResponse);if(isObject&&$.isPlainObject(firstResponse.variables)||!isObject)if(isObject){var aggregateRun=arguments[0][0];$.each(arguments,function(idx,args){var run=args[0];$.extend(!0,aggregateRun.variables,run.variables)}),oldSuccess(aggregateRun,arguments[0][1],arguments[0][2]),dtd.resolve(aggregateRun,arguments[0][1],arguments[0][2])}else{var aggregatedRuns={};$.each(arguments,function(idx,args){var runs=args[0];Array.isArray(runs)&&$.each(runs,function(idxRun,run){run.id&&!aggregatedRuns[run.id]?(run.variables=run.variables||{},aggregatedRuns[run.id]=run):run.id&&$.extend(!0,aggregatedRuns[run.id].variables,run.variables)})}),aggregatedRuns=$.map(aggregatedRuns,function(run){return run}),oldSuccess(aggregatedRuns,arguments[0][1],arguments[0][2]),dtd.resolve(aggregatedRuns,arguments[0][1],arguments[0][2])}else{var aggregatedVariables={};$.each(arguments,function(idx,args){var vars=args[0];$.extend(!0,aggregatedVariables,vars)}),oldSuccess(aggregatedVariables,arguments[0][1],arguments[0][2]),dtd.resolve(aggregatedVariables,arguments[0][1],arguments[0][2])}},function(){oldError.apply(http,arguments),dtd.reject.apply(dtd,arguments)}),dtd.promise()}return http.get(params,options)}}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.extractValidRunParams=extractValidRunParams,__webpack_exports__.parseContentRange=parseContentRange,__webpack_exports__.normalizeOperations=normalizeOperations,__webpack_exports__.splitGetFactory=splitGetFactory;var __WEBPACK_IMPORTED_MODULE_0__query_util__=__webpack_require__(10);var __WEBPACK_IMPORTED_MODULE_1_util_object_util__=__webpack_require__(2);var MAX_URL_LENGTH=2048},function(module,exports,__webpack_require__){"use strict";function inherit(C,P){var F=function(){};F.prototype=P.prototype,C.prototype=new F,C.__super=P.prototype,C.prototype.constructor=C}var extend=function(dest){var obj=Array.prototype.slice.call(arguments,1);var current;for(var j=0;j<obj.length;j++)if(current=obj[j])for(var key in current)dest[key]=current[key];return dest};module.exports=function(base,props,staticProps){var parent=base;var child;return child=props&&props.hasOwnProperty("constructor")?props.constructor:function(){return parent.apply(this,arguments)},extend(child,parent,staticProps),inherit(child,parent),props&&extend(child.prototype,props),child}},function(module,__webpack_exports__,__webpack_require__){"use strict";function mergeRunOptions(run,options){return run instanceof __WEBPACK_IMPORTED_MODULE_0_service_run_api_service__.default?(run.updateConfig(options),run):$.extend(!0,{},run,options)}function injectFiltersFromSession(currentFilter,session,options){var defaults={scopeByGroup:!0,scopeByUser:!0};var opts=$.extend(!0,{},defaults,options);var newFilter={};return opts.scopeByGroup&&session&&session.groupName&&(newFilter.scope={group:session.groupName}),opts.scopeByUser&&session&&session.userId&&(newFilter["user.id"]=session.userId),$.extend(!0,{},currentFilter,newFilter)}function injectScopeFromSession(currentParams,session){var group=session&&session.groupName;var params=$.extend(!0,{},currentParams);return group&&$.extend(!0,params,{scope:{group:group}}),params}__webpack_exports__.c=mergeRunOptions,__webpack_exports__.a=injectFiltersFromSession,__webpack_exports__.b=injectScopeFromSession;var __WEBPACK_IMPORTED_MODULE_0_service_run_api_service__=__webpack_require__(8)},function(module,__webpack_exports__,__webpack_require__){"use strict";function RunService(config){function updateURLConfig(opts){var urlConfig=new __WEBPACK_IMPORTED_MODULE_0_service_configuration_service__.default(opts).get("server");return opts.account&&(urlConfig.accountPath=opts.account),opts.project&&(urlConfig.projectPath=opts.project),urlConfig.filter=";",urlConfig.getFilterURL=function(filter){var url=urlConfig.getAPIPath("run");var filterMatrix=Object(__WEBPACK_IMPORTED_MODULE_1_util_query_util__.toMatrixFormat)(filter||opts.filter);return filterMatrix&&(url+=filterMatrix+"/"),url},urlConfig.addAutoRestoreHeader=function(options){var filter=opts.filter;var isFilterRunId=filter&&"string"===$.type(filter);if(opts.autoRestore&&isFilterRunId){var autorestoreOpts={headers:{"X-AutoRestore":"true"}};return $.extend(!0,autorestoreOpts,options)}return options},urlConfig}function updateHTTPConfig(serviceOptions,urlConfig){httpOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getFilterURL}),serviceOptions.token&&(httpOptions.headers={Authorization:"Bearer "+serviceOptions.token}),http=new __WEBPACK_IMPORTED_MODULE_3_transport_http_transport_factory__.default(httpOptions),http.splitGet=Object(__WEBPACK_IMPORTED_MODULE_2_util_run_util__.splitGetFactory)(httpOptions)}function setFilterOrThrowError(options){if(options.id&&(serviceOptions.filter=serviceOptions.id=options.id),options.filter&&(serviceOptions.filter=serviceOptions.id=options.filter),!serviceOptions.filter)throw new Error("No filter specified to apply operations against")}var defaults={filter:"",id:"",autoRestore:!0,account:void 0,project:void 0,token:void 0,transport:{},success:$.noop,error:$.noop};this.sessionManager=new __WEBPACK_IMPORTED_MODULE_6_store_session_manager___default.a;var serviceOptions=this.sessionManager.getMergedOptions(defaults,config);serviceOptions.id&&(serviceOptions.filter=serviceOptions.id);var http;var httpOptions;var urlConfig=updateURLConfig(serviceOptions);updateHTTPConfig(serviceOptions,urlConfig);var publicAsyncAPI={urlConfig:urlConfig,create:function(params,options){var createOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("run")});params="string"==typeof params?{model:params}:Object(__WEBPACK_IMPORTED_MODULE_2_util_run_util__.extractValidRunParams)(params);var oldSuccess=createOptions.success;return createOptions.success=function(response){return serviceOptions.filter=response.id,serviceOptions.id=response.id,oldSuccess.apply(this,arguments)},http.post(params,createOptions)},query:function(qs,outputModifier,options){var mergedOptions=$.extend(!0,{},serviceOptions,options);var mergedQuery=$.extend(!0,{},qs);mergedOptions.scope&&(mergedQuery.scope=mergedOptions.scope);var httpOptions=$.extend(!0,{},mergedOptions,{url:urlConfig.getFilterURL(mergedQuery)});return httpOptions=urlConfig.addAutoRestoreHeader(httpOptions),http.splitGet(outputModifier,httpOptions)},filter:function(filter,outputModifier,options){$.isPlainObject(serviceOptions.filter)?$.extend(serviceOptions.filter,filter):serviceOptions.filter=filter;var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions=urlConfig.addAutoRestoreHeader(httpOptions),http.splitGet(outputModifier,httpOptions)},load:function(runID,filters,options){runID&&(serviceOptions.filter=runID);var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions=urlConfig.addAutoRestoreHeader(httpOptions),http.get(filters,httpOptions)},removeFromMemory:function(runID,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return runID&&(httpOptions.url=urlConfig.getAPIPath("run")+runID),http.delete({},httpOptions)},save:function(attributes,options){var httpOptions=$.extend(!0,{},serviceOptions,options);setFilterOrThrowError(httpOptions);var saveable=Object.keys(attributes).reduce(function(accum,key){var val=attributes[key];return"scope"===key&&$.isPlainObject(val)?Object.keys(val).forEach(function(k){var nestedVal=val[k];accum[key+"."+k]=nestedVal}):accum[key]=val,accum},{});return http.patch(saveable,httpOptions)},do:function(operation,params,options){var opsArgs;var postOptions;options?(opsArgs=params,postOptions=options):$.isPlainObject(params)?(opsArgs=null,postOptions=params):opsArgs=params;var result=Object(__WEBPACK_IMPORTED_MODULE_2_util_run_util__.normalizeOperations)(operation,opsArgs);var httpOptions=$.extend(!0,{},serviceOptions,postOptions);setFilterOrThrowError(httpOptions);var prms=result.args[0].length&&null!==result.args[0]&&void 0!==result.args[0]?result.args[0]:[];return http.post({arguments:prms},$.extend(!0,{},httpOptions,{url:urlConfig.getFilterURL()+"operations/"+result.ops[0]+"/"}))},serial:function(operations,params,options){var opParams=Object(__WEBPACK_IMPORTED_MODULE_2_util_run_util__.normalizeOperations)(operations,params);var ops=opParams.ops;var args=opParams.args;var me=this;var $d=$.Deferred();var postOptions=$.extend(!0,{},serviceOptions,options);var responses=[];var doSingleOp=function(){var op=ops.shift();var arg=args.shift();me.do(op,arg,{success:function(result){responses.push(result),ops.length?doSingleOp():($d.resolve(responses),postOptions.success(responses,me))},error:function(err){responses.push(err),$d.reject(responses),postOptions.error(responses,me)}})};return doSingleOp(),$d.promise()},parallel:function(operations,params,options){var $d=$.Deferred();var opParams=Object(__WEBPACK_IMPORTED_MODULE_2_util_run_util__.normalizeOperations)(operations,params);var ops=opParams.ops;var args=opParams.args;var postOptions=$.extend(!0,{},serviceOptions,options);var queue=[];for(var i=0;i<ops.length;i++)queue.push(this.do(ops[i],args[i]));var me=this;return $.when.apply(this,queue).then(function(){var args=Array.prototype.slice.call(arguments);var actualResponse=args.map(function(a){return a[0]});$d.resolve(actualResponse),postOptions.success(actualResponse,me)}).fail(function(){var args=Array.prototype.slice.call(arguments);var actualResponse=args.map(function(a){return a[0]});$d.reject(actualResponse),postOptions.error(actualResponse,me)}),$d.promise()},introspect:function(options,introspectionConfig){var introspection=new __WEBPACK_IMPORTED_MODULE_5_service_introspection_api_service__.default($.extend(!0,{},serviceOptions,introspectionConfig));if(options){if(options.runID)return introspection.byRunID(options.runID);if(options.model)return introspection.byModel(options.model)}else if(serviceOptions.id)return introspection.byRunID(serviceOptions.id);throw new Error("Please specify either the model or runid to introspect")}};var publicSyncAPI={getCurrentConfig:function(){return serviceOptions},updateConfig:function(config){config&&config.id?config.filter=config.id:config&&config.filter&&(config.id=config.filter),serviceOptions=$.extend(!0,{},serviceOptions,config),urlConfig=updateURLConfig(serviceOptions),this.urlConfig=urlConfig,updateHTTPConfig(serviceOptions,urlConfig)},variables:function(config){return new __WEBPACK_IMPORTED_MODULE_4__variables_api_service__.default($.extend(!0,{},serviceOptions,config,{runService:this}))}};$.extend(this,publicAsyncAPI),$.extend(this,publicSyncAPI)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=RunService;var __WEBPACK_IMPORTED_MODULE_0_service_configuration_service__=__webpack_require__(4);var __WEBPACK_IMPORTED_MODULE_1_util_query_util__=__webpack_require__(10);var __WEBPACK_IMPORTED_MODULE_2_util_run_util__=__webpack_require__(5);var __WEBPACK_IMPORTED_MODULE_3_transport_http_transport_factory__=__webpack_require__(0);var __WEBPACK_IMPORTED_MODULE_4__variables_api_service__=__webpack_require__(26);var __WEBPACK_IMPORTED_MODULE_5_service_introspection_api_service__=__webpack_require__(27);var __WEBPACK_IMPORTED_MODULE_6_store_session_manager__=__webpack_require__(3);var __WEBPACK_IMPORTED_MODULE_6_store_session_manager___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_6_store_session_manager__)},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function result(item){if("function"==typeof item){var rest=Array.prototype.slice.call(arguments,1);return item.apply(item,rest)}return item}function rejectPromise(type,message){return $.Deferred().reject({type:type,message:message}).promise()}function resolvePromise(val){return $.Deferred().resolve(val).promise()}function makePromise(val){if(val&&val.then)return val;var $def=$.Deferred();if("function"==typeof val)try{var toReturn=val();if(toReturn&&toReturn.then)return toReturn.then(function(r){return $def.resolve(r)}).catch(function(e){return $def.reject(e)});$def.resolve(toReturn)}catch(e){$def.reject(e)}else $def.resolve(val);return $def.promise()}__webpack_exports__.e=result,__webpack_exports__.c=rejectPromise,__webpack_exports__.d=resolvePromise,__webpack_require__.d(__webpack_exports__,"a",function(){return CustomError}),__webpack_exports__.b=makePromise;var CustomError=function(_Error){function CustomError(type,message){_classCallCheck(this,CustomError);var _this=_possibleConstructorReturn(this,(CustomError.__proto__||Object.getPrototypeOf(CustomError)).call(this,message));return _this.message=message,_this.type=type,_this}return _inherits(CustomError,_Error),CustomError}(Error)},function(module,__webpack_exports__,__webpack_require__){"use strict";function toMatrixFormat(qs){function translateParts(ip){function translateRawValue(val){return["<",">","!"].some(function(o){return(""+val).charAt(0)===o})?val:"="+val}return Object.keys(ip).reduce(function(accum,key){var val=ip[key];if(Array.isArray(val)){var mapped=val.map(function(v){var translated=translateRawValue(v);return""+key+translated});accum=accum.concat(mapped)}else if(null!==val&&"object"==typeof val){var translated=translateParts(val);var prefixed=translated.map(function(t){return key+"."+t});accum=accum.concat(prefixed)}else{var _translated=translateRawValue(val);accum.push(""+key+_translated)}return accum},[])}return null===qs||void 0===qs||""===qs?";":"string"==typeof qs?qs:";"+translateParts(qs).join(";")}function toQueryFormat(qs){if(null===qs||void 0===qs)return"";if("string"==typeof qs)return qs;var returnArray=[];return $.each(qs,function(key,value){Array.isArray(value)&&(value=value.join(",")),$.isPlainObject(value)&&(value=JSON.stringify(value)),returnArray.push(key+"="+value)}),returnArray.join("&")}function qsToObject(qs){if(null===qs||void 0===qs||""===qs)return{};var qsArray=qs.split("&");var returnObj={};return qsArray.forEach(function(value,index){var qKey=value.split("=")[0];var qVal=value.split("=")[1];-1!==qVal.indexOf(",")&&(qVal=qVal.split(",")),returnObj[qKey]=qVal}),returnObj}function mergeQS(qs1,qs2){var obj1=qsToObject(toQueryFormat(qs1));var obj2=qsToObject(toQueryFormat(qs2));return $.extend(!0,{},obj1,obj2)}function normalizeSlashes(url,options){if(!url){if(""===url)return"";throw new Error("normalizeSlashes: Unknown url "+url)}var opts=$.extend({},{leading:!1,trailing:!1},options);var protocolMatch=url.match(/^(https?:\/\/)(.*)/);var _ref=protocolMatch?[protocolMatch[1],protocolMatch[2]]:["",url],_ref2=_slicedToArray(_ref,2),protocol=_ref2[0],rest=_ref2[1];var cleaned=rest.replace(/\/{2,}/g,"/");return opts.leading&&"/"!==cleaned.charAt(0)&&!protocol&&(cleaned="/"+cleaned),opts.trailing&&"/"!==cleaned.charAt(cleaned.length-1)&&(cleaned+="/"),""+protocol+cleaned}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.toMatrixFormat=toMatrixFormat,__webpack_exports__.toQueryFormat=toQueryFormat,__webpack_exports__.qsToObject=qsToObject,__webpack_exports__.mergeQS=mergeQS,__webpack_exports__.normalizeSlashes=normalizeSlashes;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=!0;var _d=!1;var _e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},function(module,__webpack_exports__,__webpack_require__){"use strict";function WorldAPIAdapter(config){var defaults={group:void 0,model:void 0,filter:"",id:"",token:void 0,account:void 0,project:void 0,transport:{}};var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_5_service_service_utils__.b)(defaults,config,{apiEndpoint:apiEndpoint});serviceOptions.id&&(serviceOptions.filter=serviceOptions.id);var urlConfig=Object(__WEBPACK_IMPORTED_MODULE_5_service_service_utils__.d)(serviceOptions);var http=new __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__.default(serviceOptions.transport);var setIdFilterOrThrowError=function(options){if(options||(options={}),options.id?serviceOptions.filter=options.id:options.filter&&(serviceOptions.filter=options.filter),!serviceOptions.filter)throw new Error("No world id specified to apply operations against. This could happen if the user is not assigned to a world and is trying to work with runs from that world.")};var validateModelOrThrowError=function(options){if(!options||!options.model)throw new Error("No model specified to get the current run")};var publicAPI={create:function(params,options){var createOptions=$.extend(!0,{},serviceOptions,options);var worldApiParams=["scope","files","roles","optionalRoles","minUsers","group","name"];var validParams=Object(__WEBPACK_IMPORTED_MODULE_4_util_object_util__.pick)(serviceOptions,["account","project","group"]);params=Object(__WEBPACK_IMPORTED_MODULE_4_util_object_util__.pick)(params,worldApiParams),params=$.extend({},validParams,params);var oldSuccess=createOptions.success;return createOptions.success=function(response){return serviceOptions.filter=response.id,oldSuccess.apply(this,arguments)},http.post(params,createOptions)},update:function(params,options){var whitelist=["roles","optionalRoles","minUsers","name"];options=options||{},setIdFilterOrThrowError(options);var updateOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter});return params=Object(__WEBPACK_IMPORTED_MODULE_4_util_object_util__.pick)(params||{},whitelist),http.patch(params,updateOptions)},delete:function(options){options=options&&"string"==typeof options?{filter:options}:{},setIdFilterOrThrowError(options);var deleteOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter});return http.delete(null,deleteOptions)},updateConfig:function(config){return $.extend(serviceOptions,config),this},list:function(options){var getOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)});var filters=Object(__WEBPACK_IMPORTED_MODULE_4_util_object_util__.pick)(getOptions,["account","project","group"]);return http.get(filters,getOptions)},load:function(worldId,options){if(worldId&&(serviceOptions.filter=worldId),!serviceOptions.filter)throw new Error("Please provide a worldid to load");var httpOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter+"/"});return http.get("",httpOptions)},getWorldsForUser:function(userId,options){var getOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)});var filters=$.extend(Object(__WEBPACK_IMPORTED_MODULE_4_util_object_util__.pick)(getOptions,["account","project","group"]),{userId:userId});return http.get(filters,getOptions)},addUsers:function(users,worldId,options){if(!users)throw new Error("Please provide a list of users to add to the world");users=[].concat(users).map(function(u){var isObject=$.isPlainObject(u);if("string"!=typeof u&&!isObject)throw new Error("Some of the users in the list are not in the valid format: "+u);return isObject?u:{userId:u}}),$.isPlainObject(worldId)&&!options&&(options=worldId,worldId=null),options=options||{},"string"==typeof worldId&&(options.filter=worldId),setIdFilterOrThrowError(options);var updateOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter+"/users"});return http.post(users,updateOptions)},updateUser:function(user,options){if(!user||!user.userId)throw new Error("You need to pass a userId to update from the world");setIdFilterOrThrowError(options);var validFields=["role"];var patchOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter+"/users/"+user.userId});return http.patch(Object(__WEBPACK_IMPORTED_MODULE_4_util_object_util__.pick)(user,validFields),patchOptions)},removeUser:function(user,options){if("string"==typeof user&&(user={userId:user}),!user.userId)throw new Error("You need to pass a userId to remove from the world");var mergedOptions=$.extend(!0,{},serviceOptions,options);setIdFilterOrThrowError(mergedOptions);var autoDeleteWorld=options&&!0===options.deleteWorldIfEmpty;var url=urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter+"/users/"+user.userId;return autoDeleteWorld&&(url+="?deleteWorld=true"),mergedOptions.url=url,http.delete(null,mergedOptions)},getCurrentRunId:function(options){setIdFilterOrThrowError(options);var postParams=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter+"/run"});validateModelOrThrowError(postParams);var validRunParams=Object(__WEBPACK_IMPORTED_MODULE_3_util_run_util__.extractValidRunParams)(postParams);return http.post(validRunParams,postParams)},getCurrentWorldForUser:function(userId,groupName){var dtd=$.Deferred();var me=this;return this.getWorldsForUser(userId,{group:groupName}).then(function(worlds){worlds.sort(function(a,b){return+new Date(b.lastModified)-+new Date(a.lastModified)});var currentWorld=worlds[0];currentWorld&&(serviceOptions.filter=currentWorld.id),dtd.resolveWith(me,[currentWorld])}).catch(dtd.reject),dtd.promise()},deleteRun:function(worldId,options){options=options||{},worldId&&(options.filter=worldId),setIdFilterOrThrowError(options);var deleteOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter+"/run"});return http.delete(null,deleteOptions)},newRunForWorld:function(worldId,options){var currentRunOptions=$.extend(!0,{},serviceOptions,options,{filter:worldId||serviceOptions.filter});var me=this;return validateModelOrThrowError(currentRunOptions),this.deleteRun(worldId,options).then(function(){return me.getCurrentRunId(currentRunOptions)})},autoAssign:function(options){var opt=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(assignmentEndpoint)});var params={account:opt.account,project:opt.project,group:opt.group};return opt.maxUsers&&(params.maxUsers=opt.maxUsers),opt.userIds&&(params.userIds=opt.userIds),http.post(params,opt)},getProjectSettings:function(options){var opt=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(projectEndpoint)});return http.get(null,opt)},consensus:function(conOpts,options){var opts=$.extend(!0,{},serviceOptions,options);var worldId=opts.filter||opts.id;if(!worldId)throw new Error("No world id provided; use consensus(name, { id: worldid})");if(!conOpts)throw new Error("No consensus name provided; use consensus(name, { id: worldid})");return new __WEBPACK_IMPORTED_MODULE_1_service_consensus_api_service_consensus_service__.default($.extend(!0,{worldId:worldId},opts,function(nameOpts){return"string"==typeof nameOpts?{name:nameOpts}:$.isPlainObject(nameOpts)?{consensusGroup:nameOpts.consensusGroup,name:nameOpts.name}:void 0}(conOpts)))},getPresenceForUsers:function(world,options){var _this=this;var opts=$.extend(!0,{},serviceOptions,options);var ps=new __WEBPACK_IMPORTED_MODULE_2_service_presence_api_service__.default(opts);return function(world,opts){if(world&&world.users)return $.Deferred().resolve(world).promise();var worldid=world||opts.filter||opts.id;return _this.load(worldid).then(function(w){return w})}(world,opts).then(function(world){return ps.getStatusForUsers(world.users)})}};$.extend(this,publicAPI)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=WorldAPIAdapter;var __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__=__webpack_require__(0);var __WEBPACK_IMPORTED_MODULE_1_service_consensus_api_service_consensus_service__=__webpack_require__(20);var __WEBPACK_IMPORTED_MODULE_2_service_presence_api_service__=__webpack_require__(33);var __WEBPACK_IMPORTED_MODULE_3_util_run_util__=__webpack_require__(5);var __WEBPACK_IMPORTED_MODULE_4_util_object_util__=__webpack_require__(2);var __WEBPACK_IMPORTED_MODULE_5_service_service_utils__=__webpack_require__(1);var assignmentEndpoint="multiplayer/assign";var apiEndpoint="multiplayer/world";var projectEndpoint="multiplayer/project"},function(module,exports,__webpack_require__){"use strict";var Base=__webpack_require__(14);var classFrom=__webpack_require__(6);var Strategy=classFrom(Base,{constructor:function(condition){if(null==condition)throw new Error("Conditional strategy needs a condition to create a run");this.condition="function"!=typeof condition?function(){return condition}:condition},reset:function(runService,userSession,options){var group=userSession&&userSession.groupName;var opt=$.extend({scope:{group:group}},runService.getCurrentConfig());return runService.create(opt,options).then(function(run){return run.freshlyCreated=!0,run})},getRun:function(runService,userSession,runSession,options){var me=this;return runSession&&runSession.id?this.loadAndCheck(runService,userSession,runSession,options).catch(function(){return me.reset(runService,userSession,options)}):this.reset(runService,userSession,options)},loadAndCheck:function(runService,userSession,runSession,options){var shouldCreate=!1;var me=this;return runService.load(runSession.id,null,{success:function(run,msg,headers){shouldCreate=me.condition(run,headers,userSession,runSession)}}).then(function(run){return shouldCreate?me.reset(runService,userSession,options):run})}});module.exports=Strategy},function(module,__webpack_exports__,__webpack_require__){"use strict";function AuthManager(options){options=$.extend(!0,{},defaults,options),this.sessionManager=new __WEBPACK_IMPORTED_MODULE_3_store_session_manager___default.a(options),this.options=this.sessionManager.getMergedOptions(),this.authAdapter=new __WEBPACK_IMPORTED_MODULE_0_service_auth_api_service__.default(this.options)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_service_auth_api_service__=__webpack_require__(30);var __WEBPACK_IMPORTED_MODULE_1_service_member_api_adapter__=__webpack_require__(18);var __WEBPACK_IMPORTED_MODULE_2_service_group_api_service__=__webpack_require__(31);var __WEBPACK_IMPORTED_MODULE_3_store_session_manager__=__webpack_require__(3);var __WEBPACK_IMPORTED_MODULE_3_store_session_manager___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_store_session_manager__);var __WEBPACK_IMPORTED_MODULE_4_util_object_util__=__webpack_require__(2);var atob=window.atob||__webpack_require__(52).atob;var defaults={requiresGroup:!0};var _findUserInGroup=function(members,id){for(var j=0;j<members.length;j++)if(members[j].userId===id)return members[j];return null};AuthManager.prototype=$.extend(AuthManager.prototype,{login:function(options){var me=this;var $d=$.Deferred();var sessionManager=this.sessionManager;var adapterOptions=sessionManager.getMergedOptions({success:$.noop,error:$.noop},options);var outSuccess=adapterOptions.success;var outError=adapterOptions.error;var groupId=adapterOptions.groupId;var decodeToken=function(token){var encoded=token.split(".")[1];for(;encoded.length%4!=0;)encoded+="=";return JSON.parse(atob(encoded))};var handleGroupError=function(message,statusCode,data,type){me.logout().then(function(){var error=$.extend(!0,{},data,{statusText:message,status:statusCode,type:type});$d.reject(error)})};var handleSuccess=function(response){var token=response.access_token;var userInfo=decodeToken(token);var oldGroups=sessionManager.getSession(adapterOptions).groups||{};var userGroupOpts=$.extend(!0,{},adapterOptions,{success:$.noop});var data={auth:response,user:userInfo};var project=adapterOptions.project;var isTeamMember=null===userInfo.parent_account_id;var requiresGroup=adapterOptions.requiresGroup&&project;var userName=(userInfo.user_name||"").split("/")[0];var sessionInfo={auth_token:token,account:adapterOptions.account,project:project,userId:userInfo.user_id,groups:oldGroups,isTeamMember:isTeamMember,userName:userName};if(!requiresGroup)return sessionManager.saveSession(sessionInfo),outSuccess.apply(this,[data]),void $d.resolve(data);var handleGroupList=function(groupList){data.userGroups=groupList;var group=null;if(0===groupList.length)return void handleGroupError("The user has no groups associated in this account",403,data,"NO_GROUPS");if(1===groupList.length)group=groupList[0];else if(groupList.length>1&&groupId){var filteredGroups=$.grep(groupList,function(resGroup){return resGroup.groupId===groupId});group=1===filteredGroups.length?filteredGroups[0]:null}if(group){var isFac=!!isTeamMember||"facilitator"===_findUserInGroup(group.members,userInfo.user_id).role;var groupData={groupId:group.groupId,groupName:group.name,isFac:isFac};var sessionInfoWithGroup=$.extend({},sessionInfo,groupData);sessionInfo.groups[project]=groupData,me.sessionManager.saveSession(sessionInfoWithGroup,adapterOptions),outSuccess.apply(this,[data]),$d.resolve(data)}else handleGroupError("This user is associated with more than one group. Please specify a group id to log into and try again",403,data,"MULTIPLE_GROUPS")};if(isTeamMember){var opts=$.extend({},userGroupOpts,{token:token});new __WEBPACK_IMPORTED_MODULE_2_service_group_api_service__.default(opts).getGroups({account:adapterOptions.account,project:project}).then(function(groups){if(groups.forEach(function(group){group.groupId=group.id}),!groups.length)return sessionManager.saveSession(sessionInfo),outSuccess.apply(this,[data]),void $d.resolve(data);handleGroupList(groups)},$d.reject)}else me.getUserGroups({userId:userInfo.user_id,token:token},userGroupOpts).then(handleGroupList,$d.reject)};return adapterOptions.success=handleSuccess,adapterOptions.error=function(response){if(adapterOptions.account)return adapterOptions.account=null,adapterOptions.error=function(){outError.apply(this,arguments),$d.reject(response)},void me.authAdapter.login(adapterOptions);outError.apply(this,arguments),$d.reject(response)},this.authAdapter.login(adapterOptions),$d.promise()},logout:function(options){var me=this;var adapterOptions=this.sessionManager.getMergedOptions(options);var removeCookieFn=function(response){me.sessionManager.removeSession()};return this.authAdapter.logout(adapterOptions).then(removeCookieFn)},getToken:function(options){var httpOptions=this.sessionManager.getMergedOptions(options);var session=this.sessionManager.getSession(httpOptions);var $d=$.Deferred();return session.auth_token?$d.resolve(session.auth_token):this.login(httpOptions).then($d.resolve),$d.promise()},getUserGroups:function(params,options){var adapterOptions=this.sessionManager.getMergedOptions({success:$.noop},options);var $d=$.Deferred();var outSuccess=adapterOptions.success;return adapterOptions.success=function(memberInfo){adapterOptions.project&&(memberInfo=$.grep(memberInfo,function(group){return group.project===adapterOptions.project})),outSuccess.apply(this,[memberInfo]),$d.resolve(memberInfo)},new __WEBPACK_IMPORTED_MODULE_1_service_member_api_adapter__.default({token:params.token,server:adapterOptions.server}).getGroupsForUser(params,adapterOptions).fail($d.reject),$d.promise()},isLoggedIn:function(){var session=this.getCurrentUserSessionInfo();return!(!session||!session.userId)},getCurrentUserSessionInfo:function(options){var adapterOptions=this.sessionManager.getMergedOptions({success:$.noop},options);return this.sessionManager.getSession(adapterOptions)},addGroups:function(groups){var session=this.getCurrentUserSessionInfo();return groups=Array.isArray(groups)?groups:[groups],$.each(groups,function(index,group){var extendedGroup=$.extend({},{isFac:!1},group);var project=extendedGroup.project;var validProps=["groupName","groupId","isFac"];if(!project||!extendedGroup.groupName)throw new Error("No project or groupName specified.");extendedGroup=Object(__WEBPACK_IMPORTED_MODULE_4_util_object_util__.pick)(extendedGroup,validProps),session.groups[project]=extendedGroup}),this.sessionManager.saveSession(session),session}}),__webpack_exports__.default=AuthManager},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var NoRunStrategy=function(){function NoRunStrategy(){_classCallCheck(this,NoRunStrategy)}return _createClass(NoRunStrategy,[{key:"reset",value:function(){return $.Deferred().resolve().promise()}},{key:"getRun",value:function(runService){return $.Deferred().resolve(runService).promise()}}]),NoRunStrategy}();__webpack_exports__.default=NoRunStrategy},function(module,exports,__webpack_require__){"use strict";function isLocalHost(host){return!host||"127.0.0.1"===host||0===host.indexOf("local.")||-1!==host.indexOf("ngrok")||0===host.indexOf("localhost")}function getLocalHost(existingFn,host){return void 0!==existingFn?$.isFunction(existingFn)?existingFn:function(){return existingFn}:function(){return isLocalHost(host)}}var epiVersion=__webpack_require__(24);var defaults={protocol:isLocalHost(window.location.host)?"https":window.location.protocol.replace(":",""),host:window.location.host,pathname:window.location.pathname};var UrlConfigService=function(config){var envConf=UrlConfigService.defaults;config||(config={});var configOverrides=$.extend({},defaults,config);var overrides=$.extend({},envConf,config);var options=$.extend({},defaults,overrides);overrides.isLocalhost=options.isLocalhost=getLocalHost(options.isLocalhost,configOverrides.host);var actingHost=config&&config.host;actingHost=!actingHost&&options.isLocalhost()?"forio.com":options.host;var actingProtocol=config&&config.protocol;actingProtocol=!actingProtocol&&options.isLocalhost()?"https":options.protocol;var HOST_API_MAPPING={"forio.com":"api.forio.com","foriodev.com":"api.epicenter.foriodev.com"};var publicExports={protocol:actingProtocol,api:"",actingHost:actingHost,host:function(){return HOST_API_MAPPING[actingHost]?HOST_API_MAPPING[actingHost]:actingHost}(),isCustomDomain:function(){var path=options.pathname.split("/");var pathHasApp=path&&"app"===path[1];return!options.isLocalhost()&&!pathHasApp}(),appPath:function(){var path=options.pathname.split("/");return path&&path[1]||""}(),accountPath:function(){var accnt="";var path=options.pathname.split("/");return path&&"app"===path[1]&&(accnt=path[2]),accnt}(),projectPath:function(){var prj="";var path=options.pathname.split("/");return path&&"app"===path[1]&&(prj=path[3]),prj}(),versionPath:function(){return epiVersion.version?epiVersion.version+"/":""}(),baseURL:function(){return this.protocol+"://"+this.host+"/"+this.versionPath},getAPIPath:function(api){var PROJECT_APIS=["run","data","file","presence","project","multiplayer/project"];var apiMapping={channel:"channel/subscribe"};var apiEndpoint=apiMapping[api]||api;if("config"===apiEndpoint){var actualProtocol=window.location.protocol.replace(":","");return(options.isLocalhost()?this.protocol:actualProtocol)+"://"+actingHost+"/epicenter/"+this.versionPath+"config"}var baseURL="function"==typeof this.baseURL?this.baseURL():this.baseURL;var apiPath=baseURL+apiEndpoint+"/";return-1!==PROJECT_APIS.indexOf(apiEndpoint)&&(apiPath+=this.accountPath+"/"+this.projectPath+"/"),apiPath}};return $.extend(publicExports,overrides),publicExports};UrlConfigService.defaults={},module.exports=UrlConfigService},function(module,exports,__webpack_require__){"use strict";module.exports={EPI_SESSION_KEY:"epicenterjs.session",STRATEGY_SESSION_KEY:"epicenter-scenario"}},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__=__webpack_require__(0);var __WEBPACK_IMPORTED_MODULE_1_service_service_utils__=__webpack_require__(1);var __WEBPACK_IMPORTED_MODULE_2__data_service_scope_utils__=__webpack_require__(51);var __WEBPACK_IMPORTED_MODULE_3_managers_epicenter_channel_manager__=__webpack_require__(19);var __WEBPACK_IMPORTED_MODULE_4_util_index__=__webpack_require__(9);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var API_ENDPOINT="data";var getAPIURL=__WEBPACK_IMPORTED_MODULE_2__data_service_scope_utils__.c.bind(null,API_ENDPOINT);var DataService=function(){function DataService(config){_classCallCheck(this,DataService);var defaults={scope:__WEBPACK_IMPORTED_MODULE_2__data_service_scope_utils__.a.CUSTOM,root:"/",account:void 0,project:void 0,token:void 0,transport:{}};var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_1_service_service_utils__.b)(defaults,config,{apiEndpoint:API_ENDPOINT});this.serviceOptions=serviceOptions,this.http=new __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__.default(serviceOptions.transport)}return _createClass(DataService,[{key:"query",value:function(documentID,_query,outputModifier,options){var params=$.extend(!0,{q:_query},outputModifier);var mergedOptions=$.extend(!0,{},this.serviceOptions,options);try{mergedOptions.url=getAPIURL(mergedOptions.root,documentID,mergedOptions)}catch(e){return Object(__WEBPACK_IMPORTED_MODULE_4_util_index__.c)(e.type,e.message)}return this.http.get(params,mergedOptions)}},{key:"save",value:function(key,value,options){var attrs;"object"==typeof key?(attrs=key,options=value):(attrs={})[key]=value;var mergedOptions=$.extend(!0,{},this.serviceOptions,options);try{mergedOptions.url=getAPIURL(mergedOptions.root,"",mergedOptions)}catch(e){return Object(__WEBPACK_IMPORTED_MODULE_4_util_index__.c)(e.type,e.message)}return this.http.post(attrs,mergedOptions)}},{key:"pushToArray",value:function(documentPath,val,options){var mergedOptions=$.extend(!0,{},this.serviceOptions,options);try{mergedOptions.url=getAPIURL(mergedOptions.root,documentPath,mergedOptions)}catch(e){return Object(__WEBPACK_IMPORTED_MODULE_4_util_index__.c)(e.type,e.message)}return this.http.post(val,mergedOptions)}},{key:"saveAs",value:function(documentPath,value,options){var mergedOptions=$.extend(!0,{},this.serviceOptions,options);try{mergedOptions.url=getAPIURL(mergedOptions.root,documentPath,mergedOptions)}catch(e){return Object(__WEBPACK_IMPORTED_MODULE_4_util_index__.c)(e.type,e.message)}return this.http.put(value,mergedOptions)}},{key:"load",value:function(documentPath,outputModifier,options){var mergedOptions=$.extend(!0,{},this.serviceOptions,options);try{mergedOptions.url=getAPIURL(mergedOptions.root,documentPath,mergedOptions)}catch(e){return Object(__WEBPACK_IMPORTED_MODULE_4_util_index__.c)(e.type,e.message)}return this.http.get(outputModifier,mergedOptions)}},{key:"remove",value:function(keys,options){var mergedOptions=$.extend(!0,{},this.serviceOptions,options);var params;try{Array.isArray(keys)?(params="id="+keys.join("&id="),mergedOptions.url=getAPIURL(mergedOptions.root,"",mergedOptions)):(params="",mergedOptions.url=getAPIURL(mergedOptions.root,keys,mergedOptions))}catch(e){return Object(__WEBPACK_IMPORTED_MODULE_4_util_index__.c)(e.type,e.message)}return this.http.delete(params,mergedOptions)}},{key:"getScopedName",value:function(session,options){var opts=$.extend(!0,{},this.serviceOptions,options);var collName=opts.root.split("/")[0];return Object(__WEBPACK_IMPORTED_MODULE_2__data_service_scope_utils__.b)(collName,opts.scope,session)}},{key:"getChannel",value:function(options){var opts=$.extend(!0,{},this.serviceOptions,options);var scopedCollName=this.getScopedName(opts);return new __WEBPACK_IMPORTED_MODULE_3_managers_epicenter_channel_manager__.default(opts).getDataChannel(scopedCollName)}}]),DataService}();DataService.SCOPES=__WEBPACK_IMPORTED_MODULE_2__data_service_scope_utils__.a,__webpack_exports__.default=DataService},function(module,__webpack_exports__,__webpack_require__){"use strict";function MemberAPIService(config){var defaults={userId:void 0,groupId:void 0,transport:{}};var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_2__service_utils__.b)(defaults,config,{apiEndpoint:API_ENDPOINT});var urlConfig=Object(__WEBPACK_IMPORTED_MODULE_2__service_utils__.d)(serviceOptions);var http=new __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__.default(serviceOptions.transport);var getFinalParams=function(params){return"object"==typeof params?$.extend(!0,serviceOptions,params):serviceOptions};var generateUserQuery=function(params){if(!params.userId||!params.userId.length)throw new Error("No userId specified.");return"?userId="+[].concat(params.userId).join("&userId=")};var patchUserActiveField=function(params,active,options){params=getFinalParams(params);var httpOptions=$.extend(!0,serviceOptions,options,{url:urlConfig.getAPIPath(API_ENDPOINT)+params.groupId+generateUserQuery(params)});return http.patch({active:active},httpOptions)};var publicAPI={getGroupsForUser:function(params,options){options=options||{};var httpOptions=$.extend(!0,serviceOptions,options);var isString="string"==typeof params;var objParams=getFinalParams(params);if(!isString&&!objParams.userId)throw new Error("No userId specified.");var getParams=isString?{userId:params}:Object(__WEBPACK_IMPORTED_MODULE_1_util_object_util__.pick)(objParams,["userId"]);return http.get(getParams,httpOptions)},addUsersToGroup:function(userlist,groupId,options){var httpOptions=Object(__WEBPACK_IMPORTED_MODULE_2__service_utils__.b)(serviceOptions,options,{groupId:groupId});if(!httpOptions.groupId)throw new Error("addUsersToGroup: No group provided, and cannot retrieve from session");if(!userlist||!Array.isArray(userlist))throw new Error("addUsersToGroup: No userlist provided. Provide a list of userids to upload");var params=userlist.map(function(u){return $.isPlainObject(u)?u:{userId:u}});return httpOptions.url=""+urlConfig.getAPIPath(API_ENDPOINT)+httpOptions.groupId,http.post(params,httpOptions)},getGroupDetails:function(params,options){options=options||{};var isString="string"==typeof params;var objParams=getFinalParams(params);if(!isString&&!objParams.groupId)throw new Error("No groupId specified.");var groupId=isString?params:objParams.groupId;var httpOptions=$.extend(!0,serviceOptions,options,{url:urlConfig.getAPIPath(API_ENDPOINT)+groupId});return http.get({},httpOptions)},makeUserActive:function(params,options){return patchUserActiveField(params,!0,options)},makeUserInactive:function(params,options){return patchUserActiveField(params,!1,options)}};$.extend(this,publicAPI)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=MemberAPIService;var __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__=__webpack_require__(0);var __WEBPACK_IMPORTED_MODULE_1_util_object_util__=__webpack_require__(2);var __WEBPACK_IMPORTED_MODULE_2__service_utils__=__webpack_require__(1);var API_ENDPOINT="member/local"},function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__channel_manager__=__webpack_require__(53);var __WEBPACK_IMPORTED_MODULE_1_service_configuration_service__=__webpack_require__(4);var __WEBPACK_IMPORTED_MODULE_2_util_inherit__=__webpack_require__(6);var __WEBPACK_IMPORTED_MODULE_2_util_inherit___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_util_inherit__);var __WEBPACK_IMPORTED_MODULE_3_store_session_manager__=__webpack_require__(3);var __WEBPACK_IMPORTED_MODULE_3_store_session_manager___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_store_session_manager__);var __WEBPACK_IMPORTED_MODULE_4__world_channel_subscribe_world_channel__=__webpack_require__(54);var validTypes={project:!0,group:!0,world:!0,user:!0,data:!0,general:!0,chat:!0};var getFromSessionOrError=function(value,sessionKeyName,settings){if(!value){if(!settings||!settings[sessionKeyName])throw new Error(sessionKeyName+" not found. Please log-in again, or specify "+sessionKeyName+" explicitly");value=settings[sessionKeyName]}return value};var isPresenceData=function(payload){return payload.data&&"user"===payload.data.type&&payload.data.user};var __super=__WEBPACK_IMPORTED_MODULE_0__channel_manager__.a.prototype;var EpicenterChannelManager=__WEBPACK_IMPORTED_MODULE_2_util_inherit___default()(__WEBPACK_IMPORTED_MODULE_0__channel_manager__.a,{constructor:function(options){this.sessionManager=new __WEBPACK_IMPORTED_MODULE_3_store_session_manager___default.a(options);var defaultCometOptions=this.sessionManager.getMergedOptions(options);var urlConfig=new __WEBPACK_IMPORTED_MODULE_1_service_configuration_service__.default(defaultCometOptions).get("server");if(defaultCometOptions.url||(defaultCometOptions.url=urlConfig.getAPIPath("channel")),void 0===defaultCometOptions.handshake){var userName=defaultCometOptions.userName;var userId=defaultCometOptions.userId;var token=defaultCometOptions.token;if((userName||userId)&&token){var userProp=userName?"userName":"userId";var ext={authorization:"Bearer "+token};ext[userProp]=userName||userId,defaultCometOptions.handshake={ext:ext}}}return this.options=defaultCometOptions,__super.constructor.call(this,defaultCometOptions)},getChannel:function(options){options&&"object"!=typeof options&&(options={base:options});var channelOpts=$.extend({},this.options,options);var base=channelOpts.base;if(!base)throw new Error("No base topic was provided");if(!channelOpts.allowAllChannels){var baseParts=base.split("/");var channelType=baseParts[1];if(baseParts.length<4)throw new Error("Invalid channel base name, it must be in the form /{type}/{account id}/{project id}/{...}");if(!validTypes[channelType])throw new Error("Invalid channel type")}return __super.getChannel.apply(this,arguments)},getGroupChannel:function(groupName){var session=this.sessionManager.getMergedOptions(this.options);groupName=getFromSessionOrError(groupName,"groupName",session);var account=getFromSessionOrError("","account",session);var project=getFromSessionOrError("","project",session);var baseTopic=["/group",account,project,groupName].join("/");var channel=__super.getChannel.call(this,{base:baseTopic});var oldsubs=channel.subscribe;return channel.subscribe=function(topic,callback,context,options){var callbackWithoutPresenceData=function(payload){isPresenceData(payload)||callback.call(context,payload)};return oldsubs.call(channel,topic,callbackWithoutPresenceData,context,options)},channel},getWorldChannel:function(world,groupName){var worldid=$.isPlainObject(world)&&world.id?world.id:world;if(!worldid)throw new Error("Please specify a world id");var session=this.sessionManager.getMergedOptions(this.options);groupName=getFromSessionOrError(groupName,"groupName",session);var account=getFromSessionOrError("","account",session);var project=getFromSessionOrError("","project",session);var baseTopic=["/world",account,project,groupName,worldid].join("/");var channel=__super.getChannel.call(this,{base:baseTopic});return Object(__WEBPACK_IMPORTED_MODULE_4__world_channel_subscribe_world_channel__.a)(worldid,channel,session,{baseTopic:baseTopic,account:account,project:project})},getUserChannel:function(world,user,groupName){var worldid=$.isPlainObject(world)&&world.id?world.id:world;if(!worldid)throw new Error("Please specify a world id");var session=this.sessionManager.getMergedOptions(this.options);var userid=$.isPlainObject(user)&&user.id?user.id:user;userid=getFromSessionOrError(userid,"userId",session),groupName=getFromSessionOrError(groupName,"groupName",session);var account=getFromSessionOrError("","account",session);var project=getFromSessionOrError("","project",session);var baseTopic=["/user",account,project,groupName,worldid,userid].join("/");return __super.getChannel.call(this,{base:baseTopic})},getPresenceChannel:function(groupName){var session=this.sessionManager.getMergedOptions(this.options);groupName=getFromSessionOrError(groupName,"groupName",session);var account=getFromSessionOrError("","account",session);var project=getFromSessionOrError("","project",session);var baseTopic=["/group",account,project,groupName].join("/");var channel=__super.getChannel.call(this,{base:baseTopic});var oldsubs=channel.subscribe;return channel.subscribe=function(topic,callback,context,options){var callbackWithOnlyPresenceData=function(payload){isPresenceData(payload)&&callback.call(context,payload)};return oldsubs.call(channel,topic,callbackWithOnlyPresenceData,context,options)},channel},getDataChannel:function(collection){if(!collection)throw new Error("Please specify a collection to listen on.");var session=this.sessionManager.getMergedOptions(this.options);var account=getFromSessionOrError("","account",session);var project=getFromSessionOrError("","project",session);var baseTopic=["/data",account,project,collection].join("/");var channel=__super.getChannel.call(this,{base:baseTopic});var oldsubs=channel.subscribe;return channel.subscribe=function(topic,callback,context,options){var callbackWithCleanData=function(payload){var meta={path:payload.channel,subType:payload.data.subType,date:payload.data.date,dataPath:payload.data.data.path};var actualData=payload.data.data;void 0!==actualData.data&&(actualData=actualData.data),callback.call(context,actualData,meta)};return oldsubs.call(channel,topic,callbackWithCleanData,context,options)},channel}});__webpack_exports__.default=EpicenterChannelManager},function(module,__webpack_exports__,__webpack_require__){"use strict";function normalizeActions(actions){return[].concat(actions).map(function(action){return action.arguments?{execute:action}:action})}function ConsensusService(config){function getHTTPOptions(action,options){var mergedOptions=$.extend(!0,{},serviceOptions,options);var consensusGroup=mergedOptions.consensusGroup||"default";if(!mergedOptions.worldId||!mergedOptions.name)throw new Error("Consensus Service: worldId and name are required");var urlSegment=[].concat(action||[],[mergedOptions.worldId,consensusGroup,mergedOptions.name]).join("/");var baseURL=urlConfig.getAPIPath(API_ENDPOINT);var url=baseURL+urlSegment;return $.extend(!0,{},mergedOptions,{url:url})}var defaults={worldId:"",consensusGroup:"",name:"",token:void 0};var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_1_service_service_utils__.b)(defaults,config);var urlConfig=Object(__WEBPACK_IMPORTED_MODULE_1_service_service_utils__.d)(serviceOptions);var http=new __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__.default(serviceOptions.transport);var publicAPI={create:function(params,options){var httpOptions=getHTTPOptions("",options);if(!params||!params.roles)throw new Error("Consensus Service: no roles passed to create");var postParams=Object.keys(params).reduce(function(accum,field){var fieldVal=params[field];return"roles"===field&&Array.isArray(fieldVal)?accum.roles=fieldVal.reduce(function(accum,role){return accum[role]=1,accum},{}):"defaultActions"===field?accum.actions=Object.keys(fieldVal).reduce(function(rolesAccum,roleName){return rolesAccum[roleName]=normalizeActions(fieldVal[roleName]),rolesAccum},{}):accum[field]=fieldVal,accum},{roles:{}});return http.post(postParams,httpOptions)},updateDefaults:function(params,options){if(!params||!params.defaultActions)throw new Error("updateDefaults: Need to pass in parameters to update");var httpOptions=getHTTPOptions("actions",options);return http.patch({actions:normalizeActions(params.defaultActions)},httpOptions)},load:function(options){var httpOptions=getHTTPOptions("",options);return http.get({},httpOptions)},delete:function(options){var httpOptions=getHTTPOptions("",options);return http.delete({},httpOptions)},forceClose:function(options){var httpOptions=getHTTPOptions("close",options);return http.post({},httpOptions)},submitActions:function(actions,options){if(!actions||![].concat(actions).length)throw new Error("submitActions: No actions provided to submit");var httpOptions=getHTTPOptions("actions",options);return http.post({actions:normalizeActions(actions)},httpOptions)},undoSubmit:function(options){var httpOptions=getHTTPOptions("actions",options);return http.delete({},httpOptions)},getCurrentConfig:function(){return serviceOptions},getChannel:function(options){}};$.extend(this,publicAPI)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=ConsensusService;var __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__=__webpack_require__(0);var __WEBPACK_IMPORTED_MODULE_1_service_service_utils__=__webpack_require__(1);var API_ENDPOINT="multiplayer/consensus"},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return ACTIONS});var ACTIONS={CREATE:"CREATE",START:"START",PAUSE:"PAUSE",RESUME:"RESUME",COMPLETE:"COMPLETE",RESET:"RESET",TICK:"TICK"}},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function patchRunService(service,manager){if(service.patched)return service;var orig=service.do;return service.do=function(operation,params,options){return-1===Object.keys(__WEBPACK_IMPORTED_MODULE_1__special_operations__).indexOf(operation)?orig.apply(service,arguments):__WEBPACK_IMPORTED_MODULE_1__special_operations__[operation].call(service,params,options,manager)},service.patched=!0,service}function sessionKeyFromOptions(options,runService){var config=runService.getCurrentConfig();return $.isFunction(options.sessionKey)?options.sessionKey(config):options.sessionKey}function setRunInSession(sessionKey,run,sessionManager){sessionKey&&(delete run.variables,sessionManager.getStore().set(sessionKey,JSON.stringify(run)))}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_managers_run_strategies__=__webpack_require__(41);var __WEBPACK_IMPORTED_MODULE_1__special_operations__=__webpack_require__(73);var __WEBPACK_IMPORTED_MODULE_2_service_run_api_service__=__webpack_require__(8);var __WEBPACK_IMPORTED_MODULE_3_store_session_manager__=__webpack_require__(3);var __WEBPACK_IMPORTED_MODULE_3_store_session_manager___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_store_session_manager__);var __WEBPACK_IMPORTED_MODULE_4_util_object_util__=__webpack_require__(2);var __WEBPACK_IMPORTED_MODULE_5_managers_key_names__=__webpack_require__(16);__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_managers_key_names__);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var RunManager=function(){function RunManager(options){_classCallCheck(this,RunManager);var defaults={sessionKey:function(config){var baseKey=__WEBPACK_IMPORTED_MODULE_5_managers_key_names__.STRATEGY_SESSION_KEY;return["account","project","model"].reduce(function(accum,key){return config[key]?accum+"-"+config[key]:accum},baseKey)}};if(this.options=$.extend(!0,{},defaults,options),this.options.run instanceof __WEBPACK_IMPORTED_MODULE_2_service_run_api_service__.default)this.run=this.options.run;else{if(Object(__WEBPACK_IMPORTED_MODULE_4_util_object_util__.isEmpty)(this.options.run))throw new Error("No run options passed to RunManager");this.run=new __WEBPACK_IMPORTED_MODULE_2_service_run_api_service__.default(this.options.run)}patchRunService(this.run,this),this.strategy=__WEBPACK_IMPORTED_MODULE_0_managers_run_strategies__.default.getBestStrategy(this.options),this.sessionManager=new __WEBPACK_IMPORTED_MODULE_3_store_session_manager___default.a(this.options)}return _createClass(RunManager,[{key:"getRun",value:function(variables,options){var _this=this;var sessionStore=this.sessionManager.getStore();var sessionContents=sessionStore.get(sessionKeyFromOptions(this.options,this.run));var runSession=JSON.parse(sessionContents||"{}");runSession.runId&&(runSession.id=runSession.runId);var authSession=this.sessionManager.getSession();return this.strategy.requiresAuth&&Object(__WEBPACK_IMPORTED_MODULE_4_util_object_util__.isEmpty)(authSession)?(console.error("No user-session available",this.options.strategy,"requires authentication."),$.Deferred().reject({type:"UNAUTHORIZED",message:"No user-session available"}).promise()):this.fetchProm?(console.warn("Two simultaneous calls to `getRun` detected on the same RunManager instance. Either create different instances, or eliminate duplicate call"),this.fetchProm):(this.fetchProm=this.strategy.getRun(this.run,authSession,runSession,options).then(function(run){if(!run||!run.id)return run;(_this.run.updateConfig({filter:run.id}),!1!==_this.strategy.allowRunIDCache)&&setRunInSession(sessionKeyFromOptions(_this.options,_this.run),run,_this.sessionManager);return variables&&variables.length?_this.run.variables().query(variables).then(function(results){return run.variables=results,run}).catch(function(err){return run.variables={},console.error("RunManager variables fetch error",err),run}):run}).then(function(r){return _this.fetchProm=null,r},function(err){throw _this.fetchProm=null,err}),this.fetchProm)}},{key:"reset",value:function(options){var _this2=this;var authSession=this.sessionManager.getSession();if(this.strategy.requiresAuth&&Object(__WEBPACK_IMPORTED_MODULE_4_util_object_util__.isEmpty)(authSession))return console.error("No user-session available",this.options.strategy,"requires authentication."),$.Deferred().reject({type:"UNAUTHORIZED",message:"No user-session available"}).promise();var optionsToPassOn=Object(__WEBPACK_IMPORTED_MODULE_4_util_object_util__.omit)(options,["success","error"]);return this.strategy.reset(this.run,authSession,optionsToPassOn).then(function(run){if(run&&run.id){_this2.run.updateConfig({filter:run.id});if(!1!==_this2.strategy.allowRunIDCache){setRunInSession(sessionKeyFromOptions(_this2.options,_this2.run),run.id,_this2.sessionManager)}}return options&&options.success&&options&&options.success(run),run}).catch(function(e){throw options&&options.error&&options&&options.error(e),e})}}]),RunManager}();RunManager.STRATEGY=__WEBPACK_IMPORTED_MODULE_0_managers_run_strategies__.strategyKeys,RunManager.strategies=__WEBPACK_IMPORTED_MODULE_0_managers_run_strategies__.default,__webpack_exports__.default=RunManager},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_service_run_api_service__=__webpack_require__(8);var __WEBPACK_IMPORTED_MODULE_1_store_session_manager__=__webpack_require__(3);var __WEBPACK_IMPORTED_MODULE_1_store_session_manager___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_store_session_manager__);var __WEBPACK_IMPORTED_MODULE_2_managers_run_strategies_strategy_utils__=__webpack_require__(7);var __WEBPACK_IMPORTED_MODULE_3_util_bulk_fetch_records__=__webpack_require__(74);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var SavedRunsManager=function(){function SavedRunsManager(config){_classCallCheck(this,SavedRunsManager);var defaults={scopeByGroup:!0,scopeByUser:!0,run:null};this.sessionManager=new __WEBPACK_IMPORTED_MODULE_1_store_session_manager___default.a;var options=$.extend(!0,{},defaults,config);if(!options.run)throw new Error("No run options passed to SavedRunsManager");options.run instanceof __WEBPACK_IMPORTED_MODULE_0_service_run_api_service__.default?this.runService=options.run:this.runService=new __WEBPACK_IMPORTED_MODULE_0_service_run_api_service__.default(options.run),this.options=options}return _createClass(SavedRunsManager,[{key:"save",value:function(run,otherFields){var runConfig=this.runService.getCurrentConfig();var defaultToSave={};runConfig.scope&&runConfig.scope.trackingKey&&(defaultToSave.scope={trackingKey:runConfig.scope.trackingKey});var param=$.extend(!0,defaultToSave,otherFields,{saved:!0,trashed:!1});return this.mark(run,param)}},{key:"remove",value:function(run,otherFields){var param=$.extend(!0,{},otherFields,{saved:!1,trashed:!0});return this.mark(run,param)}},{key:"mark",value:function(run,toMark){var rs=void 0;var existingOptions=this.runService.getCurrentConfig();if(run instanceof __WEBPACK_IMPORTED_MODULE_0_service_run_api_service__.default)rs=run;else{if(!run||"string"!=typeof run){if(Array.isArray(run)){var me=this;var proms=run.map(function(r){return me.mark(r,toMark)});return $.when.apply(null,proms)}throw new Error("Invalid run object provided")}rs=new __WEBPACK_IMPORTED_MODULE_0_service_run_api_service__.default($.extend(!0,{},existingOptions,{id:run,autoRestore:!1}))}return rs.save(toMark)}},{key:"getRuns",value:function(variables,filter,modifiers,options){var _this=this;var session=this.sessionManager.getSession(this.runService.getCurrentConfig());var runopts=this.runService.getCurrentConfig();var scopedFilter=Object(__WEBPACK_IMPORTED_MODULE_2_managers_run_strategies_strategy_utils__.a)($.extend(!0,{},{saved:!0,trashed:!1,model:runopts.model},filter),session,this.options);Object.keys(filter||{}).forEach(function(key){void 0===filter[key]&&delete scopedFilter[key]});var opModifiers=$.extend(!0,{},{sort:"created",direction:"asc"},modifiers);variables&&(opModifiers.include=[].concat(variables));var ops=$.extend({},{recordsPerFetch:100,onData:function(){},startRecord:opModifiers.startRecord,endRecord:opModifiers.endRecord},options);return Object(__WEBPACK_IMPORTED_MODULE_3_util_bulk_fetch_records__.a)(function(startRecord,endRecord){var opModifiersWithPaging=$.extend({},opModifiers,{startRecord:startRecord,endRecord:endRecord});return _this.runService.query(scopedFilter,opModifiersWithPaging)},ops)}}]),SavedRunsManager}();__webpack_exports__.default=SavedRunsManager},function(module,exports){module.exports={version:"v2"}},function(module,exports,__webpack_require__){var _require=__webpack_require__(2),omit=_require.omit;var _require2=__webpack_require__(10),toQueryFormat=_require2.toQueryFormat;module.exports=function(config){var defaults={url:"",contentType:"application/json",headers:{},statusCode:{404:$.noop},parameterParser:toQueryFormat,xhrFields:{withCredentials:!0}};var transportOptions=$.extend({},defaults,config);var result=function(d){return $.isFunction(d)?d():d};var connect=function(method,params,connectOptions){params=result(params),params=$.isPlainObject(params)||Array.isArray(params)?JSON.stringify(params):params;var options=$.extend(!0,{},transportOptions,connectOptions,{method:method,data:params});var ALLOWED_TO_BE_FUNCTIONS=["data","url"];if($.each(options,function(key,value){$.isFunction(value)&&-1!==ALLOWED_TO_BE_FUNCTIONS.indexOf(key)&&(options[key]=value())}),options.logLevel&&"DEBUG"===options.logLevel){console.log(options.url);var oldSuccessFn=options.success||$.noop;options.success=function(response,ajaxStatus,ajaxReq){console.log(response),oldSuccessFn.apply(this,arguments)}}var beforeSend=options.beforeSend;options.beforeSend=function(xhr,settings){xhr.requestUrl=(connectOptions||{}).url,beforeSend&&beforeSend.apply(this,arguments)};var paramsToIgnore=["password","username","isLocal","type"];var cleaned=omit(options,paramsToIgnore);return $.ajax(cleaned)};var publicAPI={get:function(params,ajaxOptions){var options=$.extend({},transportOptions,ajaxOptions);return params=options.parameterParser(result(params)),connect.call(this,"GET",params,options)},splitGet:function(){},post:function(){return connect.apply(this,["post"].concat([].slice.call(arguments)))},patch:function(){return connect.apply(this,["patch"].concat([].slice.call(arguments)))},put:function(){return connect.apply(this,["put"].concat([].slice.call(arguments)))},delete:function(params,ajaxOptions){var options=$.extend({},transportOptions,ajaxOptions);if(params=options.parameterParser(result(params)),$.trim(params)){var delimiter=-1===result(options.url).indexOf("?")?"?":"&";options.url=result(options.url)+delimiter+params}return connect.call(this,"DELETE",null,options)},head:function(){return connect.apply(this,["head"].concat([].slice.call(arguments)))},options:function(){return connect.apply(this,["options"].concat([].slice.call(arguments)))}};return $.extend(this,publicAPI)}},function(module,__webpack_exports__,__webpack_require__){"use strict";function VariablesService(config){var defaults={runService:null};var serviceOptions=$.extend({},defaults,config);var getURL=function(){return serviceOptions.runService.urlConfig.getFilterURL()+"variables/"};var addAutoRestoreHeader=function(options){return serviceOptions.runService.urlConfig.addAutoRestoreHeader(options)};var httpOptions={url:getURL};serviceOptions.token&&(httpOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__.default(httpOptions);http.splitGet=Object(__WEBPACK_IMPORTED_MODULE_1_util_run_util__.splitGetFactory)(httpOptions);var publicAPI={load:function(variable,outputModifier,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions=addAutoRestoreHeader(httpOptions),http.get(outputModifier,$.extend({},httpOptions,{url:getURL()+variable+"/"}))},query:function(query,outputModifier,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions=addAutoRestoreHeader(httpOptions),Array.isArray(query)&&(query={include:query}),$.extend(query,outputModifier),http.splitGet(query,httpOptions)},save:function(variable,val,options){var attrs;"object"==typeof variable?(attrs=variable,options=val):(attrs={})[variable]=val;var httpOptions=$.extend(!0,{},serviceOptions,options);return http.patch.call(this,attrs,httpOptions)}};$.extend(this,publicAPI)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=VariablesService;var __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__=__webpack_require__(0);var __WEBPACK_IMPORTED_MODULE_1_util_run_util__=__webpack_require__(5)},function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__=__webpack_require__(0);var __WEBPACK_IMPORTED_MODULE_1__service_utils__=__webpack_require__(1);__webpack_exports__.default=function(config){var defaults={token:void 0,account:void 0,project:void 0};var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_1__service_utils__.b)(defaults,config,{apiEndpoint:"model/introspect"});var urlConfig=Object(__WEBPACK_IMPORTED_MODULE_1__service_utils__.d)(serviceOptions);var http=new __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__.default(serviceOptions.transport);var publicAPI={byModel:function(modelFile,options){var opts=$.extend(!0,{},serviceOptions,options);if(!opts.account||!opts.project)throw new Error("Account and project are required when using introspect#byModel");if(!modelFile)throw new Error("modelFile is required when using introspect#byModel");var url={url:urlConfig.getAPIPath("model/introspect")+[opts.account,opts.project,modelFile].join("/")};var httpOptions=$.extend(!0,{},serviceOptions,options,url);return http.get("",httpOptions)},byRunID:function(runID,options){if(!runID)throw new Error("runID is required when using introspect#byModel");var url={url:urlConfig.getAPIPath("model/introspect")+runID};var httpOptions=$.extend(!0,{},serviceOptions,options,url);return http.get("",httpOptions)}};$.extend(this,publicAPI)}},function(module,exports,__webpack_require__){"use strict";var store=__webpack_require__(29);module.exports=store},function(module,exports){var Cookie=function(){this.get=function(){return document.cookie},this.set=function(newCookie){document.cookie=newCookie}};module.exports=function(config){var host=window.location.hostname;var validHost=host.split(".").length>1;var domain=validHost?"."+host:null;var defaults={root:"/",domain:domain,cookie:new Cookie};this.serviceOptions=$.extend({},defaults,config);var publicAPI={set:function(key,value,options){var setOptions=$.extend(!0,{},this.serviceOptions,options);var domain=setOptions.domain;var path=setOptions.root;var cookie=setOptions.cookie;var contents=[encodeURIComponent(key)+"="+encodeURIComponent(value)];return domain&&contents.push("domain="+domain),path&&contents.push("path="+path),void 0!==setOptions.expires&&contents.push("expires="+setOptions.expires),cookie.set(contents.join("; ")),value},get:function(key){var cookie=this.serviceOptions.cookie;var cookieReg=new RegExp("(?:^|;)\\s*"+encodeURIComponent(key).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$");var res=cookieReg.exec(cookie.get());return res?decodeURIComponent(res[1]):null},remove:function(key,options){var remOptions=$.extend(!0,{},this.serviceOptions,options);var domain=remOptions.domain;var path=remOptions.root;return remOptions.cookie.set(encodeURIComponent(key)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(domain?"; domain="+domain:"")+(path?"; path="+path:"")),key},destroy:function(){var cookie=this.serviceOptions.cookie;var aKeys=cookie.get().replace(/((?:^|\s*;)[^=]+)(?=;|$)|^\s*|\s*(?:=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:=[^;]*)?;\s*/);for(var nIdx=0;nIdx<aKeys.length;nIdx++){var cookieKey=decodeURIComponent(aKeys[nIdx]);this.remove(cookieKey)}return aKeys}};$.extend(this,publicAPI)}},function(module,__webpack_exports__,__webpack_require__){"use strict";function AuthService(config){var defaults={userName:"",account:"",transport:{}};var serviceOptions=$.extend({},defaults,config);var urlConfig=new __WEBPACK_IMPORTED_MODULE_0_service_configuration_service__.default(serviceOptions).get("server");var transportOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getAPIPath("authentication")});var http=new __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__.default(transportOptions);var publicAPI={login:function(options){var httpOptions=$.extend(!0,{success:$.noop},serviceOptions,options);if(!httpOptions.userName||!httpOptions.password){var resp={status:401,statusMessage:"No username or password specified."};return options.error&&options.error.call(this,resp),$.Deferred().reject(resp).promise()}var postParams={userName:httpOptions.userName,password:httpOptions.password};return httpOptions.account&&(postParams.account=httpOptions.account),httpOptions.project&&(postParams.project=httpOptions.project),http.post(postParams,httpOptions)},logout:function(options){var dtd=$.Deferred();return dtd.resolve(),dtd.promise()}};$.extend(this,publicAPI)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=AuthService;var __WEBPACK_IMPORTED_MODULE_0_service_configuration_service__=__webpack_require__(4);var __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__=__webpack_require__(0)},function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_service_service_utils__=__webpack_require__(1);var __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__=__webpack_require__(0);var GroupService=function(config){var defaults={account:void 0,project:void 0,transport:{}};var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_0_service_service_utils__.b)(defaults,config,{apiEndpoint:"group/local"});var transportOptions=serviceOptions.transport;delete serviceOptions.transport;var http=new __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__.default(transportOptions,serviceOptions);var publicAPI={getGroups:function(params,options){var finalOpts=$.extend(!0,{},serviceOptions,options);var finalParams;return"string"==typeof params?finalOpts.url=Object(__WEBPACK_IMPORTED_MODULE_0_service_service_utils__.a)("group/local/"+params,finalOpts):finalParams=params,http.get(finalParams,finalOpts)}};$.extend(this,publicAPI)};__webpack_exports__.default=GroupService},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var makeName=function(channelName,topic){return(channelName?channelName+"/"+topic:topic).replace(/\/\//g,"/").replace(/\/$/,"")};var ChannelService=function(){function ChannelService(options){_classCallCheck(this,ChannelService);var defaults={base:"",topicResolver:function(topic){return topic},transport:null};this.channelOptions=$.extend(!0,{},defaults,options)}return _createClass(ChannelService,[{key:"subscribe",value:function(topic,callback,context,options){var topics=[].concat(topic);var me=this;var subscriptionIds=[];var opts=me.channelOptions;return opts.transport.batch(function(){$.each(topics,function(index,topic){topic=makeName(opts.base,opts.topicResolver(topic)),subscriptionIds.push(opts.transport.subscribe(topic,callback))})}),subscriptionIds[1]?subscriptionIds:subscriptionIds[0]}},{key:"publish",value:function(topic,data){var topics=[].concat(topic);var me=this;var returnObjs=[];var opts=me.channelOptions;return opts.transport.batch(function(){$.each(topics,function(index,topic){topic=makeName(opts.base,opts.topicResolver(topic)),"*"===topic.charAt(topic.length-1)&&(topic=topic.replace(/\*+$/,""),console.warn("You can cannot publish to channels with wildcards. Publishing to ",topic,"instead")),returnObjs.push(opts.transport.publish(topic,data))})}),returnObjs[1]?returnObjs:returnObjs[0]}},{key:"unsubscribe",value:function(token){return this.channelOptions.transport.unsubscribe(token),this}},{key:"on",value:function(event){$(this).on.apply($(this),arguments)}},{key:"off",value:function(event){$(this).off.apply($(this),arguments)}},{key:"trigger",value:function(event){$(this).trigger.apply($(this),arguments)}}]),ChannelService}();__webpack_exports__.default=ChannelService},function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_service_service_utils__=__webpack_require__(1);var __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__=__webpack_require__(0);__webpack_exports__.default=function(config){function cancelKeepOnline(userid){clearInterval(userOnlineTimers[userid])}var defaults={groupName:void 0,account:void 0,project:void 0,transport:{}};var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_0_service_service_utils__.b)(defaults,config,{apiEndpoint:"presence"});var urlConfig=Object(__WEBPACK_IMPORTED_MODULE_0_service_service_utils__.d)(serviceOptions);var http=new __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__.default(serviceOptions.transport);var getFinalParams=function(params){return"object"==typeof params?$.extend(!0,{},serviceOptions,params):serviceOptions};var userOnlineTimers={};var publicAPI={markOnline:function(userId,options){options=options||{};var isString="string"==typeof userId;var objParams=getFinalParams(userId);if(!objParams.groupName&&!options.groupName)throw new Error("No groupName specified.");userId=isString?userId:objParams.userId;var groupName=options.groupName||objParams.groupName;var httpOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("presence")+groupName+"/"+userId});if(options.keepOnline){userOnlineTimers[userId]=setInterval(function(){http.post({message:"online"},httpOptions)},3e5)}return http.post({message:"online"},httpOptions)},cancelKeepOnline:function(userid){cancelKeepOnline(userid)},markOffline:function(userId,options){options=options||{};var isString="string"==typeof userId;var objParams=getFinalParams(userId);if(!objParams.groupName&&!options.groupName)throw new Error("No groupName specified.");userId=isString?userId:objParams.userId;var groupName=options.groupName||objParams.groupName;var httpOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("presence")+groupName+"/"+userId});return cancelKeepOnline(userId),http.delete({},httpOptions)},getStatus:function(groupName,options){options=options||{};var objParams=getFinalParams(groupName);if(!groupName&&!objParams.groupName)throw new Error("No groupName specified.");groupName=groupName||objParams.groupName;var httpOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("presence")+groupName});return http.get({},httpOptions)},getStatusForUsers:function(userList,groupName,options){if(!userList||!Array.isArray(userList))throw new Error("getStatusForUsers: No userList provided.");return this.getStatus(groupName,options).then(function(presenceList){return userList.map(function(user){var isOnline=presenceList.find(function(status){return status.userId===user.userId});return user.isOnline=!!isOnline,user})})},getChannel:function(groupName,options){var ChannelManager=__webpack_require__(19).default;options=options||{};var isString="string"==typeof groupName;var objParams=getFinalParams(groupName);if(!isString&&!objParams.groupName)throw new Error("No groupName specified.");return groupName=isString?groupName:objParams.groupName,new ChannelManager(options).getPresenceChannel(groupName)}};$.extend(this,publicAPI)}},function(module,__webpack_exports__,__webpack_require__){"use strict";function StateService(config){var defaults={};var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_2_service_service_utils__.b)(defaults,config,{apiEndpoint:apiEndpoint});var urlConfig=Object(__WEBPACK_IMPORTED_MODULE_2_service_service_utils__.d)(serviceOptions);var http=new __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__.default(serviceOptions.transport);var parseRunIdOrError=function(params){if($.isPlainObject(params)&&params.runId)return params.runId;throw new Error("Please pass in a run id")};var publicAPI={load:function(runId,options){var httpParams=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+runId});return http.get("",httpParams)},replay:function(params,options){var runId=parseRunIdOrError(params);var replayOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+runId});return params=$.extend(!0,{action:"replay"},Object(__WEBPACK_IMPORTED_MODULE_1_util_object_util__.pick)(params,["stopBefore","exclude"])),http.post(params,replayOptions)},rewind:function(params,options){var runId=parseRunIdOrError(params);var replayOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+"rewind/"+runId});return http.post({},replayOptions)},clone:function(params,options){var runId=parseRunIdOrError(params);var replayOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+runId});return params=$.extend(!0,{action:"clone"},Object(__WEBPACK_IMPORTED_MODULE_1_util_object_util__.pick)(params,["stopBefore","exclude"])),http.post(params,replayOptions)},cloneForSensitivity:function(runId,options){var params={modelContext:{restorations:{assembly:[{replay:{operations:[{operationType:"stop_before",targetType:"execute",targetKey:"stepTo"}]}}]}},executionContext:{tool:{vensim:{sensitivityMode:!0}}}};var httpoptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+"clone/"+runId});return http.post(params,httpoptions)}};$.extend(this,publicAPI)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=StateService;var __WEBPACK_IMPORTED_MODULE_0_transport_http_transport_factory__=__webpack_require__(0);var __WEBPACK_IMPORTED_MODULE_1_util_object_util__=__webpack_require__(2);var __WEBPACK_IMPORTED_MODULE_2_service_service_utils__=__webpack_require__(1);var apiEndpoint="model/state"},function(module,__webpack_exports__,__webpack_require__){"use strict";function UserAPIAdapter(config){var defaults={account:void 0,token:void 0,transport:{}};var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_0__service_utils__.b)(defaults,config,{apiEndpoint:"user"});var urlConfig=Object(__WEBPACK_IMPORTED_MODULE_0__service_utils__.d)(serviceOptions);var http=new __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__.default(serviceOptions.transport);var publicAPI={get:function(filter,options){filter=filter||{};var httpOptions=$.extend(!0,{},serviceOptions,options);var query=filter.userName?{q:filter.userName}:{};var params=["account="+httpOptions.account,function(id){return id?"id="+(Array.isArray(id)?id:[id]).join("&id="):""}(filter.id),Object(__WEBPACK_IMPORTED_MODULE_2_util_query_util__.toQueryFormat)(query)].join("&");return filter.id&&Array.isArray(filter.id)&&filter.id.length>=30?(httpOptions.url=urlConfig.getAPIPath("user")+"?_method=GET",http.post({id:filter.id},httpOptions)):http.get(params,httpOptions)},getById:function(userId,options){return publicAPI.get({id:userId},options)},createUsers:function(userList,options){if(!userList||!Array.isArray(userList))return $.Deferred().reject({type:"INVALID_USERS",payload:userList}).promise();var httpOptions=$.extend(!0,{},serviceOptions,options);var requiredFields=["userName","password","firstName","lastName"];var sortedUsers=userList.reduce(function(accum,user){var missingRequiredFields=requiredFields.filter(function(field){return void 0===user[field]});var account=user.account||httpOptions.account;return account||missingRequiredFields.push(account),missingRequiredFields.length&&accum.invalid.push({user:user,missingFields:missingRequiredFields}),user.account||(user.account=httpOptions.account),accum.valid.push(user),accum},{valid:[],invalid:[]});return sortedUsers.invalid.length?$.Deferred().reject({type:"INVALID_USERS",payload:sortedUsers.invalid}).promise():http.post(sortedUsers.valid,httpOptions)}};$.extend(this,publicAPI)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=UserAPIAdapter;var __WEBPACK_IMPORTED_MODULE_0__service_utils__=__webpack_require__(1);var __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__=__webpack_require__(0);var __WEBPACK_IMPORTED_MODULE_2_util_query_util__=__webpack_require__(10)},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_service_configuration_service__=__webpack_require__(4);var __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__=__webpack_require__(0);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var apiEndpoint="time";var TimeAPIService=function(){function TimeAPIService(config){_classCallCheck(this,TimeAPIService),this.serviceOptions=$.extend(!0,{},config);var urlConfig=new __WEBPACK_IMPORTED_MODULE_0_service_configuration_service__.default(this.serviceOptions).get("server");var transportOptions=$.extend(!0,{},this.serviceOptions.transport,{url:urlConfig.getAPIPath(apiEndpoint)});this.http=new __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__.default(transportOptions)}return _createClass(TimeAPIService,[{key:"getTime",value:function(){return this.http.get().then(function(t){return new Date(t)}).catch(function(e){if(e.responseText)return new Date(e.responseText);throw e})}}]),TimeAPIService}();__webpack_exports__.default=TimeAPIService},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function objectToPublishable(obj){return Object.keys(obj||{}).map(function(t){return{name:t,value:obj[t]}})}function publishableToObject(arr,mergeWith){return(arr||[]).reduce(function(accum,topic){return accum[topic.name]=topic.value,accum},__WEBPACK_IMPORTED_MODULE_0_jquery___default.a.extend(!0,{},mergeWith))}function normalizeParamOptions(topic,publishValue,options){return topic?__WEBPACK_IMPORTED_MODULE_0_jquery___default.a.isPlainObject(topic)?{params:objectToPublishable(topic),options:publishValue}:Array.isArray(topic)?{params:topic,options:publishValue}:{params:[{name:topic,value:publishValue}],options:options}:{params:[],options:{}}}function uniqueId(prefix){return i++,""+(prefix||"")+i}function makeSubs(topics,callback,options){var id=uniqueId("subs-");var defaults={batch:!1};var opts=__WEBPACK_IMPORTED_MODULE_0_jquery___default.a.extend({},defaults,options);if(!callback)throw new Error("subscribe callback should be a function");return __WEBPACK_IMPORTED_MODULE_0_jquery___default.a.extend(!0,{id:id,topics:[].concat(topics).map(function(t){return t.toLowerCase()}),callback:callback},opts)}function checkAndNotifyBatch(topics,subscription){var merged=__WEBPACK_IMPORTED_MODULE_0_jquery___default.a.extend(!0,{},publishableToObject(topics));var keys=Object.keys(merged).map(function(k){return k.toLowerCase()});var matchingTopics=Object(__WEBPACK_IMPORTED_MODULE_1_util_array_utils__.a)(keys,subscription.topics);if(matchingTopics.length>0){var toSend=subscription.topics.reduce(function(accum,topic){return accum[topic]=merged[topic],accum},{});matchingTopics.length===subscription.topics.length&&subscription.callback(toSend)}}function checkAndNotify(topics,subscription){topics.forEach(function(topic){-1===subscription.topics.indexOf(topic.name.toLowerCase())&&-1===subscription.topics.indexOf("*")||subscription.callback(topic.value)})}var __WEBPACK_IMPORTED_MODULE_0_jquery__=__webpack_require__(58);var __WEBPACK_IMPORTED_MODULE_0_jquery___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_jquery__);var __WEBPACK_IMPORTED_MODULE_1_util_array_utils__=__webpack_require__(38);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var i=0;var PubSub=function(){function PubSub(options){_classCallCheck(this,PubSub);var defaults={validTopics:[]};this.options=__WEBPACK_IMPORTED_MODULE_0_jquery___default.a.extend({},defaults,options),this.subscriptions=[]}return _createClass(PubSub,[{key:"publish",value:function(topic,value,options){var normalized=normalizeParamOptions(topic,value,options);return this.subscriptions.forEach(function(subs){(subs.batch?checkAndNotifyBatch:checkAndNotify)(normalized.params,subs)})}},{key:"subscribe",value:function(topics,cb,options){topics=[].concat(topics);var knownTopics=this.options.validTopics;if(0!==knownTopics.length&&Object(__WEBPACK_IMPORTED_MODULE_1_util_array_utils__.a)(topics,knownTopics).length!==topics.length)throw console.error("Uknown topics - ",topics,". Only known topics are",knownTopics),new Error("INVALID_TOPICS");var subs=makeSubs(topics,cb,options);return this.subscriptions=this.subscriptions.concat(subs),subs.id}},{key:"unsubscribe",value:function(token){var olderLength=this.subscriptions.length;if(!olderLength)throw new Error("No subscriptions found to unsubscribe from");var remaining=this.subscriptions.filter(function(subs){return subs.id!==token});if(remaining.length===olderLength)throw new Error("No subscription found for token "+token);this.subscriptions=remaining}},{key:"unsubscribeAll",value:function(){this.subscriptions=[]}}]),PubSub}();__webpack_exports__.a=PubSub},function(module,__webpack_exports__,__webpack_require__){"use strict";function intersection(a,b){var t;return b.length>a.length&&(t=b,b=a,a=t),a.filter(function(e){return b.indexOf(e)>-1})}__webpack_exports__.a=intersection},function(module,__webpack_exports__,__webpack_require__){"use strict";function reduceActions(actions,options){var defaults=$.extend({condition:function(){return!0}},options);var initialState={startTime:0,startedUsers:[]};return actions.reduce(function(accum,action){if(action.type!==__WEBPACK_IMPORTED_MODULE_0__timer_constants__.a.START||accum.startTime)return accum;var ts=+new Date(action.time);var user=action.user;return!!accum.startedUsers.find(function(u){return u.userName===user.userName})||accum.startedUsers.push(user),defaults.condition([].concat(accum.startedUsers))&&(accum.startTime=ts),accum},initialState).startTime}__webpack_exports__.a=reduceActions;var __WEBPACK_IMPORTED_MODULE_0__timer_constants__=__webpack_require__(21)},function(module,__webpack_exports__,__webpack_require__){"use strict";function ConsensusGroupService(config){function getHTTPOptions(options){var mergedOptions=$.extend(!0,{},serviceOptions,options);if(!mergedOptions.worldId)throw new Error("ConsensusGroup Service: worldId is required");var baseURL=urlConfig.getAPIPath(API_ENDPOINT);var url=baseURL+[mergedOptions.worldId,mergedOptions.name].join("/");return $.extend(!0,{},mergedOptions,{url:url})}var defaults={worldId:"",name:"default",token:void 0};var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_2_service_service_utils_js__.b)(defaults,config);var urlConfig=Object(__WEBPACK_IMPORTED_MODULE_2_service_service_utils_js__.d)(serviceOptions);var http=new __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__.default(serviceOptions.transport);var publicAPI={list:function(outputModifier,options){var httpOptions=getHTTPOptions(options);return http.get(outputModifier,httpOptions)},delete:function(options){var httpOptions=getHTTPOptions(options);return http.delete({},httpOptions)},consensus:function(name,options){var opts=$.extend({},!0,serviceOptions,options);return new __WEBPACK_IMPORTED_MODULE_0__consensus_service_js__.default($.extend(!0,opts,{consensusGroup:opts.name,name:name}))}};$.extend(this,publicAPI)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=ConsensusGroupService;var __WEBPACK_IMPORTED_MODULE_0__consensus_service_js__=__webpack_require__(20);var __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__=__webpack_require__(0);var __WEBPACK_IMPORTED_MODULE_2_service_service_utils_js__=__webpack_require__(1);var API_ENDPOINT="multiplayer/consensus"},function(module,__webpack_exports__,__webpack_require__){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_require__.d(__webpack_exports__,"strategyKeys",function(){return strategyKeys});var __WEBPACK_IMPORTED_MODULE_0__conditional_creation_strategy__=__webpack_require__(12);var __WEBPACK_IMPORTED_MODULE_0__conditional_creation_strategy___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__conditional_creation_strategy__);var __WEBPACK_IMPORTED_MODULE_1__deprecated_new_if_initialized_strategy__=__webpack_require__(67);var __WEBPACK_IMPORTED_MODULE_1__deprecated_new_if_initialized_strategy___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__deprecated_new_if_initialized_strategy__);var __WEBPACK_IMPORTED_MODULE_2__deprecated_new_if_persisted_strategy__=__webpack_require__(68);var __WEBPACK_IMPORTED_MODULE_2__deprecated_new_if_persisted_strategy___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2__deprecated_new_if_persisted_strategy__);var __WEBPACK_IMPORTED_MODULE_3__none_strategy__=__webpack_require__(14);var __WEBPACK_IMPORTED_MODULE_4__multiplayer_strategy__=__webpack_require__(42);var __WEBPACK_IMPORTED_MODULE_5__reuse_never__=__webpack_require__(69);var __WEBPACK_IMPORTED_MODULE_6__reuse_per_session__=__webpack_require__(70);var __WEBPACK_IMPORTED_MODULE_7__reuse_across_sessions__=__webpack_require__(71);var __WEBPACK_IMPORTED_MODULE_8__reuse_last_initialized__=__webpack_require__(43);var __WEBPACK_IMPORTED_MODULE_9__reuse_by_tracking_key__=__webpack_require__(44);var __WEBPACK_IMPORTED_MODULE_10__multiplayer_with_tracking_key__=__webpack_require__(45);var __WEBPACK_IMPORTED_MODULE_11__use_specific_run_strategy__=__webpack_require__(72);var _list;var strategyKeys={REUSE_NEVER:"reuse-never",REUSE_PER_SESSION:"reuse-per-session",REUSE_ACROSS_SESSIONS:"reuse-across-sessions",REUSE_LAST_INITIALIZED:"reuse-last-initialized",REUSE_BY_TRACKINGKEY:"reuse-by-tracking-key",REUSE_BY_TRACKINGKEY_MULTIPLAYER:"reuse-by-tracking-key-multiplayer",USE_SPECIFIC_RUN:"use-specific-run",MULTIPLAYER:"multiplayer",NONE:"none"};var list=(_list={"conditional-creation":__WEBPACK_IMPORTED_MODULE_0__conditional_creation_strategy___default.a,"new-if-initialized":__WEBPACK_IMPORTED_MODULE_1__deprecated_new_if_initialized_strategy___default.a,"new-if-persisted":__WEBPACK_IMPORTED_MODULE_2__deprecated_new_if_persisted_strategy___default.a},_defineProperty(_list,strategyKeys.NONE,__WEBPACK_IMPORTED_MODULE_3__none_strategy__.default),_defineProperty(_list,strategyKeys.MULTIPLAYER,__WEBPACK_IMPORTED_MODULE_4__multiplayer_strategy__.a),_defineProperty(_list,strategyKeys.USE_SPECIFIC_RUN,__WEBPACK_IMPORTED_MODULE_11__use_specific_run_strategy__.a),_defineProperty(_list,strategyKeys.REUSE_NEVER,__WEBPACK_IMPORTED_MODULE_5__reuse_never__.a),_defineProperty(_list,strategyKeys.REUSE_PER_SESSION,__WEBPACK_IMPORTED_MODULE_6__reuse_per_session__.a),_defineProperty(_list,strategyKeys.REUSE_ACROSS_SESSIONS,__WEBPACK_IMPORTED_MODULE_7__reuse_across_sessions__.a),_defineProperty(_list,strategyKeys.REUSE_LAST_INITIALIZED,__WEBPACK_IMPORTED_MODULE_8__reuse_last_initialized__.a),_defineProperty(_list,strategyKeys.REUSE_BY_TRACKINGKEY,__WEBPACK_IMPORTED_MODULE_9__reuse_by_tracking_key__.a),_defineProperty(_list,strategyKeys.REUSE_BY_TRACKINGKEY_MULTIPLAYER,__WEBPACK_IMPORTED_MODULE_10__multiplayer_with_tracking_key__.a),_list);list["always-new"]=list["reuse-never"],list["new-if-missing"]=list["reuse-per-session"],list["persistent-single-player"]=list["reuse-across-sessions"];var strategyManager={list:list,byName:function(strategyName){return list[strategyName]},getBestStrategy:function(options){var strategy=options.strategy;if(strategy||(strategy=options.strategyOptions&&options.strategyOptions.initOperation?"reuse-last-initialized":"reuse-per-session"),strategy.getRun)return strategy;var StrategyCtor="function"==typeof strategy?strategy:strategyManager.byName(strategy);if(!StrategyCtor)throw new Error("Specified run creation strategy was invalid:"+strategy);var strategyInstance=new StrategyCtor(options);if(!strategyInstance.getRun||!strategyInstance.reset)throw new Error("All strategies should implement a `getRun` and `reset` interface"+options.strategy);return strategyInstance.requiresAuth=StrategyCtor.requiresAuth,strategyInstance.allowRunIDCache=StrategyCtor.allowRunIDCache,strategyInstance},register:function(name,strategy,options){strategy.options=options,list[name]=strategy}};__webpack_exports__.default=strategyManager},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function worldFromRun(runService){var config=Object(__WEBPACK_IMPORTED_MODULE_2_util_object_util__.omit)(runService.getCurrentConfig(),["filter","id"]);return new __WEBPACK_IMPORTED_MODULE_0_service_world_api_adapter__.default(config)}function _reset(runService,session,options){var userId=session.userId,groupName=session.groupName;var optionsToPassOn=Object(__WEBPACK_IMPORTED_MODULE_2_util_object_util__.omit)($.extend(!0,{},options,{success:$.noop}),["filter","id"]);var worldApi=worldFromRun(runService);return worldApi.getCurrentWorldForUser(userId,groupName).then(function(world){return worldApi.newRunForWorld(world.id,optionsToPassOn).then(function(runid){return runService.load(runid)}).then(function(run){return run.freshlyCreated=!0,run.world=world,run})})}function getCurrentWorld(runService,session){var userId=session.userId,groupName=session.groupName;return worldFromRun(runService).getCurrentWorldForUser(userId,groupName)}function _getRun(runService,session,options){function loadRunFromWorld(world){if(!world)return Object(__WEBPACK_IMPORTED_MODULE_1_util_index__.c)("NO_WORLD_FOR_USER","User "+userId+" is not part of a world");var createOptions=$.extend(!0,{},options,{model:model,filter:world.id,id:world.id});return worldApi.getCurrentRunId(createOptions).then(function(id,status,xhr){return runService.load(id).then(function(run){return run.freshlyCreated=201===xhr.status,run})}).then(function(run){return run.world=world,run})}var userId=session.userId;var worldApi=worldFromRun(runService);var model=runService.getCurrentConfig().model;return userId?getCurrentWorld(runService,session).then(loadRunFromWorld):Object(__WEBPACK_IMPORTED_MODULE_1_util_index__.c)("UNAUTHORIZED","We need an authenticated user to join a multiplayer world. (ERR: no userId in session)")}__webpack_require__.d(__webpack_exports__,"d",function(){return _reset}),__webpack_require__.d(__webpack_exports__,"c",function(){return _getRun}),__webpack_exports__.b=getCurrentWorld;var __WEBPACK_IMPORTED_MODULE_0_service_world_api_adapter__=__webpack_require__(11);var __WEBPACK_IMPORTED_MODULE_1_util_index__=__webpack_require__(9);var __WEBPACK_IMPORTED_MODULE_2_util_object_util__=__webpack_require__(2);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var MultiplayerStrategy=function(){function MultiplayerStrategy(){_classCallCheck(this,MultiplayerStrategy)}return _createClass(MultiplayerStrategy,[{key:"reset",value:function(runService,session,options){return _reset(runService,session,options)}},{key:"getRun",value:function(runService,session,options){return _getRun(runService,session,options)}}]),MultiplayerStrategy}();__webpack_exports__.a=MultiplayerStrategy},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var __WEBPACK_IMPORTED_MODULE_0_managers_run_strategies_strategy_utils__=__webpack_require__(7);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var ReuseLastInitializedStrategy=function(){function ReuseLastInitializedStrategy(options){_classCallCheck(this,ReuseLastInitializedStrategy);var defaults={initOperation:[],flag:null,scope:{scopeByUser:!0,scopeByGroup:!0}};var strategyOptions=options?options.strategyOptions:{};if(this.options=$.extend(!0,{},defaults,strategyOptions),!this.options.initOperation||!this.options.initOperation.length)throw new Error("Specifying an init function is required for this strategy");this.options.flag||(this.options.flag={isInitComplete:!0})}return _createClass(ReuseLastInitializedStrategy,[{key:"reset",value:function(runService,userSession,options){var _this=this;var opt=Object(__WEBPACK_IMPORTED_MODULE_0_managers_run_strategies_strategy_utils__.b)(runService.getCurrentConfig(),userSession);return runService.create(opt,options).then(function(createResponse){return runService.serial([].concat(_this.options.initOperation)).then(function(){return createResponse})}).then(function(createResponse){return runService.save(_this.options.flag).then(function(patchResponse){return $.extend(!0,{},createResponse,patchResponse)})})}},{key:"getRun",value:function(runService,userSession,runSession,options){var _this2=this;var sessionFilter=Object(__WEBPACK_IMPORTED_MODULE_0_managers_run_strategies_strategy_utils__.a)(this.options.flag,userSession,this.options.scope);var runopts=runService.getCurrentConfig();var filter=$.extend(!0,{trashed:!1},sessionFilter,{model:runopts.model});return runService.query(filter,{startrecord:0,endrecord:0,sort:"created",direction:"desc"}).then(function(runs){return runs.length?runs[0]:_this2.reset(runService,userSession,options)})}}]),ReuseLastInitializedStrategy}();__webpack_exports__.a=ReuseLastInitializedStrategy},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function makeFilter(trackingKey,userSession,metaFilter){var runFilter=$.extend(!0,{scope:{trackingKey:trackingKey}},metaFilter);return Object(__WEBPACK_IMPORTED_MODULE_2__strategy_utils__.a)(runFilter,userSession)}function getRunsForFilter(runService,filter){return runService.query(filter,{startRecord:0,endRecord:0,sort:"created",direction:"desc"})}function addSettingsToRun(run,settings){return $.extend(!0,{},run,{settings:settings})}__webpack_require__(8);var __WEBPACK_IMPORTED_MODULE_1_util_run_util__=__webpack_require__(5);var __WEBPACK_IMPORTED_MODULE_2__strategy_utils__=__webpack_require__(7);var __WEBPACK_IMPORTED_MODULE_3_util_index__=__webpack_require__(9);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var errors={RUN_LIMIT_REACHED:"RUN_LIMIT_REACHED",NO_TRACKING_KEY:"NO_TRACKING_KEY"};var ReuseWithTrackingKeyStrategy=function(){function ReuseWithTrackingKeyStrategy(options){_classCallCheck(this,ReuseWithTrackingKeyStrategy);var defaults={settings:{trackingKey:null,runLimit:1/0},filter:{trashed:!1},onCreate:function(runService,settings,run){return run}};var strategyOptions=options?options.strategyOptions:{};this.options=$.extend(!0,{},defaults,strategyOptions)}return _createClass(ReuseWithTrackingKeyStrategy,[{key:"getSettings",value:function(runService,userSession){var settings=Object(__WEBPACK_IMPORTED_MODULE_3_util_index__.e)(this.options.settings,runService,userSession);return Object(__WEBPACK_IMPORTED_MODULE_3_util_index__.b)(settings).then(function(settings){return settings&&settings.trackingKey?settings:Object(__WEBPACK_IMPORTED_MODULE_3_util_index__.c)(errors.NO_TRACKING_KEY,"No tracking key provided to reuse-by-tracking-key strategy")})}},{key:"forceCreateRun",value:function(runService,userSession,settings,runCreateOptions){var _this=this;var runConfig=runService.getCurrentConfig();var trackingKey=settings&&settings.trackingKey;var createOptions=Object(__WEBPACK_IMPORTED_MODULE_2__strategy_utils__.b)(runConfig,userSession);var opt=$.extend(!0,createOptions,{scope:{trackingKey:trackingKey}},runCreateOptions);return runService.create(opt).then(function(run){var applied=_this.options.onCreate(runService,settings,run);return Object(__WEBPACK_IMPORTED_MODULE_3_util_index__.b)(applied).then(function(res){return res&&res.id?res:run}).then(function(run){return addSettingsToRun(run,settings)})})}},{key:"checkIfWithinRunLimit",value:function(runService,userSession,settings){var noRunLimit=settings.runLimit===1/0||""===(""+settings.runLimit).trim();return noRunLimit?Object(__WEBPACK_IMPORTED_MODULE_3_util_index__.d)(settings):getRunsForFilter(runService,makeFilter(settings.trackingKey,userSession,this.options.filter)).then(function(runs,status,xhr){var startedRuns=Object(__WEBPACK_IMPORTED_MODULE_1_util_run_util__.parseContentRange)(xhr.getResponseHeader("content-range"));var runLimit=noRunLimit?1/0:+settings.runLimit;return startedRuns&&startedRuns.total>=runLimit?Object(__WEBPACK_IMPORTED_MODULE_3_util_index__.c)(errors.RUN_LIMIT_REACHED,"You have reached your run limit and cannot create new runs."):settings})}},{key:"reset",value:function(runService,userSession,runCreateOptions){var _this2=this;return this.getSettings(runService,userSession).then(function(settings){return _this2.checkIfWithinRunLimit(runService,userSession,settings)}).then(function(settings){return _this2.forceCreateRun(runService,userSession,settings,runCreateOptions)})}},{key:"getRun",value:function(runService,userSession,runSession,runCreateOptions){var _this3=this;return this.getSettings(runService,userSession).then(function(settings){var runFilter=makeFilter(settings.trackingKey,userSession,_this3.options.filter);return getRunsForFilter(runService,runFilter).then(function(runs){return runs.length?addSettingsToRun(runs[0],settings):_this3.forceCreateRun(runService,userSession,settings,runCreateOptions)})})}}]),ReuseWithTrackingKeyStrategy}();ReuseWithTrackingKeyStrategy.errors=errors,__webpack_exports__.a=ReuseWithTrackingKeyStrategy},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function makeFilter(trackingKey,worldId,userSession,metaFilter){var runFilter=$.extend(!0,{scope:{trackingKey:trackingKey,worldId:worldId}},metaFilter);return Object(__WEBPACK_IMPORTED_MODULE_2__strategy_utils__.a)(runFilter,userSession,{scopeByUser:!1})}function getRunsForFilter(runService,filter){return runService.query(filter,{startRecord:0,endRecord:0,sort:"created",direction:"desc"})}__webpack_require__(8);var __WEBPACK_IMPORTED_MODULE_1_util_run_util__=__webpack_require__(5);var __WEBPACK_IMPORTED_MODULE_2__strategy_utils__=__webpack_require__(7);var __WEBPACK_IMPORTED_MODULE_3_util_index__=__webpack_require__(9);var __WEBPACK_IMPORTED_MODULE_4__multiplayer_strategy__=__webpack_require__(42);var __WEBPACK_IMPORTED_MODULE_5_util_object_util__=__webpack_require__(2);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var errors={RUN_LIMIT_REACHED:"RUN_LIMIT_REACHED",NO_TRACKING_KEY:"NO_TRACKING_KEY"};var MultiplayerWithTrackingKeyStrategy=function(){function MultiplayerWithTrackingKeyStrategy(options){_classCallCheck(this,MultiplayerWithTrackingKeyStrategy);var defaults={settings:{trackingKey:null,runLimit:1/0},filter:{trashed:!1},onCreate:function(runService,settings,run){return run}};var strategyOptions=options?options.strategyOptions:{};this.options=$.extend(!0,{},defaults,strategyOptions)}return _createClass(MultiplayerWithTrackingKeyStrategy,[{key:"getSettings",value:function(runService,userSession){var settings=Object(__WEBPACK_IMPORTED_MODULE_3_util_index__.e)(this.options.settings,runService,userSession);return Object(__WEBPACK_IMPORTED_MODULE_3_util_index__.b)(settings).then(function(settings){return settings&&settings.trackingKey?settings:Object(__WEBPACK_IMPORTED_MODULE_3_util_index__.c)(errors.NO_TRACKING_KEY,"No tracking key provided to reuse-by-tracking-key strategy")})}},{key:"_applySettingsToNewRun",value:function(runService,settings,run){var _this=this;var prom=Object(__WEBPACK_IMPORTED_MODULE_3_util_index__.d)(run);return run.scope&&run.scope.trackingKey===settings.trackingKey||(prom=runService.save({scope:{trackingKey:settings.trackingKey}})),prom.then(function(){var applied=_this.options.onCreate(runService,settings,run);return Object(__WEBPACK_IMPORTED_MODULE_3_util_index__.b)(applied).then(function(res){return res&&res.id?res:run}).then(function(run){return $.extend(!0,{},run,{settings:settings})})})}},{key:"_forceCreateRun",value:function(runService,userSession,settings,runCreateOptions){var _this2=this;var runConfig=Object(__WEBPACK_IMPORTED_MODULE_5_util_object_util__.omit)(runService.getCurrentConfig(),["id","filter"]);var trackingKey=settings&&settings.trackingKey;var scopeConfig=Object(__WEBPACK_IMPORTED_MODULE_2__strategy_utils__.b)(runConfig,userSession);var opt=$.extend(!0,scopeConfig,{scope:{trackingKey:trackingKey}},runCreateOptions);return Object(__WEBPACK_IMPORTED_MODULE_4__multiplayer_strategy__.d)(runService,userSession,opt).then(function(run){return _this2._applySettingsToNewRun(runService,settings,run)})}},{key:"checkIfWithinRunLimit",value:function(runService,userSession,settings){var _this3=this;var noRunLimit=settings.runLimit===1/0||""===(""+settings.runLimit).trim();return noRunLimit?$.Deferred().resolve(settings).promise():Object(__WEBPACK_IMPORTED_MODULE_4__multiplayer_strategy__.b)(runService,userSession).then(function(world){var runFilter=makeFilter(settings.trackingKey,world.id,userSession,_this3.options.filter);return getRunsForFilter(runService,runFilter).then(function(runs,status,xhr){var startedRuns=Object(__WEBPACK_IMPORTED_MODULE_1_util_run_util__.parseContentRange)(xhr.getResponseHeader("content-range"));var runLimit=noRunLimit?1/0:+settings.runLimit;return startedRuns&&startedRuns.total>=runLimit?Object(__WEBPACK_IMPORTED_MODULE_3_util_index__.c)(errors.RUN_LIMIT_REACHED,"You have reached your run limit and cannot create new runs."):settings})})}},{key:"reset",value:function(runService,userSession,runCreateOptions){var _this4=this;return this.getSettings(runService,userSession).then(function(settings){return _this4.checkIfWithinRunLimit(runService,userSession,settings)}).then(function(settings){return _this4._forceCreateRun(runService,userSession,settings,runCreateOptions)})}},{key:"getRun",value:function(runService,userSession,runSession,runCreateOptions){var _this5=this;return this.getSettings(runService,userSession).then(function(settings){var trackingKey=settings.trackingKey;var opt=$.extend(!0,runCreateOptions,{scope:{trackingKey:trackingKey}});return Object(__WEBPACK_IMPORTED_MODULE_4__multiplayer_strategy__.c)(runService,userSession,opt).then(function(run){return run.freshlyCreated?_this5._applySettingsToNewRun(runService,settings,run):(run.scope&&run.scope.trackingKey===trackingKey||console.warn("Existing run has older settings. Reset to apply new settings"),run)})})}}]),MultiplayerWithTrackingKeyStrategy}();MultiplayerWithTrackingKeyStrategy.errors=errors,__webpack_exports__.a=MultiplayerWithTrackingKeyStrategy},function(module,__webpack_exports__,__webpack_require__){"use strict";function buildStrategy(worldId){return function(options){this.options=options,$.extend(this,{reset:function(){throw new Error("not implemented. Need api changes")},getRun:function(runService){var model=this.options.run.model||this.options.model;return worldApi.getCurrentRunId({model:model,filter:worldId}).then(function(runId){return runService.load(runId)})}})}}function WorldManager(options){this.options=options||{run:{},world:{}},$.extend(!0,this.options,this.options.run),$.extend(!0,this.options,this.options.world),worldApi=new __WEBPACK_IMPORTED_MODULE_0_service_world_api_adapter__.default(this.options),this._auth=new __WEBPACK_IMPORTED_MODULE_2_managers_auth_manager__.default;var me=this;var api={getCurrentWorld:function(userId,groupName){var session=this._auth.getCurrentUserSessionInfo();return userId||(userId=session.userId),groupName||(groupName=session.groupName),worldApi.getCurrentWorldForUser(userId,groupName)},getCurrentRun:function(model){var session=this._auth.getCurrentUserSessionInfo();var curUserId=session.userId;var curGroupName=session.groupName;return this.getCurrentWorld(curUserId,curGroupName).then(function(world){if(!world)return $.Deferred().reject({error:"The user is not part of any world!"}).promise();var runOpts=$.extend(!0,me.options,{model:model});var strategy=buildStrategy(world.id);var opt=$.extend(!0,{},{strategy:strategy,run:runOpts});return new __WEBPACK_IMPORTED_MODULE_1_managers_run_manager__.default(opt).getRun().then(function(run){return run.world=world,run})})}};$.extend(this,api)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=WorldManager;var __WEBPACK_IMPORTED_MODULE_0_service_world_api_adapter__=__webpack_require__(11);var __WEBPACK_IMPORTED_MODULE_1_managers_run_manager__=__webpack_require__(22);var __WEBPACK_IMPORTED_MODULE_2_managers_auth_manager__=__webpack_require__(13);var worldApi},function(module,exports,__webpack_require__){var F={util:{},factory:{},transport:{},store:{},service:{},manager:{strategy:{}}};F.load=__webpack_require__(48),window.SKIP_ENV_LOAD||F.load(),F.util.query=__webpack_require__(10),F.util.run=__webpack_require__(5),F.util.classFrom=__webpack_require__(6),F.factory.Transport=__webpack_require__(0).default,F.transport.Ajax=__webpack_require__(25),F.service.URL=__webpack_require__(15),F.service.Config=__webpack_require__(4).default,F.service.Run=__webpack_require__(8).default,F.service.File=__webpack_require__(50),F.service.Variables=__webpack_require__(26).default,F.service.Data=__webpack_require__(17).default,F.service.Auth=__webpack_require__(30).default,F.service.World=__webpack_require__(11).default,F.service.State=__webpack_require__(34).default,F.service.User=__webpack_require__(35).default,F.service.Member=__webpack_require__(18).default,F.service.Asset=__webpack_require__(56).default,F.service.Group=__webpack_require__(31).default,F.service.Introspect=__webpack_require__(27).default,F.service.Presence=__webpack_require__(33).default,F.service.Time=__webpack_require__(36).default,F.service.Timer=__webpack_require__(57).default,F.service.Password=__webpack_require__(63).default,F.service.Account=__webpack_require__(64).default,F.service.Consensus=__webpack_require__(20).default,F.service.ConsensusGroup=__webpack_require__(40).default,F.service.Project=__webpack_require__(65).default,F.store.Cookie=__webpack_require__(29),F.factory.Store=__webpack_require__(28),F.manager.ScenarioManager=__webpack_require__(66).default,F.manager.RunManager=__webpack_require__(22).default,F.manager.User=__webpack_require__(77).default,F.manager.AuthManager=__webpack_require__(13).default,F.manager.WorldManager=__webpack_require__(46).default,F.manager.SavedRunsManager=__webpack_require__(23).default;var strategies=__webpack_require__(41).default;F.manager.strategy=strategies.list,F.manager.Settings=__webpack_require__(78).default,F.manager.ChannelManager=__webpack_require__(19).default,F.service.Channel=__webpack_require__(32).default,F.manager.ConsensusManager=__webpack_require__(80).default,F.version="2.9.2",F.api=__webpack_require__(24),F.constants=__webpack_require__(16),module.exports=F},function(module,exports,__webpack_require__){var URLConfigService=__webpack_require__(15);var envLoad=function(callback){var urlService=new URLConfigService;var infoUrl=urlService.getAPIPath("config");var envPromise=$.ajax({url:infoUrl,async:!1});return envPromise=envPromise.then(function(res){var overrides=res.api;URLConfigService.defaults=$.extend(URLConfigService.defaults,overrides)}),envPromise.then(callback).fail(callback)};module.exports=envLoad},function(module,exports,__webpack_require__){"use strict";var ConfigService=__webpack_require__(4).default;var urlConfig=(new ConfigService).get("server");var customDefaults={};var libDefaults={account:urlConfig.accountPath||void 0,project:urlConfig.projectPath||void 0,isLocal:urlConfig.isLocalhost(),isCustomDomain:urlConfig.isCustomDomain,store:{}};var optionUtils={getOptions:function(options){return $.extend(!0,{},libDefaults,customDefaults,options)},setDefaults:function(defaults){customDefaults=defaults}};module.exports=optionUtils},function(module,exports,__webpack_require__){var ConfigService=__webpack_require__(4).default;var TransportFactory=__webpack_require__(0).default;var SessionManager=__webpack_require__(3);module.exports=function(config){function uploadBody(fileName,contents){var boundary="---------------------------7da24f2e50046";return{body:"--"+boundary+'\r\nContent-Disposition: form-data; name="file";filename="'+fileName+'"\r\nContent-type: text/html\r\n\r\n'+contents+"\r\n--"+boundary+"--",boundary:boundary}}function uploadFileOptions(filePath,contents,options){filePath=filePath.split("/");var fileName=filePath.pop();filePath=filePath.join("/");var path=serviceOptions.folderType+"/"+filePath;var extraParams={};if(contents instanceof FormData)extraParams={data:contents,processData:!1,contentType:!1};else{var upload=uploadBody(fileName,contents);extraParams={data:upload.body,contentType:"multipart/form-data; boundary="+upload.boundary}}return $.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("file")+path},extraParams)}var defaults={token:void 0,account:void 0,project:void 0,folderType:"static",transport:{}};this.sessionManager=new SessionManager;var serviceOptions=this.sessionManager.getMergedOptions(defaults,config);var urlConfig=new ConfigService(serviceOptions).get("server");serviceOptions.account&&(urlConfig.accountPath=serviceOptions.account),serviceOptions.project&&(urlConfig.projectPath=serviceOptions.project);var httpOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getAPIPath("file")});serviceOptions.token&&(httpOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(httpOptions);var publicAsyncAPI={getContents:function(filePath,options){var path=serviceOptions.folderType+"/"+filePath;var httpOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("file")+path});return http.get("",httpOptions)},replace:function(filePath,contents,options){var httpOptions=uploadFileOptions(filePath,contents,options);return http.put(httpOptions.data,httpOptions)},create:function(filePath,contents,replaceExisting,options){var httpOptions=uploadFileOptions(filePath,contents,options);var prom=http.post(httpOptions.data,httpOptions);var me=this;return!0===replaceExisting&&(prom=prom.then(null,function(xhr){if(409===xhr.status)return me.replace(filePath,contents,options)})),prom},remove:function(filePath,options){var path=serviceOptions.folderType+"/"+filePath;var httpOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("file")+path});return http.delete(null,httpOptions)},rename:function(filePath,newName,options){var path=serviceOptions.folderType+"/"+filePath;var httpOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("file")+path});return http.patch({name:newName},httpOptions)}};$.extend(this,publicAsyncAPI)}},function(module,__webpack_exports__,__webpack_require__){"use strict";function addScopeToCollection(key,scope,session){var publicAccessScopes=[SCOPES.CUSTOM];var allowPublicAccess=-1!==publicAccessScopes.indexOf(scope);if(!(session&&session.groupId&&session.userId||allowPublicAccess))throw new __WEBPACK_IMPORTED_MODULE_3_util_index__.a(errors.UNAUTHORIZED,"DataService Authorization error: "+scope+" for "+key+" requires an authenticated user");scope=scope.toUpperCase();if(scope===SCOPES.GROUP)return[key,"group",session.groupId].join("_");if(scope===SCOPES.USER)return[key,"user",session.userId,"group",session.groupId].join("_");if(scope===SCOPES.FACILITATOR){if(!(session.isTeamMember||session.isFac))throw new __WEBPACK_IMPORTED_MODULE_3_util_index__.a(errors.UNAUTHORIZED,"DataService Authorization error: "+scope+" for "+key+" requires a Facilitator user");return[key,"fac","group",session.groupId].join("_")}if(scope===SCOPES.PROJECT)return[key,"project","scope"].join("_");if(scope===SCOPES.CUSTOM)return key;throw new Error("Unknown scope "+scope)}function getScopedName(name,scope,sessionOverride){var am=new __WEBPACK_IMPORTED_MODULE_0_managers_auth_manager__.default;var defaultSession=am.getCurrentUserSessionInfo();var session=$.extend(!0,{},defaultSession,sessionOverride);var split=name.split("/");var collection=split[0];return split[0]=addScopeToCollection(collection,scope,session),split.join("/")}function getURL(API_ENDPOINT,collection,doc,options){var scopedCollection=getScopedName(collection||options.root,options.scope,options);var urlConfig=Object(__WEBPACK_IMPORTED_MODULE_2_service_service_utils__.d)(options);var baseURL=urlConfig.getAPIPath(API_ENDPOINT);var fullURL=baseURL+"/"+scopedCollection+"/"+(doc||"");return Object(__WEBPACK_IMPORTED_MODULE_1_util_query_util__.normalizeSlashes)(fullURL,{leading:!1,trailing:!0})}__webpack_require__.d(__webpack_exports__,"a",function(){return SCOPES}),__webpack_exports__.b=getScopedName,__webpack_exports__.c=getURL;var __WEBPACK_IMPORTED_MODULE_0_managers_auth_manager__=__webpack_require__(13);var __WEBPACK_IMPORTED_MODULE_1_util_query_util__=__webpack_require__(10);var __WEBPACK_IMPORTED_MODULE_2_service_service_utils__=__webpack_require__(1);var __WEBPACK_IMPORTED_MODULE_3_util_index__=__webpack_require__(9);var SCOPES={GROUP:"GROUP",RUN:"RUN",USER:"USER",PROJECT:"PROJECT",FACILITATOR:"FACILITATOR",CUSTOM:"CUSTOM"};var errors={UNAUTHORIZED:"UNAUTHORIZED"}},function(module,exports,__webpack_require__){!function(){function InvalidCharacterError(message){this.message=message}var object=exports;var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";InvalidCharacterError.prototype=new Error,InvalidCharacterError.prototype.name="InvalidCharacterError",object.btoa||(object.btoa=function(input){var str=String(input);for(var block,charCode,idx=0,map=chars,output="";str.charAt(0|idx)||(map="=",idx%1);output+=map.charAt(63&block>>8-idx%1*8)){if((charCode=str.charCodeAt(idx+=.75))>255)throw new InvalidCharacterError("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");block=block<<8|charCode}return output}),object.atob||(object.atob=function(input){var str=String(input).replace(/[=]+$/,"");if(str.length%4==1)throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.");for(var bs,buffer,bc=0,idx=0,output="";buffer=str.charAt(idx++);~buffer&&(bs=bc%4?64*bs+buffer:buffer,bc++%4)?output+=String.fromCharCode(255&bs>>(-2*bc&6)):0)buffer=chars.indexOf(buffer);return output})}()},function(module,__webpack_exports__,__webpack_require__){"use strict";function ChannelManager(options){if(!$.cometd)throw console.error("Cometd library not found. Please include epicenter-multiplayer-dependencies.js"),new Error("Cometd library not found. Please include epicenter-multiplayer-dependencies.js");if(!options||!options.url)throw new Error("Please provide an url for the cometd server");var defaults={url:"",logLevel:"info",websocketEnabled:!0,ackEnabled:!0,shareConnection:!0,channel:{},handshake:void 0};this.sessionManager=new __WEBPACK_IMPORTED_MODULE_1_store_session_manager___default.a;var defaultCometOptions=this.sessionManager.getMergedOptions(defaults,options);if(this.currentSubscriptions=[],this.options=defaultCometOptions,defaultCometOptions.shareConnection&&ChannelManager.prototype._cometd)return this.cometd=ChannelManager.prototype._cometd,this;var cometd=new $.CometD;ChannelManager.prototype._cometd=cometd,cometd.websocketEnabled=defaultCometOptions.websocketEnabled,cometd.ackEnabled=defaultCometOptions.ackEnabled,this.isConnected=!1;var connectionBroken=function(message){$(this).trigger("disconnect",message)};var connectionSucceeded=function(message){$(this).trigger("connect",message)};var me=this;cometd.configure(defaultCometOptions),cometd.addListener("/meta/connect",function(message){var wasConnected=this.isConnected;this.isConnected=!0===message.successful,!wasConnected&&this.isConnected?connectionSucceeded.call(this,message):wasConnected&&!this.isConnected&&connectionBroken.call(this,message)}.bind(this)),cometd.addListener("/meta/disconnect",connectionBroken),cometd.addListener("/meta/handshake",function(message){message.successful&&cometd.batch(function(){$(me.currentSubscriptions).each(function(index,subs){cometd.resubscribe(subs)})})}),cometd.addListener("/meta/subscribe",function(message){$(me).trigger("subscribe",message)}),cometd.addListener("/meta/unsubscribe",function(message){$(me).trigger("unsubscribe",message)}),cometd.addListener("/meta/publish",function(message){$(me).trigger("publish",message)}),cometd.addListener("/meta/unsuccessful",function(message){$(me).trigger("error",message)}),cometd.handshake(defaultCometOptions.handshake),this.cometd=cometd}var __WEBPACK_IMPORTED_MODULE_0_service_channel_service__=__webpack_require__(32);var __WEBPACK_IMPORTED_MODULE_1_store_session_manager__=__webpack_require__(3);var __WEBPACK_IMPORTED_MODULE_1_store_session_manager___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_store_session_manager__);ChannelManager.prototype=$.extend(ChannelManager.prototype,{getChannel:function(options){options&&!$.isPlainObject(options)&&(options={base:options});var defaults={transport:this.cometd};var channel=new __WEBPACK_IMPORTED_MODULE_0_service_channel_service__.default($.extend(!0,{},this.options.channel,defaults,options));var subs=channel.subscribe;channel.subscribe=function(){var subid=subs.apply(channel,arguments);return this.currentSubscriptions=this.currentSubscriptions.concat(subid),subid}.bind(this);var unsubs=channel.unsubscribe;return channel.unsubscribe=function(){var removed=unsubs.apply(channel,arguments);for(var i=0;i<this.currentSubscriptions.length;i++)this.currentSubscriptions[i].id===removed.id&&this.currentSubscriptions.splice(i,1);return removed}.bind(this),channel},on:function(event){$(this).on.apply($(this),arguments)},off:function(event){$(this).off.apply($(this),arguments)},trigger:function(event){$(this).trigger.apply($(this),arguments)}}),__webpack_exports__.a=ChannelManager},function(module,__webpack_exports__,__webpack_require__){"use strict";function subscribeToWorldChannel(worldid,channel,session,channelOptions){var account=channelOptions.account,project=channelOptions.project,baseTopic=channelOptions.baseTopic;channel.TOPICS=__WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.a;var oldsubs=channel.subscribe;return channel.subscribe=function(fullTopic,callback,context,subscribeOptions){if(!fullTopic)return oldsubs.call(channel,fullTopic,callback,context,subscribeOptions);var _fullTopic$split=fullTopic.split("/"),_fullTopic$split2=_slicedToArray(_fullTopic$split,2),subscribedTopic=_fullTopic$split2[0],subscribedSubTopic=_fullTopic$split2[1];var defaults={includeMine:!0};var opts=$.extend({},defaults,subscribeOptions);if(subscribedTopic===__WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.a.PRESENCE){new __WEBPACK_IMPORTED_MODULE_0_service_world_api_adapter__.default({account:account,project:project,filter:worldid}).getPresenceForUsers(worldid).then(function(users){users.filter(function(u){return u.isOnline}).forEach(function(user){var fakeMeta={date:Date.now(),channel:baseTopic,type:__WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.a.PRESENCE,subType:__WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.b.ONLINE,source:"presenceAPI"};var normalizedUser=Object(__WEBPACK_IMPORTED_MODULE_2_util_object_util__.pick)(user,["userName","lastName","isOnline","account"]);normalizedUser.id=user.userId,callback(normalizedUser,fakeMeta)})})}var filterByType=function(res){var _res$data=res.data,type=_res$data.type,subType=_res$data.subType;var isTopicMatch=subscribedTopic===type;var isSubTopicMatch=!subscribedSubTopic||subscribedSubTopic===subType;var notificationFrom=res.data.user||{};var payload=res.data.data;type===__WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.a.RUN&&subType===__WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.b.RESET?payload.run.user&&(notificationFrom=payload.run.user):type!==__WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.a.ROLES||notificationFrom.id||(notificationFrom.id=session.userid);var isMine=session.userId===notificationFrom.id;var isInitiatorMatch=isMine&&opts.includeMine||!isMine;if(isTopicMatch&&isSubTopicMatch&&isInitiatorMatch){var meta={user:notificationFrom,date:res.data.date,channel:res.channel,type:subscribedTopic,subType:subscribedSubTopic||subType};switch(subscribedTopic){case __WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.a.RUN:return subscribedSubTopic===__WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.b.VARIABLES||subscribedSubTopic===__WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.b.OPERATIONS?callback(payload[subType],meta):subscribedSubTopic===__WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.b.RESET?callback(payload.run,meta):callback(payload,meta);case __WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.a.ROLES:return subType===__WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.b.UNASSIGN&&(payload.users=payload.users.map(function(u){return u.oldRole=u.role,u.role=null,u})),callback(payload.users,meta);case __WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.a.PRESENCE:var user=res.data.user;return user.isOnline=subType===__WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.b.ONLINE,callback(user,meta);case __WEBPACK_IMPORTED_MODULE_1__world_channel_constants__.a.CONSENSUS:return callback(payload,meta);default:callback.call(context,res)}}};return oldsubs.call(channel,"",filterByType,context,subscribeOptions)},channel}__webpack_exports__.a=subscribeToWorldChannel;var __WEBPACK_IMPORTED_MODULE_0_service_world_api_adapter__=__webpack_require__(11);var __WEBPACK_IMPORTED_MODULE_1__world_channel_constants__=__webpack_require__(55);var __WEBPACK_IMPORTED_MODULE_2_util_object_util__=__webpack_require__(2);var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=!0;var _d=!1;var _e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",function(){return TOPIC_SUBTYPES}),__webpack_require__.d(__webpack_exports__,"a",function(){return TOPICS});var TOPIC_SUBTYPES={VARIABLES:"variables",OPERATIONS:"operation",RESET:"new",ONLINE:"connect",OFFLINE:"disconnect",ASSIGN:"assign",UNASSIGN:"unassign",CREATE:"create",UPDATE:"update"};var TOPICS={ALL:"",RUN:"run",RUN_VARIABLES:"run/"+TOPIC_SUBTYPES.VARIABLES,RUN_OPERATIONS:"run/"+TOPIC_SUBTYPES.OPERATIONS,RUN_RESET:"run/"+TOPIC_SUBTYPES.RESET,PRESENCE:"user",PRESENCE_ONLINE:"user/"+TOPIC_SUBTYPES.ONLINE,PRESENCE_OFFLINE:"user/"+TOPIC_SUBTYPES.OFFLINE,ROLES:"world",ROLES_ASSIGN:"world/"+TOPIC_SUBTYPES.ASSIGN,ROLES_UNASSIGN:"world/"+TOPIC_SUBTYPES.UNASSIGN,CONSENSUS:"consensus",CONSENSUS_CREATE:"consensus/"+TOPIC_SUBTYPES.CREATE,CONSENSUS_UPDATE:"consensus/"+TOPIC_SUBTYPES.UPDATE}},function(module,__webpack_exports__,__webpack_require__){"use strict";function AssetAdapter(config){var defaults={userId:void 0,scope:"user",fullUrl:!0,token:void 0,account:void 0,project:void 0,group:void 0,transport:{processData:!1}};this.sessionManager=new __WEBPACK_IMPORTED_MODULE_3_store_session_manager___default.a;var serviceOptions=this.sessionManager.getMergedOptions(defaults,config);var urlConfig=new __WEBPACK_IMPORTED_MODULE_0_service_configuration_service__.default(serviceOptions).get("server");serviceOptions.account||(serviceOptions.account=urlConfig.accountPath),serviceOptions.project||(serviceOptions.project=urlConfig.projectPath);var transportOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getAPIPath(apiEndpoint)});serviceOptions.token&&(transportOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__.default(transportOptions);var assetApiParams=["encoding","data","contentType"];var scopeConfig={user:["scope","account","project","group","userId"],group:["scope","account","project","group"],project:["scope","account","project"]};var validateFilename=function(filename){if(!filename)throw new Error("filename is needed.")};var validateUrlParams=function(options){var partKeys=scopeConfig[options.scope];if(!partKeys)throw new Error("scope parameter is needed.");$.each(partKeys,function(){if(!options[this])throw new Error(this+" parameter is needed.")})};var buildUrl=function(filename,options,subEndPoint){validateUrlParams(options);var partKeys=scopeConfig[options.scope];var parts=partKeys.map(function(key){return options[key]});return subEndPoint&&(parts=[subEndPoint].concat(parts)),filename&&(filename="/"+filename),urlConfig.getAPIPath(apiEndpoint)+parts.join("/")+filename};var upload=function(method,filename,params,options){validateFilename(filename),method=method.toLowerCase();var contentType=params instanceof FormData!=!0&&"application/json";"application/json"===contentType?params=Object(__WEBPACK_IMPORTED_MODULE_2_util_object_util__.pick)(params,assetApiParams):filename="post"===method||"put"===method?"":filename;var urlOptions=$.extend({},serviceOptions,options);var url=buildUrl(filename,urlOptions);var createOptions=$.extend(!0,{},urlOptions,{url:url,contentType:contentType});return http[method](params,createOptions)};var publicAPI={create:function(filename,params,options){return upload("post",filename,params,options)},get:function(filename,options){var getServiceOptions=Object(__WEBPACK_IMPORTED_MODULE_2_util_object_util__.pick)(serviceOptions,["scope","account","project","group","userId"]);var urlOptions=$.extend({},getServiceOptions,options);var url=buildUrl(filename,urlOptions);var getOptions=$.extend(!0,{},urlOptions,{url:url});return http.get({},getOptions)},list:function(options){var dtd=$.Deferred();var me=this;var urlOptions=$.extend({},serviceOptions,options);var url=buildUrl("",urlOptions);var getOptions=$.extend(!0,{},urlOptions,{url:url});return getOptions.fullUrl?(http.get({},getOptions).then(function(files){var fullPathFiles=$.map(files,function(file){return buildUrl(file,urlOptions)});dtd.resolveWith(me,[fullPathFiles])}).fail(dtd.reject),dtd.promise()):http.get({},getOptions)},replace:function(filename,params,options){return upload("put",filename,params,options)},getTargetUploadURL:function(filename,params,options){var getServiceOptions=Object(__WEBPACK_IMPORTED_MODULE_2_util_object_util__.pick)(serviceOptions,["scope","account","project","group","userId"]);var urlOptions=$.extend({},getServiceOptions,options);var url=buildUrl(filename,urlOptions,"register");var postOptions=Object.assign({},{ttlSeconds:900},params);var httpOptions=$.extend(!0,{},urlOptions,{url:url});return http.post(postOptions,httpOptions)},delete:function(filename,options){return upload("delete",filename,{},options)},assetUrl:function(filename,options){var urlOptions=$.extend({},serviceOptions,options);return buildUrl(filename,urlOptions)}};$.extend(this,publicAPI)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=AssetAdapter;var __WEBPACK_IMPORTED_MODULE_0_service_configuration_service__=__webpack_require__(4);var __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__=__webpack_require__(0);var __WEBPACK_IMPORTED_MODULE_2_util_object_util__=__webpack_require__(2);var __WEBPACK_IMPORTED_MODULE_3_store_session_manager__=__webpack_require__(3);var __WEBPACK_IMPORTED_MODULE_3_store_session_manager___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_store_session_manager__);var apiEndpoint="asset"},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function getStore(options){return new __WEBPACK_IMPORTED_MODULE_0_service_data_api_service__.default($.extend(!0,{},options,{root:"timer",scope:options.scope}))}function getStateFromActions(actions,currentTime,options){var getStartTime=Object(__WEBPACK_IMPORTED_MODULE_4__start_time_strategies__.b)(options.strategy);var startTime=getStartTime(actions,options.strategyOptions);return Object(__WEBPACK_IMPORTED_MODULE_5__timer_actions_reducer__.a)(actions,startTime,currentTime)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_service_data_api_service__=__webpack_require__(17);var __WEBPACK_IMPORTED_MODULE_1_service_time_api_service__=__webpack_require__(36);var __WEBPACK_IMPORTED_MODULE_2_store_session_manager__=__webpack_require__(3);var __WEBPACK_IMPORTED_MODULE_2_store_session_manager___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_store_session_manager__);var __WEBPACK_IMPORTED_MODULE_3_util_pubsub__=__webpack_require__(37);var __WEBPACK_IMPORTED_MODULE_4__start_time_strategies__=__webpack_require__(59);var __WEBPACK_IMPORTED_MODULE_5__timer_actions_reducer__=__webpack_require__(62);var __WEBPACK_IMPORTED_MODULE_6__timer_constants__=__webpack_require__(21);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var TimerService=function(){function TimerService(options){_classCallCheck(this,TimerService);var defaults={name:"timer",strategy:__WEBPACK_IMPORTED_MODULE_4__start_time_strategies__.a.START_BY_FIRST_USER,strategyOptions:{},account:void 0,project:void 0,token:void 0,transport:{}};this.ACTIONS=__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a,this.options=$.extend(!0,{},defaults,options),this.sessionManager=new __WEBPACK_IMPORTED_MODULE_2_store_session_manager___default.a(this.options),this.channel=new __WEBPACK_IMPORTED_MODULE_3_util_pubsub__.a,this.interval=null,this.dataChannelSubid=null}return _createClass(TimerService,[{key:"create",value:function(createOptions){var _this=this;var options=this.sessionManager.getMergedOptions(this.options,createOptions);if(!options||isNaN(+options.timeLimit))throw new Error("Timer: expected integer timeLimit, received "+options.timeLimit);var ds=getStore(options);var createAction={type:__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.CREATE,timeLimit:options.timeLimit,user:options.user};return(options.startImmediately?this.makeAction(__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.START):$.Deferred().resolve([]).promise()).then(function(actions){return ds.saveAs(options.name,{actions:[].concat(createAction,actions)})}).then(function(doc){var actions=doc.actions;return getStateFromActions(actions,actions[actions.length-1].time,_this.options)})}},{key:"autoStart",value:function(options){var _this2=this;return this.getState().catch(function(){var createOpts=$.extend(!0,{},options,{startImmediately:!0});return _this2.create(createOpts)})}},{key:"cancel",value:function(){var merged=this.sessionManager.getMergedOptions(this.options);var ds=getStore(merged);if(clearInterval(this.interval),this.interval=null,this.dataChannelSubid){ds.getChannel().unsubscribe(this.dataChannelSubid)}return ds.remove(merged.name)}},{key:"makeAction",value:function(action){var merged=this.sessionManager.getMergedOptions(this.options);return this.getCurrentTime().then(function(t){return{type:action,time:t.toISOString(),user:merged.user}})}},{key:"addTimerAction",value:function(action){var _this3=this;var merged=this.sessionManager.getMergedOptions(this.options);var ds=getStore(merged);return this.makeAction(action).then(function(action){return ds.pushToArray(merged.name+"/actions",action).then(function(actions){return getStateFromActions(actions,action.time,_this3.options)},function(res){if(404===res.status){var errorMsg="Timer not found. Did you create it yet?";throw console.error(errorMsg),new Error(errorMsg)}throw res})})}},{key:"start",value:function(){return this.addTimerAction(__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.START)}},{key:"pause",value:function(){return this.addTimerAction(__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.PAUSE)}},{key:"resume",value:function(){return this.addTimerAction(__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.RESUME)}},{key:"getCurrentTime",value:function(){var merged=this.sessionManager.getMergedOptions(this.options);return new __WEBPACK_IMPORTED_MODULE_1_service_time_api_service__.default(merged).getTime()}},{key:"getState",value:function(){var _this4=this;var merged=this.sessionManager.getMergedOptions(this.options);return getStore(merged).load(merged.name).then(function(doc){return _this4.getCurrentTime().then(function(currentTime){var actions=doc.actions;var state=getStateFromActions(actions,currentTime,_this4.options);return $.extend(!0,{},doc,state)})},function(){throw new Error("Timer has not been created yet")})}},{key:"getChannel",value:function(){function cancelTimer(){clearInterval(me.interval),me.interval=null}function createTimer(actions,currentTime){if(!me.interval&&merged.tickInterval){me.interval=setInterval(function(){currentTime+=merged.tickInterval;var state=getStateFromActions(actions,currentTime,me.options);0===state.remaining.time&&(me.channel.publish(__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.COMPLETE,state),dataChannel.unsubscribe(me.dataChannelSubid),cancelTimer()),me.channel.publish(__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.TICK,state)},merged.tickInterval);var state=getStateFromActions(actions,currentTime,me.options);me.channel.publish(__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.TICK,state)}}var merged=this.sessionManager.getMergedOptions(this.options);var ds=getStore(merged);var dataChannel=ds.getChannel();var me=this;return me.dataChannelSubid=dataChannel.subscribe("",function(res,meta){if(-1===meta.dataPath.indexOf("/actions"))if("delete"===meta.subType)me.channel.publish(__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.RESET),cancelTimer();else{var createAction=res.actions[0];me.channel.publish(__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.CREATE,createAction)}else{var actions=res;var lastAction=actions[actions.length-1];if(me.channel.publish(lastAction.type,lastAction),lastAction.type===__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.START||lastAction.type===__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.RESUME)return me.getCurrentTime().then(function(currentTime){createTimer(actions,+currentTime)});lastAction.type===__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.PAUSE&&cancelTimer()}}),me.getState().then(function(state){state.isStarted&&(state.isPaused||state.remaining.time<=0?me.channel.publish(__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a.TICK,state):createTimer(state.actions,state.currentTime))}),this.channel}}]),TimerService}();TimerService.ACTIONS=__WEBPACK_IMPORTED_MODULE_6__timer_constants__.a,TimerService.SCOPES=__WEBPACK_IMPORTED_MODULE_0_service_data_api_service__.default.SCOPES,TimerService.STRATEGY=__WEBPACK_IMPORTED_MODULE_4__start_time_strategies__.a,__webpack_exports__.default=TimerService},function(module,exports){module.exports=jQuery},function(module,__webpack_exports__,__webpack_require__){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function getStrategy(strategy){if("function"==typeof strategy)return strategy;if(list[strategy])return list[strategy];throw new Error("Invalid timer strategy "+strategy)}__webpack_require__.d(__webpack_exports__,"a",function(){return STRATEGIES}),__webpack_exports__.b=getStrategy;var __WEBPACK_IMPORTED_MODULE_0__start_on_first_user__=__webpack_require__(60);var __WEBPACK_IMPORTED_MODULE_1__start_when_all_users__=__webpack_require__(61);var _list;var STRATEGIES={START_BY_FIRST_USER:"first-user",START_WHEN_ALL_USERS:"all-users"};var list=(_list={},_defineProperty(_list,STRATEGIES.START_BY_FIRST_USER,__WEBPACK_IMPORTED_MODULE_0__start_on_first_user__.a),_defineProperty(_list,STRATEGIES.START_WHEN_ALL_USERS,__WEBPACK_IMPORTED_MODULE_1__start_when_all_users__.a),_list)},function(module,__webpack_exports__,__webpack_require__){"use strict";function reduceActions(actions){return Object(__WEBPACK_IMPORTED_MODULE_0__start_when_user_condition__.a)(actions,{condition:function(users){return users.length>0}})}__webpack_exports__.a=reduceActions;var __WEBPACK_IMPORTED_MODULE_0__start_when_user_condition__=__webpack_require__(39)},function(module,__webpack_exports__,__webpack_require__){"use strict";function reduceActions(actions,options){var opts=$.extend({requiredUsernames:[]},options);if(!opts.requiredUsernames.length)throw new Error("This strategy requires passing in requiredUsernames under strategyOptions");return Object(__WEBPACK_IMPORTED_MODULE_0__start_when_user_condition__.a)(actions,{condition:function(joinedUsers){var joinedNames=joinedUsers.map(function(u){return u.userName});return Object(__WEBPACK_IMPORTED_MODULE_1_util_array_utils__.a)(opts.requiredUsernames,joinedNames).length>=opts.requiredUsernames.length}})}__webpack_exports__.a=reduceActions;var __WEBPACK_IMPORTED_MODULE_0__start_when_user_condition__=__webpack_require__(39);var __WEBPACK_IMPORTED_MODULE_1_util_array_utils__=__webpack_require__(38)},function(module,__webpack_exports__,__webpack_require__){"use strict";function toDetailedTime(ts){var time=Math.max(0,ts);var secs=Math.floor(time/1e3);return{time:ts,minutes:Math.floor(secs/60),seconds:Math.floor(secs%60)}}function reduceActions(actions,startTime,currentTime){if(!actions||!actions.length)return{};var initialState={lastPausedTime:0,totalPauseTime:0,elapsedTime:0,timeLimit:0,isPaused:!1,isStarted:!!startTime};var reduced=actions.reduce(function(accum,action){var ts=+new Date(action.time);if(action.type===__WEBPACK_IMPORTED_MODULE_0__timer_constants__.a.CREATE)accum.timeLimit=action.timeLimit;else if(action.type!==__WEBPACK_IMPORTED_MODULE_0__timer_constants__.a.PAUSE||accum.lastPausedTime){if(action.type===__WEBPACK_IMPORTED_MODULE_0__timer_constants__.a.RESUME&&accum.lastPausedTime){var pausedTime=ts-accum.lastPausedTime;accum.totalPauseTime+=pausedTime,accum.lastPausedTime=0,accum.elapsedTime=0,accum.isPaused=!1}}else accum.lastPausedTime=ts,accum.elapsedTime=ts-startTime,accum.isPaused=!0;return accum},initialState);var elapsed=0;var base={};if(currentTime){var current=+new Date(currentTime);base.currentTime=current,reduced.isPaused?elapsed=reduced.elapsedTime:reduced.isStarted&&(elapsed=current-startTime-reduced.totalPauseTime)}var remaining=Math.max(0,reduced.timeLimit-elapsed);return $.extend(!0,{},base,{isPaused:reduced.isPaused,isStarted:reduced.isStarted,elapsed:toDetailedTime(elapsed),remaining:toDetailedTime(remaining)})}__webpack_exports__.a=reduceActions;var __WEBPACK_IMPORTED_MODULE_0__timer_constants__=__webpack_require__(21)},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_store_session_manager__=__webpack_require__(3);var __WEBPACK_IMPORTED_MODULE_0_store_session_manager___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_store_session_manager__);var __WEBPACK_IMPORTED_MODULE_1_util_object_util__=__webpack_require__(2);var __WEBPACK_IMPORTED_MODULE_2_service_service_utils__=__webpack_require__(1);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var PasswordService=function(){function PasswordService(config){_classCallCheck(this,PasswordService);var defaults={account:void 0,project:void 0,transport:{}};this.sessionManager=new __WEBPACK_IMPORTED_MODULE_0_store_session_manager___default.a;var serviceOptions=this.sessionManager.getMergedOptions(defaults,config);this.serviceOptions=serviceOptions}return _createClass(PasswordService,[{key:"resetPassword",value:function(userName,resetParams,options){var mergedOptions=$.extend(!0,{},this.serviceOptions,options);var urlConfig=Object(__WEBPACK_IMPORTED_MODULE_2_service_service_utils__.d)(mergedOptions);var http=Object(__WEBPACK_IMPORTED_MODULE_2_service_service_utils__.c)(mergedOptions.transport,{url:urlConfig.getAPIPath("password/recovery")});if(!userName)throw new Error("resetPassword: missing userName");var defaults=Object(__WEBPACK_IMPORTED_MODULE_1_util_object_util__.pick)(resetParams,["projectFullName","subject","redirectUrl"]);var postParams=$.extend({},{userName:userName,redirectUrl:"",account:urlConfig.accountPath},defaults);if(0!==postParams.redirectUrl.indexOf("http")){var protocol=urlConfig.protocol,actingHost=urlConfig.actingHost,accountPath=urlConfig.accountPath,projectPath=urlConfig.projectPath;var absURL=[actingHost,accountPath,projectPath,postParams.redirectUrl.replace(/^\//,"")].join("/");postParams.redirectUrl=protocol+"://"+absURL}return http.post(postParams)}}]),PasswordService}();__webpack_exports__.default=PasswordService},function(module,__webpack_exports__,__webpack_require__){"use strict";function AccountAPIService(config){function getHTTP(overrides){var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_0_service_service_utils__.b)(defaults,config,{apiEndpoint:API_ENDPOINT},overrides);if(!serviceOptions.account)throw new Error("No account passed to getAccountSettings");return serviceOptions.transport.url+=serviceOptions.account,new __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__.default(serviceOptions.transport)}var defaults={account:void 0,transport:{}};return{getAccountSettings:function(options){return getHTTP(options).get()}}}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=AccountAPIService;var __WEBPACK_IMPORTED_MODULE_0_service_service_utils__=__webpack_require__(1);var __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__=__webpack_require__(0);var API_ENDPOINT="account"},function(module,__webpack_exports__,__webpack_require__){"use strict";function ProjectAPIService(config){function getHTTP(overrides){var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_0_service_service_utils__.b)(defaults,config,{apiEndpoint:API_ENDPOINT},overrides);return new __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__.default(serviceOptions.transport)}var defaults={account:void 0,project:void 0,transport:{}};return{getProjectSettings:function(options){return getHTTP(options).get()},updateProjectSettings:function(settings,options){return getHTTP(options).patch(settings)},getMultiplayerSettings:function(options){return getHTTP($.extend({},options,{apiEndpoint:MULTIPLAYER_ENDPOINT})).get()},updateMultiplayerSettings:function(settings,options,serviceOverrides){var overrides=$.extend({},serviceOverrides,{apiEndpoint:MULTIPLAYER_ENDPOINT});var http=getHTTP(overrides);return options&&options.autoCreate?http.put(settings):http.patch(settings)}}}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.default=ProjectAPIService;var __WEBPACK_IMPORTED_MODULE_0_service_service_utils__=__webpack_require__(1);var __WEBPACK_IMPORTED_MODULE_1_transport_http_transport_factory__=__webpack_require__(0);var API_ENDPOINT="project";var MULTIPLAYER_ENDPOINT="multiplayer/project"},function(module,__webpack_exports__,__webpack_require__){"use strict";function cookieNameFromOptions(prefix,config){return["account","project","model"].reduce(function(accum,key){return config[key]?accum+"-"+config[key]:accum},prefix)}function ScenarioManager(config){function scopeFromConfig(config){return{scope:{trackingKey:config.scope&&config.scope.trackingKey?config.scope.trackingKey+"-current":"current"}}}var defaults={advanceOperation:[{name:"stepTo",params:["end"]}],run:{},includeBaseLine:!0,baseline:{runName:"Baseline",run:{}},current:{run:{}},savedRuns:{}};var opts=$.extend(!0,{},defaults,config);config&&config.advanceOperation&&(opts.advanceOperation=config.advanceOperation);var BaselineStrategyToUse=opts.includeBaseLine?__WEBPACK_IMPORTED_MODULE_7__scenario_strategies_baseline_strategy__.a:__WEBPACK_IMPORTED_MODULE_4_managers_run_strategies_none_strategy__.default;this.baseline=new __WEBPACK_IMPORTED_MODULE_0_managers_run_manager__.default({strategy:BaselineStrategyToUse,sessionKey:cookieNameFromOptions.bind(null,"sm-baseline-run"),run:Object(__WEBPACK_IMPORTED_MODULE_2_managers_run_strategies_strategy_utils__.c)(opts.run,opts.baseline.run),strategyOptions:{baselineName:opts.baseline.runName,initOperation:opts.advanceOperation,scope:opts.baseline.scope}}),this.savedRuns=new __WEBPACK_IMPORTED_MODULE_1_managers_saved_runs_manager__.default($.extend(!0,{},{run:opts.run},opts.savedRuns));var origGetRuns=this.savedRuns.getRuns;var me=this;this.savedRuns.getRuns=function(){var args=Array.apply(null,arguments);return me.baseline.getRun().then(function(){return origGetRuns.apply(me.savedRuns,args)})};var mergedCurrentRunOptions=Object(__WEBPACK_IMPORTED_MODULE_2_managers_run_strategies_strategy_utils__.c)(opts.run,opts.current.run);if(mergedCurrentRunOptions instanceof __WEBPACK_IMPORTED_MODULE_6_service_run_api_service__.default){var _config=mergedCurrentRunOptions.getCurrentConfig();mergedCurrentRunOptions.updateConfig(scopeFromConfig(_config))}else $.extend(!0,mergedCurrentRunOptions,scopeFromConfig(mergedCurrentRunOptions));this.current=new __WEBPACK_IMPORTED_MODULE_0_managers_run_manager__.default({strategy:__WEBPACK_IMPORTED_MODULE_8__scenario_strategies_reuse_last_unsaved__.a,sessionKey:cookieNameFromOptions.bind(null,"sm-current-run"),run:mergedCurrentRunOptions}),this.current.saveAndAdvance=function(metadata){function clone(run){var sa=new __WEBPACK_IMPORTED_MODULE_5_service_state_api_adapter__.default(mergedCurrentRunOptions);var advanceOpns=Object(__WEBPACK_IMPORTED_MODULE_3_util_run_util__.normalizeOperations)(opts.advanceOperation);return sa.clone({runId:run.id,exclude:advanceOpns.ops}).then(function(response){return new __WEBPACK_IMPORTED_MODULE_6_service_run_api_service__.default(me.current.run.getCurrentConfig()).load(response.run)})}function markSaved(run){return me.savedRuns.save(run.id,metadata).then(function(savedResponse){return $.extend(!0,{},run,savedResponse)})}function advance(run){return new __WEBPACK_IMPORTED_MODULE_6_service_run_api_service__.default($.extend(!0,{},mergedCurrentRunOptions,run)).serial(opts.advanceOperation).then(function(){return run})}return me.current.getRun().then(clone).then(advance).then(markSaved)}}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_managers_run_manager__=__webpack_require__(22);var __WEBPACK_IMPORTED_MODULE_1_managers_saved_runs_manager__=__webpack_require__(23);var __WEBPACK_IMPORTED_MODULE_2_managers_run_strategies_strategy_utils__=__webpack_require__(7);var __WEBPACK_IMPORTED_MODULE_3_util_run_util__=__webpack_require__(5);var __WEBPACK_IMPORTED_MODULE_4_managers_run_strategies_none_strategy__=__webpack_require__(14);var __WEBPACK_IMPORTED_MODULE_5_service_state_api_adapter__=__webpack_require__(34);var __WEBPACK_IMPORTED_MODULE_6_service_run_api_service__=__webpack_require__(8);var __WEBPACK_IMPORTED_MODULE_7__scenario_strategies_baseline_strategy__=__webpack_require__(75);var __WEBPACK_IMPORTED_MODULE_8__scenario_strategies_reuse_last_unsaved__=__webpack_require__(76);__webpack_exports__.default=ScenarioManager},function(module,exports,__webpack_require__){"use strict";var classFrom=__webpack_require__(6);var ConditionalStrategy=__webpack_require__(12);var __super=ConditionalStrategy.prototype;var Strategy=classFrom(ConditionalStrategy,{constructor:function(options){__super.constructor.call(this,this.createIf,options),console.warn("This strategy is deprecated; all runs now default to being initialized by default making this redundant. Consider using `reuse-last-initialized` instead.")},createIf:function(run,headers){return"persistent"===headers.getResponseHeader("pragma")||run.initialized}});module.exports=Strategy},function(module,exports,__webpack_require__){"use strict";var classFrom=__webpack_require__(6);var ConditionalStrategy=__webpack_require__(12);var __super=ConditionalStrategy.prototype;var Strategy=classFrom(ConditionalStrategy,{constructor:function(options){__super.constructor.call(this,this.createIf,options),console.warn("This strategy is deprecated; the run-service now sets a header to automatically bring back runs into memory")},createIf:function(run,headers){return"persistent"===headers.getResponseHeader("pragma")}});module.exports=Strategy},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__util_inherit__=__webpack_require__(6);var __WEBPACK_IMPORTED_MODULE_0__util_inherit___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__util_inherit__);var __WEBPACK_IMPORTED_MODULE_1__conditional_creation_strategy__=__webpack_require__(12);var __WEBPACK_IMPORTED_MODULE_1__conditional_creation_strategy___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__conditional_creation_strategy__);var __super=__WEBPACK_IMPORTED_MODULE_1__conditional_creation_strategy___default.a.prototype;var Strategy=__WEBPACK_IMPORTED_MODULE_0__util_inherit___default()(__WEBPACK_IMPORTED_MODULE_1__conditional_creation_strategy___default.a,{constructor:function(options){__super.constructor.call(this,this.createIf,options)},createIf:function(run,headers){return!0}});Strategy.allowRunIDCache=!1,__webpack_exports__.a=Strategy},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__util_inherit__=__webpack_require__(6);var __WEBPACK_IMPORTED_MODULE_0__util_inherit___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__util_inherit__);var __WEBPACK_IMPORTED_MODULE_1__conditional_creation_strategy__=__webpack_require__(12);var __WEBPACK_IMPORTED_MODULE_1__conditional_creation_strategy___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__conditional_creation_strategy__);var __super=__WEBPACK_IMPORTED_MODULE_1__conditional_creation_strategy___default.a.prototype;var Strategy=__WEBPACK_IMPORTED_MODULE_0__util_inherit___default()(__WEBPACK_IMPORTED_MODULE_1__conditional_creation_strategy___default.a,{constructor:function(options){__super.constructor.call(this,this.createIf,options)},createIf:function(run,headers){return!1}});__webpack_exports__.a=Strategy},function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_util_inherit__=__webpack_require__(6);var __WEBPACK_IMPORTED_MODULE_0_util_inherit___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_util_inherit__);var __WEBPACK_IMPORTED_MODULE_1__none_strategy__=__webpack_require__(14);var __WEBPACK_IMPORTED_MODULE_2_managers_run_strategies_strategy_utils__=__webpack_require__(7);var Strategy=__WEBPACK_IMPORTED_MODULE_0_util_inherit___default()(__WEBPACK_IMPORTED_MODULE_1__none_strategy__.default,{constructor:function(options){var defaults={filter:{}};var strategyOptions=options?options.strategyOptions:{};this.options=$.extend(!0,{},defaults,strategyOptions)},reset:function(runService,userSession,options){var opt=Object(__WEBPACK_IMPORTED_MODULE_2_managers_run_strategies_strategy_utils__.b)(runService.getCurrentConfig(),userSession);return runService.create(opt,options).then(function(run){return run.freshlyCreated=!0,run})},getRun:function(runService,userSession,runSession,options){var _this=this;var filter=Object(__WEBPACK_IMPORTED_MODULE_2_managers_run_strategies_strategy_utils__.a)(this.options.filter,userSession);return runService.query(filter,{startrecord:0,endrecord:0,sort:"created",direction:"desc"}).then(function(runs){return runs.length?runs[0]:_this.reset(runService,userSession,options)})}});__webpack_exports__.a=Strategy},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var UseSpecificRun=function(){function UseSpecificRun(options){_classCallCheck(this,UseSpecificRun);var defaults={runId:null};var strategyOptions=options?options.strategyOptions:{};if(this.options=$.extend(!0,{},defaults,strategyOptions),!this.options.runId)throw new Error('Missing required parameter `runId`: Specifying an runId is required for "Use Run" strategy')}return _createClass(UseSpecificRun,[{key:"reset",value:function(runService,userSession,options){throw new Error('"Use Run" strategy does not support reset')}},{key:"getRun",value:function(runService,userSession,runSession,options){return runService.load(this.options.runId)}}]),UseSpecificRun}();__webpack_exports__.a=UseSpecificRun},function(module,__webpack_exports__,__webpack_require__){"use strict";function reset(params,options,manager){return manager.reset(options)}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.reset=reset},function(module,__webpack_exports__,__webpack_require__){"use strict";function bulkFetchRecords(fetchFn,options){function getRecords(fetchFn,options,recordsFoundSoFar){var endRecord=Math.min(options.startRecord+options.recordsPerFetch,options.endRecord);return fetchFn(options.startRecord,endRecord).then(function(currentRecords,status,xhr){var allFound=(recordsFoundSoFar||[]).concat(currentRecords);var recordsLeft=ops.contentRangeParser(allFound,xhr);options.onData(currentRecords,recordsLeft);var recordsNeeded=recordsLeft&&Math.min(recordsLeft.total,ops.endRecord-ops.startRecord);if(recordsLeft&&recordsNeeded>recordsLeft.end+1){var nextFetchOptions=$.extend({},options,{startRecord:recordsLeft.end+1});return getRecords(fetchFn,nextFetchOptions,allFound)}return $.Deferred().resolve(allFound,status,xhr).promise()})}var ops=$.extend({},{startRecord:0,endRecord:1/0,recordsPerFetch:100,contentRangeParser:function(currentRecords,xhr){return xhr&&Object(__WEBPACK_IMPORTED_MODULE_0_util_run_util__.parseContentRange)(xhr.getResponseHeader("content-range"))},onData:function(){}},options);return getRecords(fetchFn,ops)}__webpack_exports__.a=bulkFetchRecords;var __WEBPACK_IMPORTED_MODULE_0_util_run_util__=__webpack_require__(5)},function(module,__webpack_exports__,__webpack_require__){"use strict";function BaselineStrategy(options){var defaults={baselineName:"Baseline",initOperation:[{stepTo:"end"}]};var strategyOptions=options?options.strategyOptions:{};var opts=$.extend({},defaults,strategyOptions);var reuseStrategyOptions={initOperation:opts.initOperation,flag:{saved:!0,trashed:!1,isBaseline:!0,name:opts.baselineName},scope:opts.scope};return new __WEBPACK_IMPORTED_MODULE_0_managers_run_strategies_reuse_last_initialized__.a({strategyOptions:reuseStrategyOptions})}__webpack_exports__.a=BaselineStrategy;var __WEBPACK_IMPORTED_MODULE_0_managers_run_strategies_reuse_last_initialized__=__webpack_require__(43)},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var __WEBPACK_IMPORTED_MODULE_0_managers_run_strategies_strategy_utils__=__webpack_require__(7);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var ReuseLastUnsaved=function(){function ReuseLastUnsaved(options){_classCallCheck(this,ReuseLastUnsaved);var strategyOptions=options?options.strategyOptions:{};this.options=strategyOptions}return _createClass(ReuseLastUnsaved,[{key:"reset",value:function(runService,userSession,options){var runConfig=runService.getCurrentConfig();var scoped=Object(__WEBPACK_IMPORTED_MODULE_0_managers_run_strategies_strategy_utils__.b)(runConfig,userSession);var opt=$.extend(!0,{},scoped);return runService.create(opt,options).then(function(createResponse){return $.extend(!0,{},createResponse,{freshlyCreated:!0})})}},{key:"getRun",value:function(runService,userSession,opts){var runConfig=runService.getCurrentConfig();var filter=Object(__WEBPACK_IMPORTED_MODULE_0_managers_run_strategies_strategy_utils__.a)({trashed:!1,saved:!1,model:runConfig.model},userSession);var me=this;var outputModifiers={startrecord:0,endrecord:0,sort:"created",direction:"desc"};return runService.query(filter,outputModifiers).then(function(runs){return runs.length?runs[0]:me.reset(runService,userSession)})}}]),ReuseLastUnsaved}();ReuseLastUnsaved.requiresAuth=!1,__webpack_exports__.a=ReuseLastUnsaved},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function parseUsers(userList){var expectedCols=[{label:"Email",value:"userName"},{label:"First Name",value:"firstName"},{label:"Last Name",value:"lastName"},{label:"Password",value:"password"}];return userList.split(/\r\r|\r|\n/).reduce(function(accum,row,index){var splitter=row&&/\t/.test(row)?/\t/:",";var rowContents=row.split(splitter);if(!rowContents.length)return accum;var missingFields=expectedCols.filter(function(col,index){return void 0===rowContents[index]||!rowContents[index].trim()});if(missingFields.length){var missingLabels=missingFields.map(function(f){return f.label});return accum.invalid.push({userName:rowContents[0]||"Line "+(index+1),message:"Missing "+missingLabels.join(", "),reason:"MISSING_FIELDS",context:{missingFields:missingLabels}}),accum}var user=expectedCols.reduce(function(accum,col,index){var val=rowContents[index].trim();return accum[col.value]=val,accum},{});return accum.valid.push(user),accum},{valid:[],invalid:[]})}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_exports__.parseUsers=parseUsers;var __WEBPACK_IMPORTED_MODULE_0_service_user_api_adapter__=__webpack_require__(35);var __WEBPACK_IMPORTED_MODULE_1_service_member_api_adapter__=__webpack_require__(18);var __WEBPACK_IMPORTED_MODULE_2_managers_auth_manager__=__webpack_require__(13);var __WEBPACK_IMPORTED_MODULE_3_service_service_utils__=__webpack_require__(1);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var ERROR_TYPES={EMPTY_USERS:"EMPTY_USERS",NO_GROUP_PROVIDED:"NO_GROUP_PROVIDED",API_REJECT:"API_REJECT",GROUP_LIMIT_EXCEEDED:"GROUP_LIMIT_EXCEEDED"};var UserManager=function(){function UserManager(config){_classCallCheck(this,UserManager);var defaults={account:void 0};var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_3_service_service_utils__.b)(defaults,config);this.serviceOptions=serviceOptions}return _createClass(UserManager,[{key:"uploadUsersToGroup",value:function(userList,groupId,options){if(!userList||!userList.trim())return $.Deferred().reject({type:ERROR_TYPES.EMPTY_USERS,message:"uploadUsersToGroup: No users specified to upload."}).promise();var serviceOptions=Object(__WEBPACK_IMPORTED_MODULE_3_service_service_utils__.b)(this.serviceOptions,options);if(!groupId){var am=new __WEBPACK_IMPORTED_MODULE_2_managers_auth_manager__.default(serviceOptions);var session=am.getCurrentUserSessionInfo();if(!(groupId=session.groupId))return $.Deferred().reject({type:ERROR_TYPES.NO_GROUP_PROVIDED,message:"uploadUsersToGroup: No group specified, and no session available to pick from."}).promise()}var usersToAdd=parseUsers(userList.trim());if(!usersToAdd.valid.length)return $.Deferred().resolve({errors:usersToAdd.invalid,created:[],duplicates:[]}).promise();var userService=new __WEBPACK_IMPORTED_MODULE_0_service_user_api_adapter__.default(serviceOptions);var memberService=new __WEBPACK_IMPORTED_MODULE_1_service_member_api_adapter__.default(serviceOptions);return userService.createUsers(usersToAdd.valid).then(function(userRes){var validUsers=[].concat(userRes.saved,userRes.updated,userRes.duplicate);var validIds=validUsers.map(function(u){return u.id});var userWithErrors=userRes.errors.map(function(e){return $.extend(!0,e,{reason:ERROR_TYPES.API_REJECT,context:e})});return userRes.errors=[].concat(userWithErrors,usersToAdd.invalid),memberService.addUsersToGroup(validIds,groupId).then(function(){return userRes},function(memberXHR){function excludingSkipped(users,skipped){return users.filter(function(u){return!skipped.find(function(su){return su.userName===u.userName})})}var memberErr=memberXHR.responseJSON;var isGroupLimitErr=memberErr&&memberErr.message&&memberErr.message.match(/exceeded your group limit\(([0-9]+)\)/i);if(!isGroupLimitErr)throw memberErr;var groupLimit=+isGroupLimitErr[1];var skippedUsers=validUsers.slice(groupLimit).map(function(u){return $.extend({},u,{reason:ERROR_TYPES.GROUP_LIMIT_EXCEEDED,message:"Exceeded group limit"})});return{errors:[].concat(userRes.errors,skippedUsers),saved:excludingSkipped(userRes.saved,skippedUsers),updated:excludingSkipped(userRes.updated,skippedUsers),duplicate:excludingSkipped(userRes.duplicate,skippedUsers)}})}).then(function(res){return{errors:res.errors,duplicates:res.duplicate,created:[].concat(res.saved,res.updated)}})}}]),UserManager}();UserManager.errors=ERROR_TYPES,__webpack_exports__.default=UserManager},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_managers_saved_runs_manager__=__webpack_require__(23);var __WEBPACK_IMPORTED_MODULE_1__settings_service__=__webpack_require__(79);var __WEBPACK_IMPORTED_MODULE_2_managers_run_strategies_reuse_by_tracking_key__=__webpack_require__(44);var __WEBPACK_IMPORTED_MODULE_3_managers_run_strategies_multiplayer_with_tracking_key__=__webpack_require__(45);var __WEBPACK_IMPORTED_MODULE_4_util_pubsub__=__webpack_require__(37);var __WEBPACK_IMPORTED_MODULE_5_util_object_util__=__webpack_require__(2);var __WEBPACK_IMPORTED_MODULE_6_util_index__=__webpack_require__(9);var __WEBPACK_IMPORTED_MODULE_7_service_world_api_adapter__=__webpack_require__(11);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var actions={SETTINGS_DELETED:"SETTINGS_DELETED",SETTINGS_ACTIVATED:"SETTINGS_ACTIVATED",DRAFT_CREATED:"DRAFT_CREATED",DRAFT_UPDATED:"DRAFT_UPDATED"};var SettingsManager=function(){function SettingsManager(options){_classCallCheck(this,SettingsManager);var defaultSettings={run:{},settings:{collection:"settings",defaults:{}},multiplayer:!1,interruptRunsInProgress:!0};if(this.options=$.extend(!0,{},defaultSettings,options),this.settings=new __WEBPACK_IMPORTED_MODULE_1__settings_service__.a(this.options),this.channel=new __WEBPACK_IMPORTED_MODULE_4_util_pubsub__.a,this.state={subscription:null},this.options.interruptRunsInProgress&&this.options.multiplayer){var defaultSaveAndActivate=this.settings.saveAndActivate;this.settings.saveAndActivate=function(){var _this=this;var originalArgs=Array.prototype.slice.call(arguments);var ws=new __WEBPACK_IMPORTED_MODULE_7_service_world_api_adapter__.default(this.options.run);return ws.list().then(function(worlds){var deletionPromises=worlds.map(function(world){return ws.deleteRun(world.id)});return $.when.apply(null,deletionPromises).then(function(){return defaultSaveAndActivate.apply(_this.settings,originalArgs)})})}.bind(this)}}return _createClass(SettingsManager,[{key:"getChannel",value:function(){var _this2=this;if(this.state.subscription)return this.channel;var rawDataChannel=this.settings.ds.getChannel();return this.state.subscription=rawDataChannel.subscribe("",function(res,meta){"delete"===meta.subType?_this2.channel.publish(actions.SETTINGS_DELETED,meta):"new"===meta.subType?_this2.channel.publish(actions.DRAFT_CREATED,res):"update"===meta.subType?res.isDraft?_this2.channel.publish(actions.DRAFT_UPDATED,res):_this2.channel.publish(actions.SETTINGS_ACTIVATED,res):console.warn("getChannel: Unknown subtype",res,meta)}),this.channel}},{key:"getUserRunStrategy",value:function(options){var _this3=this;var defaults={allowCreateRun:function(){return!0},applySettings:function(){}};var opts=$.extend({},defaults,options);return new(this.options.multiplayer?__WEBPACK_IMPORTED_MODULE_3_managers_run_strategies_multiplayer_with_tracking_key__.a:__WEBPACK_IMPORTED_MODULE_2_managers_run_strategies_reuse_by_tracking_key__.a)({strategyOptions:{settings:function(){return _this3.settings.getCurrentActive().then(function(settings){return opts.allowCreateRun(settings)?settings||_this3.settings.getDefaults():Object(__WEBPACK_IMPORTED_MODULE_6_util_index__.c)("RUN_CREATION_NOT_ALLOWED","allowCreateRun check failed")}).then(function(settings){var cleanedSettings=Object(__WEBPACK_IMPORTED_MODULE_5_util_object_util__.omit)(settings,["id","lastModified","isDraft","key"]);return $.extend(!0,{},cleanedSettings,{trackingKey:settings.id||"defaultSettings"})})},onCreate:opts.applySettings}})}},{key:"getSavedRunsManagerForSetting",value:function(settingsId){var runOptions=$.extend(!0,{},this.options.run,{scope:{trackingKey:settingsId}});return new __WEBPACK_IMPORTED_MODULE_0_managers_saved_runs_manager__.default({run:runOptions,scopeByUser:!1})}},{key:"getRuns",value:function(savedRunManagerParams){var _this4=this,_arguments=arguments;return this.settings.getCurrentActive().then(function(settings){if(!settings)return[];var sm=_this4.getSavedRunsManagerForSetting(settings.id);return sm.getRuns.apply(sm,_arguments).then(function(runs){return(runs||[]).map(function(run){return $.extend(!0,run,{settings:settings})})})})}}]),SettingsManager}();SettingsManager.actions=actions,__webpack_exports__.default=SettingsManager},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function sanitize(obj){return Object(__WEBPACK_IMPORTED_MODULE_2_util_object_util__.omit)(obj,["id","lastModified"])}var __WEBPACK_IMPORTED_MODULE_0_service_data_api_service__=__webpack_require__(17);var __WEBPACK_IMPORTED_MODULE_1_util_index__=__webpack_require__(9);var __WEBPACK_IMPORTED_MODULE_2_util_object_util__=__webpack_require__(2);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var SettingsService=function(){function SettingsService(opts){_classCallCheck(this,SettingsService);var defaults={run:{},settings:{collection:"settings",defaults:{}}};this.options=$.extend(!0,{},defaults,opts);var serviceOptions=$.extend(!0,{},this.options.run,{root:this.options.settings.collection,scope:__WEBPACK_IMPORTED_MODULE_0_service_data_api_service__.default.SCOPES.GROUP});this.ds=new __WEBPACK_IMPORTED_MODULE_0_service_data_api_service__.default(serviceOptions),this.state={currentDraft:null}}return _createClass(SettingsService,[{key:"_updateDraftOrCreate",value:function(settings,meta){function getLastDraft(){var _this=this;return this.state.currentDraft?$.Deferred().resolve(this.state.currentDraft).promise():this.getAll().then(function(settingsList){var lastSettings=settingsList[0]||{};return lastSettings.isDraft?lastSettings:_this.ds.save({})})}var _this2=this;return getLastDraft.call(this).then(function(draft){var newSettings=$.extend(!0,{},draft,settings,meta);return _this2.ds.saveAs(draft.id,sanitize(newSettings))}).then(function(d){return _this2.state.currentDraft=d.isDraft?d:null,d})}},{key:"getDefaults",value:function(){return Object(__WEBPACK_IMPORTED_MODULE_1_util_index__.b)(Object(__WEBPACK_IMPORTED_MODULE_1_util_index__.e)(this.options.settings.defaults))}},{key:"getAll",value:function(options){return this.ds.load("",{sort:"key",direction:"desc"}).then(function(settingHistory){var sorted=settingHistory.sort(function(a,b){return a.key>b.key?-1:1});return options&&options.excludeDrafts?sorted.filter(function(s){return!1===s.isDraft}):sorted})}},{key:"getCurrentActive",value:function(){return this.getAll({excludeDrafts:!0}).then(function(activeSettings){return activeSettings[0]})}},{key:"getMostRecent",value:function(){var _this3=this;return this.getAll().then(function(settingsList){var lastSettings=settingsList[0];return lastSettings||_this3.createDraft({useDefaults:!0})})}},{key:"createDraft",value:function(options){function getSettings(options){var _this4=this;return options.useDefaults?this.getDefaults():this.getAll().then(function(settingsList){return settingsList[0]||_this4.getDefaults()})}var _this5=this;return getSettings.call(this,options||{}).then(function(defaults){var newSettings=$.extend(!0,{},defaults,{isDraft:!0,key:Date.now()});return _this5.ds.save(sanitize(newSettings))}).then(function(d){return _this5.state.currentDraft=d,d})}},{key:"resetDraft",value:function(){return this.createDraft({useDefaults:!0})}},{key:"updateDraft",value:function(settings){return this._updateDraftOrCreate(settings)}},{key:"updateActive",value:function(newSettings){var _this6=this;return this.getCurrentActive().then(function(settings){if(!settings)throw new Error("No active settings found");var toSave=sanitize($.extend(!0,{},settings,newSettings));return _this6.ds.saveAs(settings.id,toSave)})}},{key:"saveAndActivate",value:function(settings){return this._updateDraftOrCreate(settings,{isDraft:!1,key:Date.now()})}}]),SettingsService}();__webpack_exports__.a=SettingsService},function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function getCurrentWorldIdAndRoles(opts){if(opts.id&&opts.roles)return $.Deferred().resolve({id:opts.id,roles:opts.roles}).promise();if(opts.worldId){return(new __WEBPACK_IMPORTED_MODULE_1_service_world_api_adapter__.default).load(opts.worldId)}return new __WEBPACK_IMPORTED_MODULE_0_managers_world_manager__.default(opts).getCurrentWorld()}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_managers_world_manager__=__webpack_require__(46);var __WEBPACK_IMPORTED_MODULE_1_service_world_api_adapter__=__webpack_require__(11);var __WEBPACK_IMPORTED_MODULE_2_service_consensus_api_service_consensus_group_service__=__webpack_require__(40);var __WEBPACK_IMPORTED_MODULE_3__strategies_mandatory_consensus_strategy__=__webpack_require__(81);var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();var ConsensusManager=function(){function ConsensusManager(config){_classCallCheck(this,ConsensusManager);var opts={name:"default",strategy:"",strategyOptions:{}};this.serviceOptions=$.extend(!0,{},opts,config)}return _createClass(ConsensusManager,[{key:"getCurrent",value:function(){var _this=this;return getCurrentWorldIdAndRoles(this.serviceOptions).then(function(world){var cg=new __WEBPACK_IMPORTED_MODULE_2_service_consensus_api_service_consensus_group_service__.default($.extend({},_this.serviceOptions,{worldId:world.id}));return Object(__WEBPACK_IMPORTED_MODULE_3__strategies_mandatory_consensus_strategy__.a)(cg,{roles:world.roles})})}}]),ConsensusManager}();__webpack_exports__.default=ConsensusManager},function(module,__webpack_exports__,__webpack_require__){"use strict";function mandatoryConsensusStrategy(consensusGroup,strategyOptions){var options=$.extend({},{maxRounds:1/0,name:function(list){return"round-"+(list.length+1)}},strategyOptions);return consensusGroup.list().then(function(consensusList){var lastConsensus=consensusList[consensusList.length-1];var isLastPending=lastConsensus&&!lastConsensus.closed;var allowCreateNew=options.maxRounds>=consensusList.length;if(isLastPending||!allowCreateNew)return lastConsensus;var name=options.name(consensusList);return consensusGroup.consensus(name).create({roles:options.roles,executeActionsImmediately:!1})})}__webpack_exports__.a=mandatoryConsensusStrategy}]);
//# sourceMappingURL=epicenter.min.js.map