(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function init(){var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function toByteArray(b64){var i,j,l,tmp,placeHolders,arr;var len=b64.length;if(len%4>0)throw new Error("Invalid string. Length must be a multiple of 4");placeHolders="="===b64[len-2]?2:"="===b64[len-1]?1:0,arr=new Arr(3*len/4-placeHolders),l=placeHolders>0?len-4:len;var L=0;for(i=0,j=0;i<l;i+=4,j+=3)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[L++]=tmp>>16&255,arr[L++]=tmp>>8&255,arr[L++]=255&tmp;return 2===placeHolders?(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[L++]=255&tmp):1===placeHolders&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[L++]=tmp>>8&255,arr[L++]=255&tmp),arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3)tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output.push(tripletToBase64(tmp));return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength)parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength));return 1===extraBytes?(tmp=uint8[len-1],output+=lookup[tmp>>2],output+=lookup[tmp<<4&63],output+="=="):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],output+=lookup[tmp>>10],output+=lookup[tmp>>4&63],output+=lookup[tmp<<2&63],output+="="),parts.push(output),parts.join("")}exports.toByteArray=toByteArray,exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array;init();
},{}],2:[function(require,module,exports){
(function (global){
"use strict";function typedArraySupport(){try{var arr=new Uint8Array(1);return arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===arr.foo()&&"function"==typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(that=new Uint8Array(length),that.__proto__=Buffer.prototype):(null===that&&(that=new Buffer(length)),that.length=length),that}function Buffer(arg,encodingOrOffset,length){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(arg,encodingOrOffset,length);if("number"==typeof arg){if("string"==typeof encodingOrOffset)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}function from(that,value,encodingOrOffset,length){if("number"==typeof value)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&value instanceof ArrayBuffer?fromArrayBuffer(that,value,encodingOrOffset,length):"string"==typeof value?fromString(that,value,encodingOrOffset):fromObject(that,value)}function assertSize(size){if("number"!=typeof size)throw new TypeError('"size" argument must be a number')}function alloc(that,size,fill,encoding){return assertSize(size),size<=0?createBuffer(that,size):void 0!==fill?"string"==typeof encoding?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill):createBuffer(that,size)}function allocUnsafe(that,size){if(assertSize(size),that=createBuffer(that,size<0?0:0|checked(size)),!Buffer.TYPED_ARRAY_SUPPORT)for(var i=0;i<size;++i)that[i]=0;return that}function fromString(that,string,encoding){if("string"==typeof encoding&&""!==encoding||(encoding="utf8"),!Buffer.isEncoding(encoding))throw new TypeError('"encoding" must be a valid string encoding');var length=0|byteLength(string,encoding);return that=createBuffer(that,length),that.write(string,encoding),that}function fromArrayLike(that,array){var length=0|checked(array.length);that=createBuffer(that,length);for(var i=0;i<length;i+=1)that[i]=255&array[i];return that}function fromArrayBuffer(that,array,byteOffset,length){if(array.byteLength,byteOffset<0||array.byteLength<byteOffset)throw new RangeError("'offset' is out of bounds");if(array.byteLength<byteOffset+(length||0))throw new RangeError("'length' is out of bounds");return array=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length),Buffer.TYPED_ARRAY_SUPPORT?(that=array,that.__proto__=Buffer.prototype):that=fromArrayLike(that,array),that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length);return that=createBuffer(that,len),0===that.length?that:(obj.copy(that,0,0,len),that)}if(obj){if("undefined"!=typeof ArrayBuffer&&obj.buffer instanceof ArrayBuffer||"length"in obj)return"number"!=typeof obj.length||isnan(obj.length)?createBuffer(that,0):fromArrayLike(that,obj);if("Buffer"===obj.type&&isArray(obj.data))return fromArrayLike(that,obj.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|length}function SlowBuffer(length){return+length!=length&&(length=0),Buffer.alloc(+length)}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer))return string.byteLength;"string"!=typeof string&&(string=""+string);var len=string.length;if(0===len)return 0;var loweredCase=!1;for(;;)switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase(),loweredCase=!0}}function slowToString(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return"";if((void 0===end||end>this.length)&&(end=this.length),end<=0)return"";if(end>>>=0,start>>>=0,end<=start)return"";for(encoding||(encoding="utf8");;)switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function arrayIndexOf(arr,val,byteOffset,encoding){function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(void 0!==encoding&&(encoding=String(encoding).toLowerCase(),"ucs2"===encoding||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}var foundIndex=-1;for(var i=byteOffset;i<arrLength;++i)if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else foundIndex!==-1&&(i-=i-foundIndex),foundIndex=-1;return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;for(;i<end;){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:secondByte=buf[i+1],128===(192&secondByte)&&(tempCodePoint=(31&firstByte)<<6|63&secondByte,tempCodePoint>127&&(codePoint=tempCodePoint));break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128===(192&secondByte)&&128===(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte,tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint));break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128===(192&secondByte)&&128===(192&thirdByte)&&128===(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte,tempCodePoint>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint))}}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return decodeCodePointsArray(res)}function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res="";var i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);var out="";for(var i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}function objectWriteUInt16(buf,value,offset,littleEndian){value<0&&(value=65535+value+1);for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}function objectWriteUInt32(buf,value,offset,littleEndian){value<0&&(value=4294967295+value+1);for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return noAssert||checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){if(str=stringtrim(str).replace(INVALID_BASE64_RE,""),str.length<2)return"";for(;str.length%4!==0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function toHex(n){return n<16?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){if(codePoint=string.charCodeAt(i),codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error("Invalid code point");if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isnan(val){return val!==val}var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("isarray");exports.Buffer=Buffer,exports.SlowBuffer=SlowBuffer,exports.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==global.TYPED_ARRAY_SUPPORT?global.TYPED_ARRAY_SUPPORT:typedArraySupport(),exports.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(arr){return arr.__proto__=Buffer.prototype,arr},Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)},Buffer.isBuffer=function(b){return!(null==b||!b._isBuffer)},Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(list,length){if(!isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.toString=function(){var length=0|this.length;return 0===length?"":0===arguments.length?utf8Slice(this,0,length):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str="";var max=exports.INSPECT_MAX_BYTES;return this.length>0&&(str=this.toString("hex",0,max).match(/.{2}/g).join(" "),this.length>max&&(str+=" ... ")),"<Buffer "+str+">"},Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target))throw new TypeError("Argument must be a Buffer");if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError("out of range index");if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.indexOf=function(val,byteOffset,encoding){if("string"==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),byteOffset>>=0,0===this.length)return-1;if(byteOffset>=this.length)return-1;if(byteOffset<0&&(byteOffset=Math.max(this.length+byteOffset,0)),"string"==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(this,val,byteOffset,encoding);if("number"==typeof val)return Buffer.TYPED_ARRAY_SUPPORT&&"function"===Uint8Array.prototype.indexOf?Uint8Array.prototype.indexOf.call(this,val,byteOffset):arrayIndexOf(this,[val],byteOffset,encoding);throw new TypeError("val must be string, number or Buffer")},Buffer.prototype.includes=function(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding="utf8",length=this.length,offset=0;else if(void 0===length&&"string"==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");offset=0|offset,isFinite(length)?(length=0|length,void 0===encoding&&(encoding="utf8")):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError("Attempt to write outside buffer bounds");encoding||(encoding="utf8");var loweredCase=!1;for(;;)switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len,start<0&&(start=0)):start>len&&(start=len),end<0?(end+=len,end<0&&(end=0)):end>len&&(end=len),end<start&&(end=start);var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT)newBuf=this.subarray(start,end),newBuf.__proto__=Buffer.prototype;else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;i<sliceLen;++i)newBuf[i]=this[i+start]}return newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;for(;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);var val=this[offset+--byteLength];var mul=1;for(;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;for(;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset=0|offset,byteLength=0|byteLength,noAssert||checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];for(;i>0&&(mul*=256);)val+=this[offset+--i]*mul;return mul*=128,val>=mul&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return noAssert||checkOffset(offset,1,this.length),128&this[offset]?(255-this[offset]+1)*-1:this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,byteLength=0|byteLength,!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,byteLength=0|byteLength,!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset=0|offset,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(value=Math.floor(value)),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8):objectWriteUInt16(this,value,offset,!0),offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>8,this[offset+1]=255&value):objectWriteUInt16(this,value,offset,!1),offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24):objectWriteUInt32(this,value,offset,!0),offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset=0|offset,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),Buffer.TYPED_ARRAY_SUPPORT?(this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value):objectWriteUInt32(this,value,offset,!1),offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end)for(i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<len;++i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if("string"==typeof val){if("string"==typeof start?(encoding=start,start=0,end=this.length):"string"==typeof end&&(encoding=end,end=this.length),1===val.length){var code=val.charCodeAt(0);code<256&&(val=code)}if(void 0!==encoding&&"string"!=typeof encoding)throw new TypeError("encoding must be a string");if("string"==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError("Unknown encoding: "+encoding)}else"number"==typeof val&&(val=255&val);if(start<0||this.length<start||this.length<end)throw new RangeError("Out of range index");if(end<=start)return this;start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0);var i;if("number"==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"base64-js":1,"ieee754":3,"isarray":4}],3:[function(require,module,exports){
exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=8*nBytes-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:(s?-1:1)*(1/0);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=8*nBytes-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s};
},{}],4:[function(require,module,exports){
var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)};
},{}],5:[function(require,module,exports){
"use strict";function toObject(val){if(null===val||void 0===val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}function shouldUseNative(){try{if(!Object.assign)return!1;var test1=new String("abc");if(test1[5]="de","5"===Object.getOwnPropertyNames(test1)[0])return!1;var test2={};for(var i=0;i<10;i++)test2["_"+String.fromCharCode(i)]=i;var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if("0123456789"!==order2.join(""))return!1;var test3={};return"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},test3)).join("")}catch(e){return!1}}var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;module.exports=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from)hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(Object.getOwnPropertySymbols){symbols=Object.getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to};
},{}],6:[function(require,module,exports){
module.exports={"version":""}
},{}],7:[function(require,module,exports){
(function (global){
var F={util:{},factory:{},transport:{},store:{},service:{},manager:{strategy:{}}};F.load=require("./env-load"),F.load(),F.util.query=require("./util/query-util"),F.util.makeSequence=require("./util/make-sequence"),F.util.run=require("./util/run-util"),F.util.classFrom=require("./util/inherit"),F.factory.Transport=require("./transport/http-transport-factory"),F.transport.Ajax=require("./transport/ajax-http-transport"),F.service.URL=require("./service/url-config-service"),F.service.Config=require("./service/configuration-service"),F.service.Run=require("./service/run-api-service"),F.service.File=require("./service/admin-file-service"),F.service.Variables=require("./service/variables-api-service"),F.service.Data=require("./service/data-api-service"),F.service.Auth=require("./service/auth-api-service"),F.service.World=require("./service/world-api-adapter"),F.service.State=require("./service/state-api-adapter"),F.service.User=require("./service/user-api-adapter"),F.service.Member=require("./service/member-api-adapter"),F.service.Asset=require("./service/asset-api-adapter"),F.service.Group=require("./service/group-api-service"),F.store.Cookie=require("./store/cookie-store"),F.factory.Store=require("./store/store-factory"),F.manager.ScenarioManager=require("./managers/scenario-manager"),F.manager.RunManager=require("./managers/run-manager"),F.manager.AuthManager=require("./managers/auth-manager"),F.manager.WorldManager=require("./managers/world-manager"),F.manager.strategy["always-new"]=require("./managers/run-strategies/always-new-strategy"),F.manager.strategy["conditional-creation"]=require("./managers/run-strategies/conditional-creation-strategy"),F.manager.strategy.identity=require("./managers/run-strategies/identity-strategy"),F.manager.strategy["new-if-missing"]=require("./managers/run-strategies/new-if-missing-strategy"),F.manager.strategy["new-if-missing"]=require("./managers/run-strategies/new-if-missing-strategy"),F.manager.strategy["new-if-persisted"]=require("./managers/run-strategies/new-if-persisted-strategy"),F.manager.strategy["new-if-initialized"]=require("./managers/run-strategies/new-if-initialized-strategy"),F.manager.ChannelManager=require("./managers/epicenter-channel-manager"),F.service.Channel=require("./service/channel-service"),F.version="1.9.0",F.api=require("./api-version.json"),global.F=F,module.exports=F;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./api-version.json":6,"./env-load":8,"./managers/auth-manager":9,"./managers/epicenter-channel-manager":11,"./managers/run-manager":13,"./managers/run-strategies/always-new-strategy":14,"./managers/run-strategies/conditional-creation-strategy":15,"./managers/run-strategies/identity-strategy":16,"./managers/run-strategies/new-if-initialized-strategy":18,"./managers/run-strategies/new-if-missing-strategy":19,"./managers/run-strategies/new-if-persisted-strategy":20,"./managers/scenario-manager":23,"./managers/world-manager":25,"./service/admin-file-service":26,"./service/asset-api-adapter":27,"./service/auth-api-service":28,"./service/channel-service":29,"./service/configuration-service":30,"./service/data-api-service":31,"./service/group-api-service":32,"./service/member-api-adapter":33,"./service/run-api-service":34,"./service/state-api-adapter":36,"./service/url-config-service":37,"./service/user-api-adapter":38,"./service/variables-api-service":39,"./service/world-api-adapter":40,"./store/cookie-store":41,"./store/store-factory":43,"./transport/ajax-http-transport":44,"./transport/http-transport-factory":45,"./util/inherit":46,"./util/make-sequence":47,"./util/query-util":50,"./util/run-util":51}],8:[function(require,module,exports){
"use strict";var urlConfigService=require("./service/url-config-service");var envLoad=function(callback){var envPromise;var host;var urlService=urlConfigService();var envPath="/epicenter/v1/config";host=urlService.isLocalhost()?"https://forio.com":"";var infoUrl=host+envPath;return envPromise=$.ajax({url:infoUrl,async:!1}),envPromise.done(function(res){var api=res.api;$.extend(urlConfigService,api)}).fail(function(res){$.extend(urlConfigService,{protocol:"https",host:"api.forio.com"})}),envPromise.done(callback).fail(callback)};module.exports=envLoad;
},{"./service/url-config-service":37}],9:[function(require,module,exports){
"use strict";function AuthManager(options){options=$.extend(!0,{},defaults,options),this.sessionManager=new SessionManager(options),this.options=this.sessionManager.getMergedOptions(),this.isLocal=this.options.isLocal,this.authAdapter=new AuthAdapter(this.options)}var AuthAdapter=require("../service/auth-api-service");var MemberAdapter=require("../service/member-api-adapter");var GroupService=require("../service/group-api-service");var SessionManager=require("../store/session-manager");var Buffer=require("buffer").Buffer;var _pick=require("../util/object-util")._pick;var objectAssign=require("object-assign");var defaults={requiresGroup:!0};var _findUserInGroup=function(members,id){for(var j=0;j<members.length;j++)if(members[j].userId===id)return members[j];return null};AuthManager.prototype=$.extend(AuthManager.prototype,{login:function(options){var _this=this;var $d=$.Deferred();var sessionManager=this.sessionManager;var adapterOptions=sessionManager.getMergedOptions({success:$.noop,error:$.noop},options);var outSuccess=adapterOptions.success;var outError=adapterOptions.error;var groupId=adapterOptions.groupId;var decodeToken=function(token){var encoded=token.split(".")[1];for(;encoded.length%4!==0;)encoded+="=";var decode=window.atob?window.atob:function(encoded){return new Buffer(encoded,"base64").toString("ascii")};return JSON.parse(decode(encoded))};var handleGroupError=function(message,statusCode,data){_this.logout().then(function(){var error=$.extend(!0,{},data,{statusText:message,status:statusCode});$d.reject(error)})};var handleSuccess=function(response){var token=response.access_token;var userInfo=decodeToken(token);var oldGroups=sessionManager.getSession().groups||{};var userGroupOpts=$.extend(!0,{},adapterOptions,{success:$.noop});var data={auth:response,user:userInfo};var project=adapterOptions.project;var isTeamMember=null===userInfo.parent_account_id;var requiresGroup=adapterOptions.requiresGroup&&project;var sessionInfo={auth_token:token,account:adapterOptions.account,project:project,userId:userInfo.user_id,groups:oldGroups,isTeamMember:isTeamMember};if(!requiresGroup)return sessionManager.saveSession(sessionInfo),outSuccess.apply(this,[data]),void $d.resolve(data);var handleGroupList=function(groupList){data.userGroups=groupList;var group=null;if(0===groupList.length)return void handleGroupError("The user has no groups associated in this account",401,data);if(1===groupList.length)group=groupList[0];else if(groupList.length>1&&groupId){var filteredGroups=$.grep(groupList,function(resGroup){return resGroup.groupId===groupId});group=1===filteredGroups.length?filteredGroups[0]:null}if(group){var isFac=!!isTeamMember||"facilitator"===_findUserInGroup(group.members,userInfo.user_id).role;var groupData={groupId:group.groupId,groupName:group.name,isFac:isFac};var sessionInfoWithGroup=objectAssign({},sessionInfo,groupData);sessionInfo.groups[project]=groupData,_this.sessionManager.saveSession(sessionInfoWithGroup,adapterOptions),outSuccess.apply(this,[data]),$d.resolve(data)}else handleGroupError("This user is associated with more than one group. Please specify a group id to log into and try again",403,data)};if(isTeamMember){var opts=objectAssign({},userGroupOpts,{token:token});var groupService=new GroupService(opts);groupService.getGroups({account:adapterOptions.account,project:project}).then(function(groups){groups.forEach(function(group){group.groupId=group.id}),handleGroupList(groups)},$d.reject)}else _this.getUserGroups({userId:userInfo.user_id,token:token},userGroupOpts).then(handleGroupList,$d.reject)};return adapterOptions.success=handleSuccess,adapterOptions.error=function(response){return adapterOptions.account?(adapterOptions.account=null,adapterOptions.error=function(){outError.apply(this,arguments),$d.reject(response)},void _this.authAdapter.login(adapterOptions)):(outError.apply(this,arguments),void $d.reject(response))},this.authAdapter.login(adapterOptions),$d.promise()},logout:function(options){var _this=this;var adapterOptions=this.sessionManager.getMergedOptions(options);var removeCookieFn=function(response){_this.sessionManager.removeSession()};return this.authAdapter.logout(adapterOptions).done(removeCookieFn)},getToken:function(options){var httpOptions=this.sessionManager.getMergedOptions(options);var session=this.sessionManager.getSession();var $d=$.Deferred();return session.auth_token?$d.resolve(session.auth_token):this.login(httpOptions).then($d.resolve),$d.promise()},getUserGroups:function(params,options){var adapterOptions=this.sessionManager.getMergedOptions({success:$.noop},options);var $d=$.Deferred();var outSuccess=adapterOptions.success;adapterOptions.success=function(memberInfo){adapterOptions.project&&(memberInfo=$.grep(memberInfo,function(group){return group.project===adapterOptions.project})),outSuccess.apply(this,[memberInfo]),$d.resolve(memberInfo)};var memberAdapter=new MemberAdapter({token:params.token});return memberAdapter.getGroupsForUser(params,adapterOptions).fail($d.reject),$d.promise()},getCurrentUserSessionInfo:function(options){return this.sessionManager.getSession(options)},addGroups:function(groups){var session=this.getCurrentUserSessionInfo();var isArray=Array.isArray(groups);return groups=isArray?groups:[groups],$.each(groups,function(index,group){var extendedGroup=$.extend({},{isFac:!1},group);var project=extendedGroup.project;var validProps=["groupName","groupId","isFac"];if(!project||!extendedGroup.groupName)throw new Error("No project or groupName specified.");extendedGroup=_pick(extendedGroup,validProps),session.groups[project]=extendedGroup}),this.sessionManager.saveSession(session),session}}),module.exports=AuthManager;
},{"../service/auth-api-service":28,"../service/group-api-service":32,"../service/member-api-adapter":33,"../store/session-manager":42,"../util/object-util":48,"buffer":2,"object-assign":5}],10:[function(require,module,exports){
"use strict";var Channel=require("../service/channel-service");var SessionManager=require("../store/session-manager");var ChannelManager=function(options){if(!$.cometd)throw new Error("Cometd library not found. Please include epicenter-multiplayer-dependencies.js");if(!options||!options.url)throw new Error("Please provide an url for the cometd server");var defaults={url:"",logLevel:"info",websocketEnabled:!1,shareConnection:!1,channel:{},handshake:void 0};this.sessionManager=new SessionManager;var defaultCometOptions=this.sessionManager.getMergedOptions(defaults,options);if(this.currentSubscriptions=[],this.options=defaultCometOptions,defaultCometOptions.shareConnection&&ChannelManager.prototype._cometd)return this.cometd=ChannelManager.prototype._cometd,this;var cometd=new $.Cometd;ChannelManager.prototype._cometd=cometd,cometd.websocketEnabled=defaultCometOptions.websocketEnabled,this.isConnected=!1;var connectionBroken=function(message){$(this).trigger("disconnect",message)};var connectionSucceeded=function(message){$(this).trigger("connect",message)};var me=this;cometd.configure(defaultCometOptions),cometd.addListener("/meta/connect",function(message){var wasConnected=this.isConnected;this.isConnected=message.successful===!0,!wasConnected&&this.isConnected?connectionSucceeded.call(this,message):wasConnected&&!this.isConnected&&connectionBroken.call(this,message)}.bind(this)),cometd.addListener("/meta/disconnect",connectionBroken),cometd.addListener("/meta/handshake",function(message){message.successful&&cometd.batch(function(){$(me.currentSubscriptions).each(function(index,subs){cometd.resubscribe(subs)})})}),cometd.addListener("/meta/subscribe",function(message){$(me).trigger("subscribe",message)}),cometd.addListener("/meta/unsubscribe",function(message){$(me).trigger("unsubscribe",message)}),cometd.addListener("/meta/publish",function(message){$(me).trigger("publish",message)}),cometd.addListener("/meta/unsuccessful",function(message){$(me).trigger("error",message)}),cometd.handshake(defaultCometOptions.handshake),this.cometd=cometd};ChannelManager.prototype=$.extend(ChannelManager.prototype,{getChannel:function(options){options&&!$.isPlainObject(options)&&(options={base:options});var defaults={transport:this.cometd};var channel=new Channel($.extend(!0,{},this.options.channel,defaults,options));var subs=channel.subscribe;channel.subscribe=function(){var subid=subs.apply(channel,arguments);return this.currentSubscriptions=this.currentSubscriptions.concat(subid),subid}.bind(this);var unsubs=channel.unsubscribe;return channel.unsubscribe=function(){var removed=unsubs.apply(channel,arguments);for(var i=0;i<this.currentSubscriptions.length;i++)this.currentSubscriptions[i].id===removed.id&&this.currentSubscriptions.splice(i,1);return removed}.bind(this),channel},on:function(event){$(this).on.apply($(this),arguments)},off:function(event){$(this).off.apply($(this),arguments)},trigger:function(event){$(this).trigger.apply($(this),arguments)}}),module.exports=ChannelManager;
},{"../service/channel-service":29,"../store/session-manager":42}],11:[function(require,module,exports){
"use strict";var ChannelManager=require("./channel-manager");var classFrom=require("../util/inherit");var urlService=require("../service/url-config-service");var SessionManager=require("../store/session-manager");var AuthManager=require("./auth-manager");var validTypes={project:!0,group:!0,world:!0,user:!0,data:!0,general:!0,chat:!0};var session=new AuthManager;var getFromSettingsOrSessionOrError=function(value,sessionKeyName,settings){if(!value){var userInfo=session.getCurrentUserSessionInfo();if(settings&&settings[sessionKeyName])value=settings[sessionKeyName];else{if(!userInfo[sessionKeyName])throw new Error(sessionKeyName+" not found. Please log-in again, or specify "+sessionKeyName+" explicitly");value=userInfo[sessionKeyName]}}return value};var __super=ChannelManager.prototype;var EpicenterChannelManager=classFrom(ChannelManager,{constructor:function(options){this.sessionManager=new SessionManager;var defaultCometOptions=this.sessionManager.getMergedOptions(options);var urlOpts=urlService(defaultCometOptions.server);if(defaultCometOptions.url||(defaultCometOptions.url=urlOpts.protocol+"://"+urlOpts.host+"/channel/subscribe"),void 0===defaultCometOptions.handshake){var userName=defaultCometOptions.userName;var userId=defaultCometOptions.userId;var token=defaultCometOptions.token;if((userName||userId)&&token){var userProp=userName?"userName":"userId";var ext={authorization:"Bearer "+token};ext[userProp]=userName?userName:userId,defaultCometOptions.handshake={ext:ext}}}return this.options=defaultCometOptions,__super.constructor.call(this,defaultCometOptions)},getChannel:function(options){options&&"object"!=typeof options&&(options={base:options});var channelOpts=$.extend({},this.options,options);var base=channelOpts.base;if(!base)throw new Error("No base topic was provided");if(!channelOpts.allowAllChannels){var baseParts=base.split("/");var channelType=baseParts[1];if(baseParts.length<4)throw new Error("Invalid channel base name, it must be in the form /{type}/{account id}/{project id}/{...}");if(!validTypes[channelType])throw new Error("Invalid channel type")}return __super.getChannel.apply(this,arguments)},getGroupChannel:function(groupName){groupName=getFromSettingsOrSessionOrError(groupName,"groupName",this.options);var account=getFromSettingsOrSessionOrError("","account",this.options);var project=getFromSettingsOrSessionOrError("","project",this.options);var baseTopic=["/group",account,project,groupName].join("/");return __super.getChannel.call(this,{base:baseTopic})},getWorldChannel:function(world,groupName){var worldid=$.isPlainObject(world)&&world.id?world.id:world;if(!worldid)throw new Error("Please specify a world id");groupName=getFromSettingsOrSessionOrError(groupName,"groupName",this.options);var account=getFromSettingsOrSessionOrError("","account",this.options);var project=getFromSettingsOrSessionOrError("","project",this.options);var baseTopic=["/world",account,project,groupName,worldid].join("/");return __super.getChannel.call(this,{base:baseTopic})},getUserChannel:function(world,user,groupName){var worldid=$.isPlainObject(world)&&world.id?world.id:world;if(!worldid)throw new Error("Please specify a world id");var userid=$.isPlainObject(user)&&user.id?user.id:user;userid=getFromSettingsOrSessionOrError(userid,"userId",this.options),groupName=getFromSettingsOrSessionOrError(groupName,"groupName",this.options);var account=getFromSettingsOrSessionOrError("","account",this.options);var project=getFromSettingsOrSessionOrError("","project",this.options);var baseTopic=["/user",account,project,groupName,worldid,userid].join("/");return __super.getChannel.call(this,{base:baseTopic})},getPresenceChannel:function(world,userid,groupName){var worldid=$.isPlainObject(world)&&world.id?world.id:world;if(!worldid)throw new Error("Please specify a world id");userid=getFromSettingsOrSessionOrError(userid,"userId",this.options),groupName=getFromSettingsOrSessionOrError(groupName,"groupName",this.options);var account=getFromSettingsOrSessionOrError("","account",this.options);var project=getFromSettingsOrSessionOrError("","project",this.options);var baseTopic=["/user",account,project,groupName,worldid].join("/");var channel=__super.getChannel.call(this,{base:baseTopic});var lastPingTime={};var PING_INTERVAL=6e3;return channel.subscribe("internal-ping-channel",function(notification){var incomingUserId=notification.data.user;lastPingTime[incomingUserId]||incomingUserId===userid||channel.trigger.call(channel,"presence",{userId:incomingUserId,online:!0}),lastPingTime[incomingUserId]=(new Date).valueOf()}),setInterval(function(){channel.publish("internal-ping-channel",{user:userid}),$.each(lastPingTime,function(key,value){var now=(new Date).valueOf();value&&value+2*PING_INTERVAL<now&&(lastPingTime[key]=null,channel.trigger.call(channel,"presence",{userId:key,online:!1}))})},PING_INTERVAL),channel},getDataChannel:function(collection){if(!collection)throw new Error("Please specify a collection to listen on.");var account=getFromSettingsOrSessionOrError("","account",this.options);var project=getFromSettingsOrSessionOrError("","project",this.options);var baseTopic=["/data",account,project,collection].join("/");var channel=__super.getChannel.call(this,{base:baseTopic});var oldsubs=channel.subscribe;return channel.subscribe=function(topic,callback,context,options){var callbackWithCleanData=function(payload){var meta={path:payload.channel,subType:payload.data.subType,date:payload.data.date};var actualData=payload.data.data;actualData.data&&(actualData=actualData.data),callback.call(context,actualData,meta)};return oldsubs.call(channel,topic,callbackWithCleanData,context,options)},channel}});module.exports=EpicenterChannelManager;
},{"../service/url-config-service":37,"../store/session-manager":42,"../util/inherit":46,"./auth-manager":9,"./channel-manager":10}],12:[function(require,module,exports){
"use strict";module.exports={EPI_SESSION_KEY:"epicenterjs.session",STRATEGY_SESSION_KEY:"epicenter-scenario"};
},{}],13:[function(require,module,exports){
"use strict";function patchRunService(service,manager){if(service.patched)return service;var orig=service.do;return service.do=function(operation,params,options){var reservedOps=Object.keys(specialOperations);return reservedOps.indexOf(operation)===-1?orig.apply(service,arguments):specialOperations[operation].call(service,params,options,manager)},service.patched=!0,service}function RunManager(options){this.options=$.extend(!0,{},defaults,options),this.options.run instanceof RunService?this.run=this.options.run:this.run=new RunService(this.options.run),patchRunService(this.run,this);var StrategyCtor="function"==typeof this.options.strategy?this.options.strategy:strategiesMap[this.options.strategy];if(!StrategyCtor)throw new Error("Specified run creation strategy was invalid:",this.options.strategy);this.strategy=new StrategyCtor(this.run,this.options)}var strategiesMap=require("./run-strategies/strategies-map");var specialOperations=require("./special-operations");var RunService=require("../service/run-api-service");var defaults={strategy:"new-if-initialized"};RunManager.prototype={getRun:function(){return this.strategy.getRun()},reset:function(runServiceOptions){return this.strategy.reset(runServiceOptions)}},module.exports=RunManager;
},{"../service/run-api-service":34,"./run-strategies/strategies-map":22,"./special-operations":24}],14:[function(require,module,exports){
"use strict";var classFrom=require("../../util/inherit");var ConditionalStrategy=require("./conditional-creation-strategy");var __super=ConditionalStrategy.prototype;var Strategy=classFrom(ConditionalStrategy,{constructor:function(runService,options){__super.constructor.call(this,runService,this.createIf,options)},createIf:function(run,headers){return!0}});module.exports=Strategy;
},{"../../util/inherit":46,"./conditional-creation-strategy":15}],15:[function(require,module,exports){
"use strict";function setRunInSession(sessionKey,run,sessionManager){sessionManager.getStore().set(sessionKey,JSON.stringify({runId:run.id}))}var makeSeq=require("../../util/make-sequence");var Base=require("./identity-strategy");var SessionManager=require("../../store/session-manager");var classFrom=require("../../util/inherit");var AuthManager=require("../auth-manager");var keyNames=require("../key-names");var defaults={sessionKey:keyNames.STRATEGY_SESSION_KEY,path:""};var Strategy=classFrom(Base,{constructor:function(runService,condition,options){if(null==condition)throw new Error("Conditional strategy needs a condition to createte a run");this._auth=new AuthManager,this.run=makeSeq(runService),this.condition="function"!=typeof condition?function(){return condition}:condition,this.options=$.extend(!0,{},defaults,options),this.sessionManager=new SessionManager(options),this.runOptions=this.options.run},runOptionsWithScope:function(){var userSession=this._auth.getCurrentUserSessionInfo();return $.extend({scope:{group:userSession.groupName}},this.runOptions)},reset:function(runServiceOptions){var _this=this;var opt=this.runOptionsWithScope();return this.run.create(opt,runServiceOptions).then(function(run){return setRunInSession(_this.options.sessionKey,run,_this.sessionManager),run.freshlyCreated=!0,run}).start()},getRun:function(){var sessionStore=this.sessionManager.getStore();var runSession=JSON.parse(sessionStore.get(this.options.sessionKey));return runSession&&runSession.runId?this._loadAndCheck(runSession).fail(function(){return this.reset()}.bind(this)):this.reset()},_loadAndCheck:function(runSession){var shouldCreate=!1;var _this=this;return this.run.load(runSession.runId,null,{success:function(run,msg,headers){shouldCreate=_this.condition.call(_this,run,headers)}}).then(function(run){if(shouldCreate){var opt=_this.runOptionsWithScope();return _this.run.original.create(opt).then(function(run){return setRunInSession(_this.options.sessionKey,run,_this.sessionManager),run.freshlyCreated=!0,run})}return run}).start()}});module.exports=Strategy;
},{"../../store/session-manager":42,"../../util/inherit":46,"../../util/make-sequence":47,"../auth-manager":9,"../key-names":12,"./identity-strategy":16}],16:[function(require,module,exports){
"use strict";var classFrom=require("../../util/inherit");var Base={};module.exports=classFrom(Base,{constructor:function(runService,options){this.runService=runService},reset:function(){return $.Deferred().resolve().promise()},getRun:function(){return $.Deferred().resolve(this.runService).promise()}});
},{"../../util/inherit":46}],17:[function(require,module,exports){
"use strict";var classFrom=require("../../util/inherit");var IdentityStrategy=require("./identity-strategy");var WorldApiAdapter=require("../../service/world-api-adapter");var AuthManager=require("../auth-manager");var defaults={store:{synchronous:!0}};var Strategy=classFrom(IdentityStrategy,{constructor:function(runService,options){this.runService=runService,this.options=$.extend(!0,{},defaults,options),this._auth=new AuthManager,this._loadRun=this._loadRun.bind(this),this.worldApi=new WorldApiAdapter(this.options.run)},reset:function(){var session=this._auth.getCurrentUserSessionInfo();var curUserId=session.userId;var curGroupName=session.groupName;return this.worldApi.getCurrentWorldForUser(curUserId,curGroupName).then(function(world){return this.worldApi.newRunForWorld(world.id)}.bind(this))},getRun:function(){var session=this._auth.getCurrentUserSessionInfo();var curUserId=session.userId;var curGroupName=session.groupName;var worldApi=this.worldApi;var model=this.options.model;var _this=this;var dtd=$.Deferred();if(!curUserId)return dtd.reject({statusCode:400,error:"We need an authenticated user to join a multiplayer world. (ERR: no userId in session)"},session).promise();var loadRunFromWorld=function(world){return world?worldApi.getCurrentRunId({model:model,filter:world.id}).then(_this._loadRun).then(dtd.resolve).fail(dtd.reject):dtd.reject({statusCode:404,error:"The user is not in any world."},{options:this.options,session:session})};var serverError=function(error){dtd.reject(error,session,this.options)};return this.worldApi.getCurrentWorldForUser(curUserId,curGroupName).then(loadRunFromWorld).fail(serverError),dtd.promise()},_loadRun:function(id,options){return this.runService.load(id,null,options)}});module.exports=Strategy;
},{"../../service/world-api-adapter":40,"../../util/inherit":46,"../auth-manager":9,"./identity-strategy":16}],18:[function(require,module,exports){
"use strict";var classFrom=require("../../util/inherit");var ConditionalStrategy=require("./conditional-creation-strategy");var __super=ConditionalStrategy.prototype;var Strategy=classFrom(ConditionalStrategy,{constructor:function(runService,options){__super.constructor.call(this,runService,this.createIf,options)},createIf:function(run,headers){return"persistent"===headers.getResponseHeader("pragma")||run.initialized}});module.exports=Strategy;
},{"../../util/inherit":46,"./conditional-creation-strategy":15}],19:[function(require,module,exports){
"use strict";var classFrom=require("../../util/inherit");var ConditionalStrategy=require("./conditional-creation-strategy");var __super=ConditionalStrategy.prototype;var Strategy=classFrom(ConditionalStrategy,{constructor:function(runService,options){__super.constructor.call(this,runService,this.createIf,options)},createIf:function(run,headers){return!1}});module.exports=Strategy;
},{"../../util/inherit":46,"./conditional-creation-strategy":15}],20:[function(require,module,exports){
"use strict";var classFrom=require("../../util/inherit");var ConditionalStrategy=require("./conditional-creation-strategy");var __super=ConditionalStrategy.prototype;var Strategy=classFrom(ConditionalStrategy,{constructor:function(runService,options){__super.constructor.call(this,runService,this.createIf,options)},createIf:function(run,headers){return"persistent"===headers.getResponseHeader("pragma")}});module.exports=Strategy;
},{"../../util/inherit":46,"./conditional-creation-strategy":15}],21:[function(require,module,exports){
"use strict";var classFrom=require("../../util/inherit");var IdentityStrategy=require("./identity-strategy");var StorageFactory=require("../../store/store-factory");var StateApi=require("../../service/state-api-adapter");var AuthManager=require("../auth-manager");var keyNames=require("../key-names");var defaults={store:{synchronous:!0}};var Strategy=classFrom(IdentityStrategy,{constructor:function(runService,options){this.run=runService,this.options=$.extend(!0,{},defaults,options),this.runOptions=this.options.run,this._store=new StorageFactory(this.options.store),this.stateApi=new StateApi,this._auth=new AuthManager,this._loadAndCheck=this._loadAndCheck.bind(this),this._restoreRun=this._restoreRun.bind(this),this._getAllRuns=this._getAllRuns.bind(this),this._loadRun=this._loadRun.bind(this)},reset:function(runServiceOptions){var session=this._auth.getCurrentUserSessionInfo();var opt=$.extend({scope:{group:session.groupName}},this.runOptions);return this.run.create(opt,runServiceOptions).then(function(run){return run.freshlyCreated=!0,run})},getRun:function(){return this._getAllRuns().then(this._loadAndCheck)},_getAllRuns:function(){var session=JSON.parse(this._store.get(keyNames.EPI_SESSION_KEY)||"{}");return this.run.query({"user.id":session.userId||"0000","scope.group":session.groupName})},_loadAndCheck:function(runs){if(!runs||!runs.length)return this.reset();var dateComp=function(a,b){return new Date(b.date)-new Date(a.date)};var latestRun=runs.sort(dateComp)[0];var _this=this;var shouldReplay=!1;return this.run.load(latestRun.id,null,{success:function(run,msg,headers){shouldReplay="persistent"===headers.getResponseHeader("pragma")}}).then(function(run){return shouldReplay?_this._restoreRun(run.id):run})},_restoreRun:function(runId){var _this=this;return this.stateApi.replay({runId:runId}).then(function(resp){return _this._loadRun(resp.run)})},_loadRun:function(id,options){return this.run.load(id,null,options)}});module.exports=Strategy;
},{"../../service/state-api-adapter":36,"../../store/store-factory":43,"../../util/inherit":46,"../auth-manager":9,"../key-names":12,"./identity-strategy":16}],22:[function(require,module,exports){
module.exports={"new-if-initialized":require("./new-if-initialized-strategy"),"new-if-persisted":require("./new-if-persisted-strategy"),"new-if-missing":require("./new-if-missing-strategy"),"always-new":require("./always-new-strategy"),multiplayer:require("./multiplayer-strategy"),"persistent-single-player":require("./persistent-single-player-strategy"),none:require("./identity-strategy")};
},{"./always-new-strategy":14,"./identity-strategy":16,"./multiplayer-strategy":17,"./new-if-initialized-strategy":18,"./new-if-missing-strategy":19,"./new-if-persisted-strategy":20,"./persistent-single-player-strategy":21}],23:[function(require,module,exports){
"use strict";function ScenarioManager(options){this.options=$.extend(!0,{},defaults,options),this.runService=this.options.run||new RunService(this.options)}var RunService=require("../service/run-api-service");var defaults={validFilter:{saved:!0}};ScenarioManager.prototype={getRuns:function(filter){return this.filter=$.extend(!0,{},this.options.validFilter,filter),this.runService.query(this.filter)},loadVariables:function(vars){return this.runService.query(this.filter,{include:vars})},save:function(run,meta){return this._getService(run).save($.extend(!0,{},{saved:!0},meta))},archive:function(run){return this._getService(run).save({saved:!1})},_getService:function(run){if("string"==typeof run)return new RunService($.extend(!0,{},this.options,{filter:run}));if("object"==typeof run&&run instanceof RunService)return run;throw new Error("Save method requires a run service or a runId")},getRun:function(runId){return new RunService($.extend(!0,{},this.options,{filter:runId}))}},module.exports=ScenarioManager;
},{"../service/run-api-service":34}],24:[function(require,module,exports){
"use strict";module.exports={reset:function(params,options,manager){return manager.reset(options)}};
},{}],25:[function(require,module,exports){
"use strict";function buildStrategy(worldId,dtd){return function(runService,options){this.runService=runService,this.options=options,$.extend(this,{reset:function(){throw new Error("not implementd. Need api changes")},getRun:function(){var _this=this;var model=this.options.run.model||this.options.model;return worldApi.getCurrentRunId({model:model,filter:worldId}).then(function(runId){return _this.runService.load(runId)}).then(function(run){dtd.resolve.call(this,run,_this.runService)}).fail(dtd.reject)}})}}var WorldApi=require("../service/world-api-adapter");var RunManager=require("./run-manager");var AuthManager=require("./auth-manager");var worldApi;module.exports=function(options){this.options=options||{run:{},world:{}},$.extend(!0,this.options,this.options.run),$.extend(!0,this.options,this.options.world),worldApi=new WorldApi(this.options),this._auth=new AuthManager;var _this=this;var api={getCurrentWorld:function(userId,groupName){var session=this._auth.getCurrentUserSessionInfo();return userId||(userId=session.userId),groupName||(groupName=session.groupName),worldApi.getCurrentWorldForUser(userId,groupName)},getCurrentRun:function(model){function getAndRestoreLatestRun(world){if(!world)return dtd.reject({error:"The user is not part of any world!"});var currentWorldId=world.id;var runOpts=$.extend(!0,_this.options,{model:model});var strategy=buildStrategy(currentWorldId,dtd);var opt=$.extend(!0,{},{strategy:strategy,run:runOpts});var rm=new RunManager(opt);return rm.getRun().then(function(run){dtd.resolve(run,rm.runService,rm)})}var dtd=$.Deferred();var session=this._auth.getCurrentUserSessionInfo();var curUserId=session.userId;var curGroupName=session.groupName;return this.getCurrentWorld(curUserId,curGroupName).then(getAndRestoreLatestRun),dtd.promise()}};$.extend(this,api)};
},{"../service/world-api-adapter":40,"./auth-manager":9,"./run-manager":13}],26:[function(require,module,exports){
"use strict";var ConfigService=require("./configuration-service");var TransportFactory=require("../transport/http-transport-factory");var SessionManager=require("../store/session-manager");module.exports=function(config){var defaults={token:void 0,account:void 0,project:void 0,folderType:"static",transport:{}};this.sessionManager=new SessionManager;var serviceOptions=this.sessionManager.getMergedOptions(defaults,config);var urlConfig=new ConfigService(serviceOptions).get("server");serviceOptions.account&&(urlConfig.accountPath=serviceOptions.account),serviceOptions.project&&(urlConfig.projectPath=serviceOptions.project);var httpOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getAPIPath("file")});serviceOptions.token&&(httpOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(httpOptions);var publicAsyncAPI={getContents:function(filePath,options){var path=serviceOptions.folderType+"/"+filePath;var httpOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("file")+path});return http.get("",httpOptions)},writeToFile:function(filePath,contents,options){filePath=filePath.split("/");var fileName=filePath.pop();filePath=filePath.join("/");var path=serviceOptions.folderType+"/"+filePath;var boundary="---------------------------7da24f2e50046";var body="--"+boundary+'\r\nContent-Disposition: form-data; name="file";filename="'+fileName+'"\r\nContent-type: text/html\r\n\r\n'+contents+"\r\n--"+boundary+"--";var httpOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("file")+path,data:body,contentType:"multipart/form-data; boundary="+boundary});return http.put(body,httpOptions)},remove:function(filePath,options){var path=serviceOptions.folderType+"/"+filePath;var httpOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("file")+path});return http.delete(null,httpOptions)},rename:function(filePath,newName,options){var path=serviceOptions.folderType+"/"+filePath;var httpOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("file")+path});return http.patch({name:newName},httpOptions)}};$.extend(this,publicAsyncAPI)};
},{"../store/session-manager":42,"../transport/http-transport-factory":45,"./configuration-service":30}],27:[function(require,module,exports){
"use strict";var ConfigService=require("./configuration-service");var TransportFactory=require("../transport/http-transport-factory");var _pick=require("../util/object-util")._pick;var SessionManager=require("../store/session-manager");var apiEndpoint="asset";module.exports=function(config){var defaults={token:void 0,account:void 0,project:void 0,group:void 0,userId:void 0,scope:"user",fullUrl:!0,transport:{processData:!1}};this.sessionManager=new SessionManager;var serviceOptions=this.sessionManager.getMergedOptions(defaults,config);var urlConfig=new ConfigService(serviceOptions).get("server");serviceOptions.account||(serviceOptions.account=urlConfig.accountPath),serviceOptions.project||(serviceOptions.project=urlConfig.projectPath);var transportOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getAPIPath(apiEndpoint)});serviceOptions.token&&(transportOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(transportOptions);var assetApiParams=["encoding","data","contentType"];var scopeConfig={user:["scope","account","project","group","userId"],group:["scope","account","project","group"],project:["scope","account","project"]};var validateFilename=function(filename){if(!filename)throw new Error("filename is needed.")};var validateUrlParams=function(options){var partKeys=scopeConfig[options.scope];if(!partKeys)throw new Error("scope parameter is needed.");$.each(partKeys,function(){if(!options[this])throw new Error(this+" parameter is needed.")})};var buildUrl=function(filename,options){validateUrlParams(options);var partKeys=scopeConfig[options.scope];var parts=$.map(partKeys,function(key){return options[key]});return filename&&(filename="/"+filename),urlConfig.getAPIPath(apiEndpoint)+parts.join("/")+filename};var upload=function(method,filename,params,options){validateFilename(filename),method=method.toLowerCase();var contentType=params instanceof FormData!=!0&&"application/json";"application/json"===contentType?params=_pick(params,assetApiParams):filename="post"===method||"put"===method?"":filename;var urlOptions=$.extend({},serviceOptions,options);var url=buildUrl(filename,urlOptions);var createOptions=$.extend(!0,{},urlOptions,{url:url,contentType:contentType});return http[method](params,createOptions)};var publicAPI={create:function(filename,params,options){return upload("post",filename,params,options)},get:function(filename,options){var getServiceOptions=_pick(serviceOptions,["scope","account","project","group","userId"]);var urlOptions=$.extend({},getServiceOptions,options);var url=buildUrl(filename,urlOptions);var getOptions=$.extend(!0,{},urlOptions,{url:url});return http.get({},getOptions)},list:function(options){var dtd=$.Deferred();var me=this;var urlOptions=$.extend({},serviceOptions,options);var url=buildUrl("",urlOptions);var getOptions=$.extend(!0,{},urlOptions,{url:url});var fullUrl=getOptions.fullUrl;return fullUrl?(http.get({},getOptions).then(function(files){var fullPathFiles=$.map(files,function(file){return buildUrl(file,urlOptions)});dtd.resolve(fullPathFiles,me)}).fail(dtd.reject),dtd.promise()):http.get({},getOptions)},replace:function(filename,params,options){return upload("put",filename,params,options)},delete:function(filename,options){return upload("delete",filename,{},options)},assetUrl:function(filename,options){var urlOptions=$.extend({},serviceOptions,options);return buildUrl(filename,urlOptions)}};$.extend(this,publicAPI)};
},{"../store/session-manager":42,"../transport/http-transport-factory":45,"../util/object-util":48,"./configuration-service":30}],28:[function(require,module,exports){
"use strict";var ConfigService=require("./configuration-service");var TransportFactory=require("../transport/http-transport-factory");module.exports=function(config){var defaults={userName:"",password:"",account:"",transport:{}};var serviceOptions=$.extend({},defaults,config);var urlConfig=new ConfigService(serviceOptions).get("server");var transportOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getAPIPath("authentication")});var http=new TransportFactory(transportOptions);var publicAPI={login:function(options){var httpOptions=$.extend(!0,{success:$.noop},serviceOptions,options);if(!httpOptions.userName||!httpOptions.password){var resp={status:401,statusMessage:"No username or password specified."};return options.error&&options.error.call(this,resp),$.Deferred().reject(resp).promise()}var postParams={userName:httpOptions.userName,password:httpOptions.password};return httpOptions.account&&(postParams.account=httpOptions.account),http.post(postParams,httpOptions)},logout:function(options){var dtd=$.Deferred();return dtd.resolve(),dtd.promise()}};$.extend(this,publicAPI)};
},{"../transport/http-transport-factory":45,"./configuration-service":30}],29:[function(require,module,exports){
"use strict";var Channel=function(options){var defaults={base:"",topicResolver:function(topic){return topic},transport:null};this.channelOptions=$.extend(!0,{},defaults,options)};var makeName=function(channelName,topic){var newName=(channelName?channelName+"/"+topic:topic).replace(/\/\//g,"/").replace(/\/$/,"");return newName};Channel.prototype=$.extend(Channel.prototype,{subscribe:function(topic,callback,context,options){var topics=[].concat(topic);var me=this;var subscriptionIds=[];var opts=me.channelOptions;return opts.transport.batch(function(){$.each(topics,function(index,topic){topic=makeName(opts.base,opts.topicResolver(topic)),subscriptionIds.push(opts.transport.subscribe(topic,callback))})}),subscriptionIds[1]?subscriptionIds:subscriptionIds[0]},publish:function(topic,data){var topics=[].concat(topic);var me=this;var returnObjs=[];var opts=me.channelOptions;return opts.transport.batch(function(){$.each(topics,function(index,topic){topic=makeName(opts.base,opts.topicResolver(topic)),"*"===topic.charAt(topic.length-1)&&(topic=topic.replace(/\*+$/,""),console.warn("You can cannot publish to channels with wildcards. Publishing to ",topic,"instead")),returnObjs.push(opts.transport.publish(topic,data))})}),returnObjs[1]?returnObjs:returnObjs[0]},unsubscribe:function(token){return this.channelOptions.transport.unsubscribe(token),token},on:function(event){$(this).on.apply($(this),arguments)},off:function(event){$(this).off.apply($(this),arguments)},trigger:function(event){$(this).trigger.apply($(this),arguments)}}),module.exports=Channel;
},{}],30:[function(require,module,exports){
"use strict";var urlService=require("./url-config-service");module.exports=function(config){var defaults={logLevel:"NONE"};var serviceOptions=$.extend({},defaults,config);return serviceOptions.server=urlService(serviceOptions.server),{data:serviceOptions,setEnv:function(env){},get:function(property){return serviceOptions[property]},set:function(key,value){serviceOptions[key]=value}}};
},{"./url-config-service":37}],31:[function(require,module,exports){
"use strict";var ConfigService=require("./configuration-service");var qutil=require("../util/query-util");var TransportFactory=require("../transport/http-transport-factory");var SessionManager=require("../store/session-manager");module.exports=function(config){var defaults={root:"/",account:void 0,project:void 0,token:void 0,transport:{}};this.sessionManager=new SessionManager;var serviceOptions=this.sessionManager.getMergedOptions(defaults,config);var urlConfig=new ConfigService(serviceOptions).get("server");serviceOptions.account&&(urlConfig.accountPath=serviceOptions.account),serviceOptions.project&&(urlConfig.projectPath=serviceOptions.project);var getURL=function(key,root){root||(root=serviceOptions.root);var url=urlConfig.getAPIPath("data")+qutil.addTrailingSlash(root);return key&&(url+=qutil.addTrailingSlash(key)),url};var httpOptions=$.extend(!0,{},serviceOptions.transport,{url:getURL});serviceOptions.token&&(httpOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(httpOptions);var publicAPI={query:function(key,query,outputModifier,options){var params=$.extend(!0,{q:query},outputModifier);var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions.url=getURL(key,httpOptions.root),http.get(params,httpOptions)},save:function(key,value,options){var attrs;"object"==typeof key?(attrs=key,options=value):(attrs={})[key]=value;var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions.url=getURL("",httpOptions.root),http.post(attrs,httpOptions)},saveAs:function(key,value,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions.url=getURL(key,httpOptions.root),http.put(value,httpOptions)},load:function(key,outputModifier,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions.url=getURL(key,httpOptions.root),http.get(outputModifier,httpOptions)},remove:function(keys,options){var httpOptions=$.extend(!0,{},serviceOptions,options);var params;return $.isArray(keys)?params={id:keys}:(params="",httpOptions.url=getURL(keys,httpOptions.root)),http.delete(params,httpOptions)}};$.extend(this,publicAPI)};
},{"../store/session-manager":42,"../transport/http-transport-factory":45,"../util/query-util":50,"./configuration-service":30}],32:[function(require,module,exports){
"use strict";var serviceUtils=require("./service-utils");var TransportFactory=require("../transport/http-transport-factory");var objectAssign=require("object-assign");var apiEndpoint="group/local";var GroupService=function(config){var defaults={account:void 0,project:void 0,transport:{}};var serviceOptions=serviceUtils.getDefaultOptions(defaults,config,{apiEndpoint:apiEndpoint});var transportOptions=serviceOptions.transport;delete serviceOptions.transport;var http=new TransportFactory(transportOptions,serviceOptions);var publicAPI={getGroups:function(params,options){var finalOpts=objectAssign({},serviceOptions,options);var finalParams;return"string"==typeof params?finalOpts.url=serviceUtils.getApiUrl(apiEndpoint+"/"+params,finalOpts):finalParams=params,http.get(finalParams,finalOpts)}};objectAssign(this,publicAPI)};module.exports=GroupService;
},{"../transport/http-transport-factory":45,"./service-utils":35,"object-assign":5}],33:[function(require,module,exports){
"use strict";var ConfigService=require("./configuration-service");var TransportFactory=require("../transport/http-transport-factory");var SessionManager=require("../store/session-manager");var _pick=require("../util/object-util")._pick;var apiEndpoint="member/local";module.exports=function(config){var defaults={userId:void 0,groupId:void 0,transport:{}};this.sessionManager=new SessionManager;var serviceOptions=this.sessionManager.getMergedOptions(defaults,config);var urlConfig=new ConfigService(serviceOptions).get("server");var transportOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getAPIPath(apiEndpoint)});serviceOptions.token&&(transportOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(transportOptions,serviceOptions);var getFinalParams=function(params){return"object"==typeof params?$.extend(!0,serviceOptions,params):serviceOptions};var patchUserActiveField=function(params,active,options){var httpOptions=$.extend(!0,serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+params.groupId+"/"+params.userId});return http.patch({active:active},httpOptions)};var publicAPI={getGroupsForUser:function(params,options){options=options||{};var httpOptions=$.extend(!0,serviceOptions,options);var isString="string"==typeof params;var objParams=getFinalParams(params);if(!isString&&!objParams.userId)throw new Error("No userId specified.");var getParms=isString?{userId:params}:_pick(objParams,"userId");return http.get(getParms,httpOptions)},getGroupDetails:function(params,options){options=options||{};var isString="string"==typeof params;var objParams=getFinalParams(params);if(!isString&&!objParams.groupId)throw new Error("No groupId specified.");var groupId=isString?params:objParams.groupId;var httpOptions=$.extend(!0,serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+groupId});return http.get({},httpOptions)},makeUserActive:function(params,options){return patchUserActiveField(params,!0,options)},makeUserInactive:function(params,options){return patchUserActiveField(params,!1,options)}};$.extend(this,publicAPI)};
},{"../store/session-manager":42,"../transport/http-transport-factory":45,"../util/object-util":48,"./configuration-service":30}],34:[function(require,module,exports){
"use strict";var ConfigService=require("./configuration-service");var qutil=require("../util/query-util");var rutil=require("../util/run-util");var _pick=require("../util/object-util")._pick;var TransportFactory=require("../transport/http-transport-factory");var VariablesService=require("./variables-api-service");var SessionManager=require("../store/session-manager");module.exports=function(config){var defaults={token:void 0,account:void 0,project:void 0,filter:"",id:"",autoRestore:!0,success:$.noop,error:$.noop,transport:{}};this.sessionManager=new SessionManager;var serviceOptions=this.sessionManager.getMergedOptions(defaults,config);serviceOptions.id&&(serviceOptions.filter=serviceOptions.id);var urlConfig=new ConfigService(serviceOptions).get("server");serviceOptions.account&&(urlConfig.accountPath=serviceOptions.account),serviceOptions.project&&(urlConfig.projectPath=serviceOptions.project),urlConfig.filter=";",urlConfig.getFilterURL=function(){var url=urlConfig.getAPIPath("run");var filter=qutil.toMatrixFormat(serviceOptions.filter);return filter&&(url+=filter+"/"),url},urlConfig.addAutoRestoreHeader=function(options){var filter=serviceOptions.filter;var isFilterRunId=filter&&"string"===$.type(filter);if(serviceOptions.autoRestore&&isFilterRunId){var autorestoreOpts={headers:{"X-AutoRestore":!0}};return $.extend(!0,autorestoreOpts,options)}return options};var httpOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getFilterURL});serviceOptions.token&&(httpOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(httpOptions);http.splitGet=rutil.splitGetFactory(httpOptions);var setFilterOrThrowError=function(options){if(options.id&&(serviceOptions.filter=options.id),options.filter&&(serviceOptions.filter=options.filter),!serviceOptions.filter)throw new Error("No filter specified to apply operations against")};var publicAsyncAPI={urlConfig:urlConfig,create:function(params,options){var createOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath("run")});var runApiParams=["model","scope","files"];params="string"==typeof params?{model:params}:_pick(params,runApiParams);var oldSuccess=createOptions.success;return createOptions.success=function(response){return serviceOptions.filter=response.id,oldSuccess.apply(this,arguments)},http.post(params,createOptions)},query:function(qs,outputModifier,options){serviceOptions.filter=qs;var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions=urlConfig.addAutoRestoreHeader(httpOptions),http.splitGet(outputModifier,httpOptions)},filter:function(filter,outputModifier,options){$.isPlainObject(serviceOptions.filter)?$.extend(serviceOptions.filter,filter):serviceOptions.filter=filter;var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions=urlConfig.addAutoRestoreHeader(httpOptions),http.splitGet(outputModifier,httpOptions)},load:function(runID,filters,options){runID&&(serviceOptions.filter=runID);var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions=urlConfig.addAutoRestoreHeader(httpOptions),http.get(filters,httpOptions)},save:function(attributes,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return setFilterOrThrowError(httpOptions),http.patch(attributes,httpOptions)},do:function(operation,params,options){var opsArgs;var postOptions;options?(opsArgs=params,postOptions=options):$.isPlainObject(params)?(opsArgs=null,postOptions=params):opsArgs=params;var result=rutil.normalizeOperations(operation,opsArgs);var httpOptions=$.extend(!0,{},serviceOptions,postOptions);setFilterOrThrowError(httpOptions);var prms=result.args[0].length&&null!==result.args[0]&&void 0!==result.args[0]?result.args[0]:[];return http.post({arguments:prms},$.extend(!0,{},httpOptions,{url:urlConfig.getFilterURL()+"operations/"+result.ops[0]+"/"}))},serial:function(operations,params,options){var opParams=rutil.normalizeOperations(operations,params);var ops=opParams.ops;var args=opParams.args;var me=this;var $d=$.Deferred();var postOptions=$.extend(!0,{},serviceOptions,options);var doSingleOp=function(){var op=ops.shift();var arg=args.shift();me.do(op,arg,{success:function(){ops.length?doSingleOp():($d.resolve.apply(this,arguments),postOptions.success.apply(this,arguments))},error:function(){$d.reject.apply(this,arguments),postOptions.error.apply(this,arguments)}})};return doSingleOp(),$d.promise()},parallel:function(operations,params,options){var $d=$.Deferred();var opParams=rutil.normalizeOperations(operations,params);var ops=opParams.ops;var args=opParams.args;var postOptions=$.extend(!0,{},serviceOptions,options);var queue=[];for(var i=0;i<ops.length;i++)queue.push(this.do(ops[i],args[i]));return $.when.apply(this,queue).done(function(){$d.resolve.apply(this,arguments),postOptions.success.apply(this.arguments)}).fail(function(){$d.reject.apply(this,arguments),postOptions.error.apply(this.arguments)}),$d.promise()}};var publicSyncAPI={getCurrentConfig:function(){return serviceOptions},variables:function(config){var vs=new VariablesService($.extend(!0,{},serviceOptions,config,{runService:this}));return vs}};$.extend(this,publicAsyncAPI),$.extend(this,publicSyncAPI)};
},{"../store/session-manager":42,"../transport/http-transport-factory":45,"../util/object-util":48,"../util/query-util":50,"../util/run-util":51,"./configuration-service":30,"./variables-api-service":39}],35:[function(require,module,exports){
"use strict";var ConfigService=require("./configuration-service");var SessionManager=require("../store/session-manager");var objectAssign=require("object-assign");var serviceUtils={getDefaultOptions:function(defaults){var rest=Array.prototype.slice.call(arguments,1);var sessionManager=new SessionManager;var serviceOptions=sessionManager.getMergedOptions.apply(sessionManager,[defaults].concat(rest));return serviceOptions.transport=objectAssign({},serviceOptions.transport,{url:this.getApiUrl(serviceOptions.apiEndpoint,serviceOptions)}),serviceOptions.token&&(serviceOptions.transport.headers={Authorization:"Bearer "+serviceOptions.token}),serviceOptions},getApiUrl:function(apiEndpoint,serviceOptions){var urlConfig=new ConfigService(serviceOptions).get("server");return urlConfig.getAPIPath(apiEndpoint)}};module.exports=serviceUtils;
},{"../store/session-manager":42,"./configuration-service":30,"object-assign":5}],36:[function(require,module,exports){
"use strict";var ConfigService=require("./configuration-service");var TransportFactory=require("../transport/http-transport-factory");var _pick=require("../util/object-util")._pick;var SessionManager=require("../store/session-manager");var apiEndpoint="model/state";module.exports=function(config){var defaults={};this.sessionManager=new SessionManager;var serviceOptions=this.sessionManager.getMergedOptions(defaults,config);var urlConfig=new ConfigService(serviceOptions).get("server");var transportOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getAPIPath(apiEndpoint)});serviceOptions.token&&(transportOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(transportOptions);var parseRunIdOrError=function(params){if($.isPlainObject(params)&&params.runId)return params.runId;throw new Error("Please pass in a run id")};var publicAPI={replay:function(params,options){var runId=parseRunIdOrError(params);var replayOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+runId});return params=$.extend(!0,{action:"replay"},_pick(params,["stopBefore","exclude"])),http.post(params,replayOptions)},clone:function(params,options){var runId=parseRunIdOrError(params);var replayOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+runId});return params=$.extend(!0,{action:"clone"},_pick(params,["stopBefore","exclude"])),http.post(params,replayOptions)}};$.extend(this,publicAPI)};
},{"../store/session-manager":42,"../transport/http-transport-factory":45,"../util/object-util":48,"./configuration-service":30}],37:[function(require,module,exports){
"use strict";var epiVersion=require("../api-version.json");var defaults={host:window.location.host,pathname:window.location.pathname};var UrlConfigService=function(config){function isLocalhost(){var host=options.host;var path=options.pathname;return!host||0!==path.indexOf("/app/")}var options=$.extend({},defaults,config);var API_PROTOCOL="https";var HOST_API_MAPPING={"forio.com":"api.forio.com","foriodev.com":"api.epicenter.foriodev.com"};var publicExports={protocol:API_PROTOCOL,api:"",host:function(){var host=options.host;return isLocalhost()&&(host="forio.com"),HOST_API_MAPPING[host]?HOST_API_MAPPING[host]:"api."+host}(),appPath:function(){var path=options.pathname.split("/");return path&&path[1]||""}(),accountPath:function(){var accnt="";var path=options.pathname.split("/");return path&&"app"===path[1]&&(accnt=path[2]),accnt}(),projectPath:function(){var prj="";var path=options.pathname.split("/");return path&&"app"===path[1]&&(prj=path[3]),prj}(),versionPath:function(){var version=epiVersion.version?epiVersion.version+"/":"";return version}(),isLocalhost:isLocalhost,getAPIPath:function(api){var PROJECT_APIS=["run","data","file"];var apiPath=this.protocol+"://"+this.host+"/"+this.versionPath+api+"/";return $.inArray(api,PROJECT_APIS)!==-1&&(apiPath+=this.accountPath+"/"+this.projectPath+"/"),apiPath}};var envConf={protocol:UrlConfigService.protocol,host:UrlConfigService.host};return $.extend(publicExports,envConf,config),publicExports};module.exports=UrlConfigService;
},{"../api-version.json":6}],38:[function(require,module,exports){
"use strict";var ConfigService=require("./configuration-service");var TransportFactory=require("../transport/http-transport-factory");var SessionManager=require("../store/session-manager");var qutil=require("../util/query-util");module.exports=function(config){var defaults={account:void 0,token:void 0,transport:{}};this.sessionManager=new SessionManager;var serviceOptions=this.sessionManager.getMergedOptions(defaults,config);var urlConfig=new ConfigService(serviceOptions).get("server");var transportOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getAPIPath("user")});serviceOptions.token&&(transportOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(transportOptions);var publicAPI={get:function(filter,options){options=options||{},filter=filter||{};var getOptions=$.extend(!0,{},serviceOptions,options);var toQFilter=function(filter){var res={};return filter.userName&&(res.q=filter.userName),res};var toIdFilters=function(id){return id?(id=$.isArray(id)?id:[id],"id="+id.join("&id=")):""};var getFilters=["account="+getOptions.account,toIdFilters(filter.id),qutil.toQueryFormat(toQFilter(filter))].join("&");var threshold=30;return filter.id&&$.isArray(filter.id)&&filter.id.length>=threshold?(getOptions.url=urlConfig.getAPIPath("user")+"?_method=GET",http.post({id:filter.id},getOptions)):http.get(getFilters,getOptions)},getById:function(userId,options){return publicAPI.get({id:userId},options)}};$.extend(this,publicAPI)};
},{"../store/session-manager":42,"../transport/http-transport-factory":45,"../util/query-util":50,"./configuration-service":30}],39:[function(require,module,exports){
"use strict";var TransportFactory=require("../transport/http-transport-factory");var rutil=require("../util/run-util");module.exports=function(config){var defaults={runService:null};var serviceOptions=$.extend({},defaults,config);var getURL=function(){return serviceOptions.runService.urlConfig.getFilterURL()+"variables/"};var addAutoRestoreHeader=function(options){return serviceOptions.runService.urlConfig.addAutoRestoreHeader(options)};var httpOptions={url:getURL};serviceOptions.token&&(httpOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(httpOptions);http.splitGet=rutil.splitGetFactory(httpOptions);var publicAPI={load:function(variable,outputModifier,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions=addAutoRestoreHeader(httpOptions),http.get(outputModifier,$.extend({},httpOptions,{url:getURL()+variable+"/"}))},query:function(query,outputModifier,options){var httpOptions=$.extend(!0,{},serviceOptions,options);return httpOptions=addAutoRestoreHeader(httpOptions),$.isArray(query)&&(query={include:query}),$.extend(query,outputModifier),http.splitGet(query,httpOptions)},save:function(variable,val,options){var attrs;"object"==typeof variable?(attrs=variable,options=val):(attrs={})[variable]=val;var httpOptions=$.extend(!0,{},serviceOptions,options);return http.patch.call(this,attrs,httpOptions)}};$.extend(this,publicAPI)};
},{"../transport/http-transport-factory":45,"../util/run-util":51}],40:[function(require,module,exports){
"use strict";var ConfigService=require("./configuration-service");var TransportFactory=require("../transport/http-transport-factory");var SessionManager=require("../store/session-manager");var _pick=require("../util/object-util")._pick;var apiBase="multiplayer/";var assignmentEndpoint=apiBase+"assign";var apiEndpoint=apiBase+"world";var projectEndpoint=apiBase+"project";module.exports=function(config){var defaults={token:void 0,project:void 0,account:void 0,group:void 0,model:void 0,filter:"",id:"",transport:{},success:$.noop,error:$.noop};this.sessionManager=new SessionManager;var serviceOptions=this.sessionManager.getMergedOptions(defaults,config);serviceOptions.id&&(serviceOptions.filter=serviceOptions.id);var urlConfig=new ConfigService(serviceOptions).get("server");serviceOptions.account||(serviceOptions.account=urlConfig.accountPath),serviceOptions.project||(serviceOptions.project=urlConfig.projectPath);var transportOptions=$.extend(!0,{},serviceOptions.transport,{url:urlConfig.getAPIPath(apiEndpoint)});serviceOptions.token&&(transportOptions.headers={Authorization:"Bearer "+serviceOptions.token});var http=new TransportFactory(transportOptions);var setIdFilterOrThrowError=function(options){if(options.id&&(serviceOptions.filter=options.id),options.filter&&(serviceOptions.filter=options.filter),!serviceOptions.filter)throw new Error("No world id specified to apply operations against. This could happen if the user is not assigned to a world and is trying to work with runs from that world.")};var validateModelOrThrowError=function(options){if(!options.model)throw new Error("No model specified to get the current run")};var publicAPI={create:function(params,options){var createOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)});var worldApiParams=["scope","files","roles","optionalRoles","minUsers","group","name"];var validParams=_pick(serviceOptions,["account","project","group"]);params=_pick(params,worldApiParams),params=$.extend({},validParams,params);var oldSuccess=createOptions.success;return createOptions.success=function(response){return serviceOptions.filter=response.id,oldSuccess.apply(this,arguments)},http.post(params,createOptions)},update:function(params,options){var whitelist=["roles","optionalRoles","minUsers"];options=options||{},setIdFilterOrThrowError(options);var updateOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter});return params=_pick(params||{},whitelist),http.patch(params,updateOptions)},delete:function(options){options=options&&"string"==typeof options?{filter:options}:{},setIdFilterOrThrowError(options);var deleteOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter});return http.delete(null,deleteOptions)},updateConfig:function(config){return $.extend(serviceOptions,config),this},list:function(options){options=options||{};var getOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)});var filters=_pick(getOptions,["account","project","group"]);return http.get(filters,getOptions)},getWorldsForUser:function(userId,options){options=options||{};var getOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)});var filters=$.extend(_pick(getOptions,["account","project","group"]),{userId:userId});return http.get(filters,getOptions)},load:function(worldId,options){if(worldId&&(serviceOptions.filter=worldId),!serviceOptions.filter)throw new Error("Please provide a worldid to load");var httpOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter+"/"});return http.get("",httpOptions)},addUsers:function(users,worldId,options){if(!users)throw new Error("Please provide a list of users to add to the world");users=$.map([].concat(users),function(u){var isObject=$.isPlainObject(u);if("string"!=typeof u&&!isObject)throw new Error("Some of the users in the list are not in the valid format: "+u);return isObject?u:{userId:u}}),$.isPlainObject(worldId)&&!options&&(options=worldId,worldId=null),options=options||{},"string"==typeof worldId&&(options.filter=worldId),setIdFilterOrThrowError(options);var updateOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter+"/users"});return http.post(users,updateOptions)},updateUser:function(user,options){if(options=options||{},!user||!user.userId)throw new Error("You need to pass a userId to update from the world");setIdFilterOrThrowError(options);var patchOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter+"/users/"+user.userId});return http.patch(_pick(user,"role"),patchOptions)},removeUser:function(user,options){if(options=options||{},"string"==typeof user&&(user={userId:user}),!user.userId)throw new Error("You need to pass a userId to remove from the world");setIdFilterOrThrowError(options);var getOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter+"/users/"+user.userId});return http.delete(null,getOptions)},getCurrentRunId:function(options){options=options||{},setIdFilterOrThrowError(options);var getOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter+"/run"});return validateModelOrThrowError(getOptions),http.post(_pick(getOptions,"model"),getOptions)},getCurrentWorldForUser:function(userId,groupName){var dtd=$.Deferred();var me=this;return this.getWorldsForUser(userId,{group:groupName}).then(function(worlds){worlds.sort(function(a,b){return new Date(b.lastModified)-new Date(a.lastModified)});var currentWorld=worlds[0];currentWorld&&(serviceOptions.filter=currentWorld.id),dtd.resolve(currentWorld,me)}).fail(dtd.reject),dtd.promise()},deleteRun:function(worldId,options){options=options||{},worldId&&(options.filter=worldId),setIdFilterOrThrowError(options);var deleteOptions=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(apiEndpoint)+serviceOptions.filter+"/run"});return http.delete(null,deleteOptions)},newRunForWorld:function(worldId,options){var currentRunOptions=$.extend(!0,{},options,{filter:worldId||serviceOptions.filter});var _this=this;return validateModelOrThrowError(currentRunOptions),this.deleteRun(worldId,options).then(function(){return _this.getCurrentRunId(currentRunOptions)})},autoAssign:function(options){options=options||{};var opt=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(assignmentEndpoint)});var params={account:opt.account,project:opt.project,group:opt.group};return opt.maxUsers&&(params.maxUsers=opt.maxUsers),http.post(params,opt)},getProjectSettings:function(options){options=options||{};var opt=$.extend(!0,{},serviceOptions,options,{url:urlConfig.getAPIPath(projectEndpoint)});return opt.url+=[opt.account,opt.project].join("/"),http.get(null,opt)}};$.extend(this,publicAPI)};
},{"../store/session-manager":42,"../transport/http-transport-factory":45,"../util/object-util":48,"./configuration-service":30}],41:[function(require,module,exports){
"use strict";var Cookie=function(){this.get=function(){return document.cookie},this.set=function(newCookie){document.cookie=newCookie}};module.exports=function(config){var host=window.location.hostname;var validHost=host.split(".").length>1;var domain=validHost?"."+host:null;var defaults={root:"/",domain:domain,cookie:new Cookie};this.serviceOptions=$.extend({},defaults,config);var publicAPI={set:function(key,value,options){var setOptions=$.extend(!0,{},this.serviceOptions,options);var domain=setOptions.domain;var path=setOptions.root;var cookie=setOptions.cookie;return cookie.set(encodeURIComponent(key)+"="+encodeURIComponent(value)+(domain?"; domain="+domain:"")+(path?"; path="+path:"")),value},get:function(key){var cookie=this.serviceOptions.cookie;var cookieReg=new RegExp("(?:^|;)\\s*"+encodeURIComponent(key).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$");var res=cookieReg.exec(cookie.get());var val=res?decodeURIComponent(res[1]):null;return val},remove:function(key,options){var remOptions=$.extend(!0,{},this.serviceOptions,options);var domain=remOptions.domain;var path=remOptions.root;var cookie=remOptions.cookie;return cookie.set(encodeURIComponent(key)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(domain?"; domain="+domain:"")+(path?"; path="+path:"")),key},destroy:function(){var cookie=this.serviceOptions.cookie;var aKeys=cookie.get().replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);for(var nIdx=0;nIdx<aKeys.length;nIdx++){var cookieKey=decodeURIComponent(aKeys[nIdx]);this.remove(cookieKey)}return aKeys}};$.extend(this,publicAPI)};
},{}],42:[function(require,module,exports){
"use strict";var keyNames=require("../managers/key-names");var StorageFactory=require("./store-factory");var optionUtils=require("../util/option-utils");var EPI_SESSION_KEY=keyNames.EPI_SESSION_KEY;var defaults={store:{synchronous:!0}};var SessionManager=function(managerOptions){function getBaseOptions(overrides){overrides=overrides||{};var libOptions=optionUtils.getOptions();var finalOptions=$.extend(!0,{},defaults,libOptions,managerOptions,overrides);return finalOptions}function getStore(overrides){var baseOptions=getBaseOptions(overrides);var storeOpts=baseOptions.store||{};return void 0===storeOpts.root&&baseOptions.account&&baseOptions.project&&!baseOptions.isLocal&&(storeOpts.root="/app/"+baseOptions.account+"/"+baseOptions.project),new StorageFactory(storeOpts)}managerOptions=managerOptions||{};var publicAPI={saveSession:function(userInfo,options){var serialized=JSON.stringify(userInfo);getStore(options).set(EPI_SESSION_KEY,serialized)},getSession:function(options){var store=getStore(options);var finalOpts=store.serviceOptions;var serialized=store.get(EPI_SESSION_KEY)||"{}";var session=JSON.parse(serialized);var account=finalOpts.account;var project=finalOpts.project;if(account&&session.account!==account)return{};if(session.groups&&account&&project){var group=session.groups[project]||{groupId:"",groupName:"",isFac:!1};$.extend(session,{project:project},group)}return session},removeSession:function(options){var store=getStore(options);return Object.keys(keyNames).forEach(function(cookieKey){var cookieName=keyNames[cookieKey];store.remove(cookieName)}),!0},getStore:function(options){return getStore(options)},getMergedOptions:function(){var args=Array.prototype.slice.call(arguments);var overrides=$.extend.apply($,[!0,{}].concat(args));var baseOptions=getBaseOptions(overrides);var session=this.getSession(overrides);var sessionDefaults={token:session.auth_token,group:session.groupName,groupId:session.groupId,userId:session.userId};return $.extend(!0,sessionDefaults,baseOptions)}};$.extend(this,publicAPI)};module.exports=SessionManager;
},{"../managers/key-names":12,"../util/option-utils":49,"./store-factory":43}],43:[function(require,module,exports){
"use strict";var store=require("./cookie-store");module.exports=store;
},{"./cookie-store":41}],44:[function(require,module,exports){
"use strict";var qutils=require("../util/query-util");module.exports=function(config){var defaults={url:"",contentType:"application/json",headers:{},statusCode:{404:$.noop},parameterParser:qutils.toQueryFormat,xhrFields:{withCredentials:!0}};var transportOptions=$.extend({},defaults,config);var result=function(d){return $.isFunction(d)?d():d};var connect=function(method,params,connectOptions){params=result(params),params=$.isPlainObject(params)||$.isArray(params)?JSON.stringify(params):params;var options=$.extend(!0,{},transportOptions,connectOptions,{type:method,data:params});var ALLOWED_TO_BE_FUNCTIONS=["data","url"];if($.each(options,function(key,value){$.isFunction(value)&&$.inArray(key,ALLOWED_TO_BE_FUNCTIONS)!==-1&&(options[key]=value())}),options.logLevel&&"DEBUG"===options.logLevel){console.log(options.url);var oldSuccessFn=options.success||$.noop;options.success=function(response,ajaxStatus,ajaxReq){console.log(response),oldSuccessFn.apply(this,arguments)}}var beforeSend=options.beforeSend;return options.beforeSend=function(xhr,settings){xhr.requestUrl=(connectOptions||{}).url,beforeSend&&beforeSend.apply(this,arguments)},$.ajax(options)};var publicAPI={get:function(params,ajaxOptions){var options=$.extend({},transportOptions,ajaxOptions);return params=options.parameterParser(result(params)),connect.call(this,"GET",params,options)},splitGet:function(){},post:function(){return connect.apply(this,["post"].concat([].slice.call(arguments)))},patch:function(){return connect.apply(this,["patch"].concat([].slice.call(arguments)))},put:function(){return connect.apply(this,["put"].concat([].slice.call(arguments)))},delete:function(params,ajaxOptions){var options=$.extend({},transportOptions,ajaxOptions);if(params=options.parameterParser(result(params)),$.trim(params)){var delimiter=result(options.url).indexOf("?")===-1?"?":"&";options.url=result(options.url)+delimiter+params}return connect.call(this,"DELETE",null,options)},head:function(){return connect.apply(this,["head"].concat([].slice.call(arguments)))},options:function(){return connect.apply(this,["options"].concat([].slice.call(arguments)))}};return $.extend(this,publicAPI)};
},{"../util/query-util":50}],45:[function(require,module,exports){
"use strict";var transport=require("./ajax-http-transport");module.exports=transport;
},{"./ajax-http-transport":44}],46:[function(require,module,exports){
"use strict";function inherit(C,P){var F=function(){};F.prototype=P.prototype,C.prototype=new F,C.__super=P.prototype,C.prototype.constructor=C}var extend=function(dest){var obj=Array.prototype.slice.call(arguments,1);var current;for(var j=0;j<obj.length;j++)if(current=obj[j])for(var key in current)dest[key]=current[key];return dest};module.exports=function(base,props,staticProps){var parent=base;var child;return child=props&&props.hasOwnProperty("constructor")?props.constructor:function(){return parent.apply(this,arguments)},extend(child,parent,staticProps),inherit(child,parent),props&&extend(child.prototype,props),child};
},{}],47:[function(require,module,exports){
"use strict";function _w(val){if(val&&val.then)return val;var p=$.Deferred();return p.resolve(val),p.promise()}function seq(){function next(p){var cur=list.splice(0,1)[0];return cur?_w(cur(p)).then(next):p}var list=Array.prototype.slice.apply(arguments);return function(seed){return next(seed).fail(seq.fail)}}function MakeSeq(obj){var res={__calls:[],original:obj,then:function(fn){return this.__calls.push(fn),this},start:function(){var _this=this;return this.then(function(run){return _this.__calls.length=0,run}),seq.apply(null,this.__calls)()},fail:function(fn){return seq.fail=fn,this}};var funcMaker=function(p,obj){var fn=obj[p].bind(obj);return function(){var args=Array.prototype.slice.apply(arguments);return this.__calls.push(Function.bind.apply(fn,[null].concat(args))),this}};for(var prop in obj)"function"==typeof obj[prop]?res[prop]=funcMaker(prop,obj):res[prop]=obj[prop];return res}module.exports=MakeSeq;
},{}],48:[function(require,module,exports){
"use strict";module.exports={_pick:function(obj,props){var res={};for(var p in obj)props.indexOf(p)!==-1&&(res[p]=obj[p]);return res}};
},{}],49:[function(require,module,exports){
"use strict";var ConfigService=require("../service/configuration-service");var urlConfig=(new ConfigService).get("server");var customDefaults={};var libDefaults={account:urlConfig.accountPath,project:urlConfig.projectPath,isLocal:urlConfig.isLocalhost(),store:{}};var optionUtils={getOptions:function(options){return $.extend(!0,{},libDefaults,customDefaults,options)},setDefaults:function(defaults){customDefaults=defaults}};module.exports=optionUtils;
},{"../service/configuration-service":30}],50:[function(require,module,exports){
"use strict";module.exports=function(){return{toMatrixFormat:function(qs){if(null===qs||void 0===qs||""===qs)return";";if("string"==typeof qs||qs instanceof String)return qs;var returnArray=[];var OPERATORS=["<",">","!"];$.each(qs,function(key,value){"string"==typeof value&&$.inArray($.trim(value).charAt(0),OPERATORS)!==-1||(value="="+value),returnArray.push(key+value)});var mtrx=";"+returnArray.join(";");return mtrx},toQueryFormat:function(qs){if(null===qs||void 0===qs)return"";if("string"==typeof qs||qs instanceof String)return qs;var returnArray=[];$.each(qs,function(key,value){$.isArray(value)&&(value=value.join(",")),$.isPlainObject(value)&&(value=JSON.stringify(value)),returnArray.push(key+"="+value)});var result=returnArray.join("&");return result},qsToObject:function(qs){if(null===qs||void 0===qs||""===qs)return{};var qsArray=qs.split("&");var returnObj={};return $.each(qsArray,function(index,value){var qKey=value.split("=")[0];var qVal=value.split("=")[1];qVal.indexOf(",")!==-1&&(qVal=qVal.split(",")),returnObj[qKey]=qVal}),returnObj},mergeQS:function(qs1,qs2){var obj1=this.qsToObject(this.toQueryFormat(qs1));var obj2=this.qsToObject(this.toQueryFormat(qs2));return $.extend(!0,{},obj1,obj2)},addTrailingSlash:function(url){return url?"/"===url.charAt(url.length-1)?url:url+"/":""}}}();
},{}],51:[function(require,module,exports){
"use strict";var qutil=require("./query-util");var MAX_URL_LENGTH=2048;module.exports=function(){return{normalizeOperations:function(operations,args){args||(args=[]);var returnList={ops:[],args:[]};var _concat=function(arr){return null!==arr&&void 0!==arr?[].concat(arr):[]};var _normalizePlainObjects=function(operations,returnList){return returnList||(returnList={ops:[],args:[]}),$.each(operations,function(opn,arg){returnList.ops.push(opn),returnList.args.push(_concat(arg))}),returnList};var _normalizeStructuredObjects=function(operation,returnList){return returnList||(returnList={ops:[],args:[]}),returnList.ops.push(operation.name),returnList.args.push(_concat(operation.params)),returnList};var _normalizeObject=function(operation,returnList){return(operation.name?_normalizeStructuredObjects:_normalizePlainObjects)(operation,returnList)};var _normalizeLiterals=function(operation,args,returnList){return returnList||(returnList={ops:[],args:[]}),returnList.ops.push(operation),returnList.args.push(_concat(args)),returnList};var _normalizeArrays=function(operations,arg,returnList){return returnList||(returnList={ops:[],args:[]}),$.each(operations,function(index,opn){$.isPlainObject(opn)?_normalizeObject(opn,returnList):_normalizeLiterals(opn,args[index],returnList)}),returnList};return $.isPlainObject(operations)?_normalizeObject(operations,returnList):$.isArray(operations)?_normalizeArrays(operations,args,returnList):_normalizeLiterals(operations,args,returnList),returnList},splitGetFactory:function(httpOptions){return function(params,options){var http=this;var getValue=function(name){var value=options[name]||httpOptions[name];return"function"==typeof value&&(value=value()),value};var getFinalUrl=function(params){var url=getValue("url",options);var data=params;url=url.replace(/#.*$/,"");var queryParams=qutil.toQueryFormat(data);var questionIdx=url.indexOf("?");return queryParams&&questionIdx>-1?url+"&"+queryParams:queryParams?url+"?"+queryParams:url};var url=getFinalUrl(params);if(params&&params.include&&encodeURI(url).length>MAX_URL_LENGTH){var dtd=$.Deferred();var paramsCopy=$.extend(!0,{},params);delete paramsCopy.include;var urlNoIncludes=getFinalUrl(paramsCopy);var diff=MAX_URL_LENGTH-urlNoIncludes.length;var oldSuccess=options.success||httpOptions.success||$.noop;var oldError=options.error||httpOptions.error||$.noop;options.success=$.noop,options.error=$.noop;var include=params.include;var currIncludes=[];var includeOpts=[currIncludes];var currLength=encodeURIComponent("?include=").length;var variable=include.pop();for(;variable;){var varLenght=encodeURIComponent(variable).length;currLength+varLenght+1<diff?(currIncludes.push(variable),currLength+=varLenght+1):(currIncludes=[variable],includeOpts.push(currIncludes),currLength="?include=".length+varLenght),variable=include.pop()}var reqs=$.map(includeOpts,function(include){var reqParams=$.extend({},params,{include:include});return http.get(reqParams,options)});return $.when.apply($,reqs).then(function(){var isValid=arguments[0]&&arguments[0][0];if(!isValid)return oldError(),dtd.reject();var firstResponse=arguments[0][0];var isObject=$.isPlainObject(firstResponse);var isRunAPI=isObject&&$.isPlainObject(firstResponse.variables)||!isObject;if(isRunAPI)if(isObject){var aggregateRun=arguments[0][0];$.each(arguments,function(idx,args){var run=args[0];$.extend(!0,aggregateRun.variables,run.variables)}),oldSuccess(aggregateRun,arguments[0][1],arguments[0][2]),dtd.resolve(aggregateRun,arguments[0][1],arguments[0][2])}else{var aggregatedRuns={};$.each(arguments,function(idx,args){var runs=args[0];$.isArray(runs)&&$.each(runs,function(idxRun,run){run.id&&!aggregatedRuns[run.id]?(run.variables=run.variables||{},aggregatedRuns[run.id]=run):run.id&&$.extend(!0,aggregatedRuns[run.id].variables,run.variables)})}),aggregatedRuns=$.map(aggregatedRuns,function(run){return run}),oldSuccess(aggregatedRuns,arguments[0][1],arguments[0][2]),dtd.resolve(aggregatedRuns,arguments[0][1],arguments[0][2])}else{var aggregatedVariables={};$.each(arguments,function(idx,args){var vars=args[0];$.extend(!0,aggregatedVariables,vars)}),oldSuccess(aggregatedVariables,arguments[0][1],arguments[0][2]),dtd.resolve(aggregatedVariables,arguments[0][1],arguments[0][2])}},function(){oldError.apply(http,arguments),dtd.reject.apply(dtd,arguments)}),dtd.promise()}return http.get(params,options)}}}}();
},{"./query-util":50}]},{},[7])


//# sourceMappingURL=epicenter.min.js.map